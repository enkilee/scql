// Copyright 2026 Ant Group Co., Ltd.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package compiler

type testConf struct {
	groupThreshold   int
	batched          bool
	revealGroupCount bool
}

type sPair struct {
	sql           string
	dotGraph      string
	briefPipeline string
	conf          testConf
}

var executionGraphTestCases = []sPair{
	{`select tbl_1.plain_float_0 from alice.tbl_1 join alice.tbl_2;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select tbl_1.plain_float_0 from alice.tbl_1 join alice.tbl_2;,table_refs:[alice.tbl_1 alice.tbl_2],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_3:{plain_float_0:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select alice.plain_datetime_0 from alice.tbl_0 as alice join bob.tbl_0 as bob on bob.join_string_0 = alice.encrypt_string_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select alice.encrypt_string_0,alice.plain_datetime_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'bob'.'join_string_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_5,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_5,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_4,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{encrypt_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_2:{plain_datetime_0:PRIVATE:DATETIME}"]
1 -> 2 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
2 -> 3 [label = "t_5:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{plain_datetime_0:PRIVATE:DATETIME}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ABS(ta.plain_int_0) AS abs_out,
	CEIL(ta.plain_int_0) AS ceil_out,
	FLOOR(ta.plain_int_0) AS floor_out,
	ROUND(ta.plain_int_0) AS round_out,
	RADIANS(ta.plain_int_0) AS radians_out,
	DEGREES(ta.plain_int_0) AS degrees_out,
	LN(ta.plain_int_0) AS ln_out,
	LOG10(ta.plain_int_0) AS log10_out,
	LOG2(ta.plain_int_0) AS log2_out,
	SQRT(ta.plain_int_0) AS sqrt_out,
	EXP(ta.plain_int_0) AS exp_out
	FROM alice.tbl_0 as ta INNER JOIN bob.tbl_0 as tb
	ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_16,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_16,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="Abs:{in:[In:{t_4,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
5 [label="Ceil:{in:[In:{t_4,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
6 [label="Floor:{in:[In:{t_4,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
7 [label="Round:{in:[In:{t_4,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
8 [label="Radians:{in:[In:{t_4,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
9 [label="Degrees:{in:[In:{t_4,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
10 [label="Ln:{in:[In:{t_4,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
11 [label="Log10:{in:[In:{t_4,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
12 [label="Log2:{in:[In:{t_4,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
13 [label="Sqrt:{in:[In:{t_4,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
14 [label="Exp:{in:[In:{t_4,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
15 [label="publish_result:{in:[In:{t_5,t_6,t_7,t_8,t_9,t_10,t_11,t_12,t_13,t_14,t_15,},],out:[Out:{t_17,t_18,t_19,t_20,t_21,t_22,t_23,t_24,t_25,t_26,t_27,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
10 -> 15 [label = "t_11:{ln_out:PRIVATE:FLOAT64}"]
11 -> 15 [label = "t_12:{log10_out:PRIVATE:FLOAT64}"]
12 -> 15 [label = "t_13:{log2_out:PRIVATE:FLOAT64}"]
13 -> 15 [label = "t_14:{sqrt_out:PRIVATE:FLOAT64}"]
14 -> 15 [label = "t_15:{exp_out:PRIVATE:FLOAT64}"]
2 -> 3 [label = "t_16:{left_index:PRIVATE:INT64}"]
3 -> 10 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 11 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 12 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 13 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 14 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 9 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
4 -> 15 [label = "t_5:{abs_out:PRIVATE:INT64}"]
5 -> 15 [label = "t_6:{ceil_out:PRIVATE:INT64}"]
6 -> 15 [label = "t_7:{floor_out:PRIVATE:INT64}"]
7 -> 15 [label = "t_8:{round_out:PRIVATE:INT64}"]
8 -> 15 [label = "t_9:{radians_out:PRIVATE:FLOAT64}"]
9 -> 15 [label = "t_10:{degrees_out:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 Abs_4 Ceil_5 Floor_6 Round_7 Radians_8 Degrees_9 Ln_10 Log10_11 Log2_12 Sqrt_13 Exp_14 publish_result_15]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT RANK() OVER(PARTITION BY ta.plain_int_0 ORDER BY ta.plain_float_0 DESC) AS r1, PERCENT_RANK() OVER(PARTITION BY ta.plain_int_0 ORDER BY ta.plain_float_0 DESC) AS r2, ROW_NUMBER() OVER(PARTITION BY ta.plain_int_0 ORDER BY ta.plain_float_0 DESC) AS r3 FROM alice.tbl_0 AS ta`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_11,t_12,t_10,},],attr:[sql:select t_0.expr_125 as r1,percent_rank() over (partition by t_0.r1 order by t_0.r2 desc) as r2,t_0.r3 from (select t_0.r1,t_0.r2,t_0.r3,rank() over (partition by t_0.r1 order by t_0.r2 desc) as expr_125 from (select ta.plain_int_0 as r1,ta.plain_float_0 as r2,row_number() over (partition by ta.plain_int_0 order by ta.plain_float_0 desc) as r3 from alice.tbl_0 as ta) as t_0) as t_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_11,t_12,t_10,},],out:[Out:{t_13,t_14,t_15,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_10:{row_number:PRIVATE:INT64}"]
0 -> 1 [label = "t_11:{rank:PRIVATE:INT64}"]
0 -> 1 [label = "t_12:{percent_rank:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.rank_int_0, rank() over (partition by ta.rank_int_0 order by tb.rank_float_0, tb.rank_float_1) as rank_num, row_number() over (partition by ta.rank_int_0 order by tb.rank_float_0, tb.rank_float_1) as row_number_num
FROM alice.tbl_0 as ta JOIN bob.tbl_0 as tb ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.rank_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,t_5,},],attr:[sql:select 'tb'.'join_int_0','tb'.'rank_float_0','tb'.'rank_float_1' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_16,},RightJoinIndex:{t_17,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_16,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,t_5,},RowsIndexFilter:{t_17,},],out:[Out:{t_7,t_8,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_18,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_19,},],attr:[],party:[alice,bob,]}"]
7 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_20,},],attr:[],party:[alice,bob,]}"]
8 [label="sort:{in:[In:{t_18,t_19,t_20,t_18,t_19,t_20,},Key:{t_18,t_19,t_20,},],out:[Out:{t_21,t_22,t_23,t_9,t_10,t_11,},],attr:[reverse:[false false false],],party:[alice,bob,]}"]
9 [label="oblivious_group_mark:{in:[Key:{t_21,},],out:[Group:{t_24,},],attr:[],party:[alice,bob,]}"]
10 [label="count:{in:[Group:{t_24,},In:{t_24,},],out:[Out:{t_12,},],attr:[],party:[alice,bob,]}"]
11 [label="sort:{in:[In:{t_9,t_10,t_11,t_9,t_12,},Key:{t_9,t_10,t_11,},],out:[Out:{t_25,t_26,t_27,t_13,t_14,},],attr:[reverse:[false false false],],party:[alice,bob,]}"]
12 [label="oblivious_group_mark:{in:[Key:{t_25,},],out:[Group:{t_28,},],attr:[],party:[alice,bob,]}"]
13 [label="oblivious_group_mark:{in:[Key:{t_25,t_26,t_27,},],out:[Group:{t_29,},],attr:[],party:[alice,bob,]}"]
14 [label="rank:{in:[Group:{t_28,},In:{t_29,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,]}"]
15 [label="make_private:{in:[In:{t_13,},],out:[Out:{t_30,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
16 [label="make_private:{in:[In:{t_15,},],out:[Out:{t_31,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
17 [label="make_private:{in:[In:{t_14,},],out:[Out:{t_32,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
18 [label="publish_result:{in:[In:{t_30,t_31,t_32,},],out:[Out:{t_33,t_34,t_35,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{rank_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{rank_float_0:PRIVATE:FLOAT64}"]
1 -> 4 [label = "t_5:{rank_float_1:PRIVATE:FLOAT64}"]
10 -> 11 [label = "t_12:{row_number:SECRET:INT64}"]
11 -> 12 [label = "t_25:{rank_int_0:SECRET:INT64}"]
11 -> 13 [label = "t_25:{rank_int_0:SECRET:INT64}"]
11 -> 13 [label = "t_26:{rank_float_0:SECRET:FLOAT64}"]
11 -> 13 [label = "t_27:{rank_float_1:SECRET:FLOAT64}"]
11 -> 15 [label = "t_13:{rank_int_0:SECRET:INT64}"]
11 -> 17 [label = "t_14:{row_number:SECRET:INT64}"]
12 -> 14 [label = "t_28:{group_mark:SECRET:BOOL}"]
13 -> 14 [label = "t_29:{order_mark:SECRET:BOOL}"]
14 -> 16 [label = "t_15:{rank:SECRET:INT64}"]
15 -> 18 [label = "t_30:{rank_int_0:PRIVATE:INT64}"]
16 -> 18 [label = "t_31:{rank:PRIVATE:INT64}"]
17 -> 18 [label = "t_32:{row_number:PRIVATE:INT64}"]
2 -> 3 [label = "t_16:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_17:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_6:{rank_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_7:{rank_float_0:PRIVATE:FLOAT64}"]
4 -> 7 [label = "t_8:{rank_float_1:PRIVATE:FLOAT64}"]
5 -> 8 [label = "t_18:{rank_int_0:SECRET:INT64}"]
5 -> 8 [label = "t_18:{rank_int_0:SECRET:INT64}"]
5 -> 8 [label = "t_18:{rank_int_0:SECRET:INT64}"]
6 -> 8 [label = "t_19:{rank_float_0:SECRET:FLOAT64}"]
6 -> 8 [label = "t_19:{rank_float_0:SECRET:FLOAT64}"]
6 -> 8 [label = "t_19:{rank_float_0:SECRET:FLOAT64}"]
7 -> 8 [label = "t_20:{rank_float_1:SECRET:FLOAT64}"]
7 -> 8 [label = "t_20:{rank_float_1:SECRET:FLOAT64}"]
7 -> 8 [label = "t_20:{rank_float_1:SECRET:FLOAT64}"]
8 -> 11 [label = "t_10:{rank_float_0:SECRET:FLOAT64}"]
8 -> 11 [label = "t_10:{rank_float_0:SECRET:FLOAT64}"]
8 -> 11 [label = "t_11:{rank_float_1:SECRET:FLOAT64}"]
8 -> 11 [label = "t_11:{rank_float_1:SECRET:FLOAT64}"]
8 -> 11 [label = "t_9:{rank_int_0:SECRET:INT64}"]
8 -> 11 [label = "t_9:{rank_int_0:SECRET:INT64}"]
8 -> 11 [label = "t_9:{rank_int_0:SECRET:INT64}"]
8 -> 9 [label = "t_21:{rank_int_0:SECRET:INT64}"]
9 -> 10 [label = "t_24:{group_mark:SECRET:BOOL}"]
9 -> 10 [label = "t_24:{group_mark:SECRET:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 make_share_7 sort_8 oblivious_group_mark_9 count_10 sort_11 oblivious_group_mark_12 oblivious_group_mark_13 rank_14 make_private_15 make_private_16 make_private_17 publish_result_18]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT rank() OVER(PARTITION BY ta.rank_int_0 ORDER BY tb.rank_int_0) FROM alice.tbl_0 as ta JOIN bob.tbl_0 as tb ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.rank_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'rank_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_8,},RightJoinIndex:{t_9,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_8,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_9,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_10,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_11,},],attr:[],party:[alice,bob,]}"]
7 [label="sort:{in:[In:{t_10,t_11,},Key:{t_10,t_11,},],out:[Out:{t_12,t_13,},],attr:[reverse:[false false],],party:[alice,bob,]}"]
8 [label="oblivious_group_mark:{in:[Key:{t_12,},],out:[Group:{t_14,},],attr:[],party:[alice,bob,]}"]
9 [label="oblivious_group_mark:{in:[Key:{t_12,t_13,},],out:[Group:{t_15,},],attr:[],party:[alice,bob,]}"]
10 [label="rank:{in:[Group:{t_14,},In:{t_15,},],out:[Out:{t_7,},],attr:[],party:[alice,bob,]}"]
11 [label="make_private:{in:[In:{t_7,},],out:[Out:{t_16,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
12 [label="publish_result:{in:[In:{t_16,},],out:[Out:{t_17,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{rank_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{rank_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_7:{rank:SECRET:INT64}"]
11 -> 12 [label = "t_16:{rank:PRIVATE:INT64}"]
2 -> 3 [label = "t_8:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_9:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{rank_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_6:{rank_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_10:{rank_int_0:SECRET:INT64}"]
5 -> 7 [label = "t_10:{rank_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_11:{rank_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_11:{rank_int_0:SECRET:INT64}"]
7 -> 8 [label = "t_12:{rank_int_0:SECRET:INT64}"]
7 -> 9 [label = "t_12:{rank_int_0:SECRET:INT64}"]
7 -> 9 [label = "t_13:{rank_int_0:SECRET:INT64}"]
8 -> 10 [label = "t_14:{group_mark:SECRET:BOOL}"]
9 -> 10 [label = "t_15:{order_mark:SECRET:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 sort_7 oblivious_group_mark_8 oblivious_group_mark_9 rank_10 make_private_11 publish_result_12]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT rank() OVER(PARTITION BY ta.join_int_0 ORDER BY ta.plain_int_0) FROM alice.tbl_0 as ta JOIN bob.tbl_0 as tb ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_7,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_7,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="private_group:{in:[Key:{t_5,},],out:[GroupId:{t_8,},GroupNum:{t_9,},],attr:[],party:[alice,]}"]
5 [label="Rank:{in:[Key:{t_4,},PartitionId:{t_8,},PartitionNum:{t_9,},],out:[Out:{t_6,},],attr:[reverse:[0],],party:[alice,]}"]
6 [label="publish_result:{in:[In:{t_6,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_7:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_8:{window_group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_9:{window_group_num:PRIVATE:INT64}"]
5 -> 6 [label = "t_6:{rank:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 private_group_4 Rank_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT rank() OVER(PARTITION BY ta.join_int_0 ORDER BY ta.plain_int_0) FROM alice.tbl_0 as ta JOIN bob.tbl_0 as tb ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_7,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_7,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="private_group:{in:[Key:{t_5,},],out:[GroupId:{t_8,},GroupNum:{t_9,},],attr:[],party:[alice,]}"]
5 [label="Rank:{in:[Key:{t_4,},PartitionId:{t_8,},PartitionNum:{t_9,},],out:[Out:{t_6,},],attr:[reverse:[0],],party:[alice,]}"]
6 [label="publish_result:{in:[In:{t_6,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_7:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_8:{window_group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_9:{window_group_num:PRIVATE:INT64}"]
5 -> 6 [label = "t_6:{rank:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 private_group_4 Rank_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, ta.plain_datetime_0 from alice.tbl_0 as ta right join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 where ta.plain_datetime_0 > str_to_date(tb.plain_string_0, '%Y-%m-%d')`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.plain_datetime_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'plain_string_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_12,},RightJoinIndex:{t_13,},],attr:[input_party_codes:[alice bob],join_type:2,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_12,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_13,},],out:[Out:{t_7,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_7,},],out:[Out:{t_14,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="arrow_func[strptime]:{in:[In:{t_14,},],out:[Out:{t_8,},],attr:[func_name:strptime,func_opt_type:StrptimeOptions,],party:[alice,]}"]
7 [label="Greater:{in:[Left:{t_6,},Right:{t_8,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
8 [label="filter:{in:[Filter:{t_9,},In:{t_5,t_6,},],out:[Out:{t_10,t_11,},],attr:[],party:[alice,]}"]
9 [label="publish_result:{in:[In:{t_10,t_11,},],out:[Out:{t_15,t_16,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{plain_datetime_0:PRIVATE:DATETIME}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{plain_string_0:PRIVATE:STRING}"]
2 -> 3 [label = "t_12:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_13:{right_index:PRIVATE:INT64}"]
3 -> 7 [label = "t_6:{plain_datetime_0:PRIVATE:DATETIME}"]
3 -> 8 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_6:{plain_datetime_0:PRIVATE:DATETIME}"]
4 -> 5 [label = "t_7:{plain_string_0:PRIVATE:STRING}"]
5 -> 6 [label = "t_14:{plain_string_0:PRIVATE:STRING}"]
6 -> 7 [label = "t_8:{str_to_date_out:PRIVATE:DATETIME}"]
7 -> 8 [label = "t_9:{gt_out:PRIVATE:BOOL}"]
8 -> 9 [label = "t_10:{join_int_0:PRIVATE:INT64}"]
8 -> 9 [label = "t_11:{plain_datetime_0:PRIVATE:DATETIME}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 arrow_func[strptime]_6 Greater_7 filter_8 publish_result_9]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.plain_timestamp_0 from alice.tbl_0 as ta where ta.plain_timestamp_0 > '2025-04-23 12:25:42'`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_5,},],attr:[sql:select ta.plain_timestamp_0 from alice.tbl_0 as ta where ta.plain_timestamp_0>'2025-04-23 12:25:42';,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_5,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_5:{plain_timestamp_0:PRIVATE:TIMESTAMP}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, ta.plain_datetime_0 from alice.tbl_0 as ta right join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 where ta.plain_datetime_0 > str_to_date('2025-06-05', '%Y-%m-%d')`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.plain_datetime_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{t_12,},],attr:[input_party_codes:[alice bob],join_type:2,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_11,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="constant:{in:[],out:[Out:{t_6,},],attr:[scalar:1749081600,to_status:1,],party:[alice,bob,]}"]
5 [label="broadcast_to:{in:[In:{t_6,},ShapeRefTensor:{t_5,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
6 [label="Greater:{in:[Left:{t_5,},Right:{t_7,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
7 [label="filter:{in:[Filter:{t_8,},In:{t_4,t_5,},],out:[Out:{t_9,t_10,},],attr:[],party:[alice,]}"]
8 [label="publish_result:{in:[In:{t_9,t_10,},],out:[Out:{t_13,t_14,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{plain_datetime_0:PRIVATE:DATETIME}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_11:{left_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
3 -> 6 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
3 -> 7 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
4 -> 5 [label = "t_6:{constant_data:PUBLIC:DATETIME}"]
5 -> 6 [label = "t_7:{constant_data:PRIVATE:DATETIME}"]
6 -> 7 [label = "t_8:{gt_out:PRIVATE:BOOL}"]
7 -> 8 [label = "t_10:{plain_datetime_0:PRIVATE:DATETIME}"]
7 -> 8 [label = "t_9:{join_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 constant_4 broadcast_to_5 Greater_6 filter_7 publish_result_8]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, ta.plain_datetime_0 from alice.tbl_0 as ta right join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 where ta.plain_datetime_0 between '2025-04-23 12:25:42' and '2025-05-29 15:36:36'`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.plain_datetime_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_15,},RightJoinIndex:{t_16,},],attr:[input_party_codes:[alice bob],join_type:2,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_15,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="constant:{in:[],out:[Out:{t_6,},],attr:[scalar:2025-04-23 12:25:42,to_status:1,],party:[alice,bob,]}"]
5 [label="make_private:{in:[In:{t_6,},],out:[Out:{t_17,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
6 [label="Cast:{in:[In:{t_17,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
7 [label="GreaterEqual:{in:[Left:{t_5,},Right:{t_7,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
8 [label="constant:{in:[],out:[Out:{t_9,},],attr:[scalar:2025-05-29 15:36:36,to_status:1,],party:[alice,bob,]}"]
9 [label="make_private:{in:[In:{t_9,},],out:[Out:{t_18,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
10 [label="Cast:{in:[In:{t_18,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
11 [label="LessEqual:{in:[Left:{t_5,},Right:{t_10,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
12 [label="LogicalAnd:{in:[Left:{t_8,},Right:{t_11,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
13 [label="filter:{in:[Filter:{t_12,},In:{t_4,t_5,},],out:[Out:{t_13,t_14,},],attr:[],party:[alice,]}"]
14 [label="publish_result:{in:[In:{t_13,t_14,},],out:[Out:{t_19,t_20,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{plain_datetime_0:PRIVATE:DATETIME}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_10:{plain_datetime_0:PRIVATE:DATETIME}"]
11 -> 12 [label = "t_11:{le_out:PRIVATE:BOOL}"]
12 -> 13 [label = "t_12:{and_out:PRIVATE:BOOL}"]
13 -> 14 [label = "t_13:{join_int_0:PRIVATE:INT64}"]
13 -> 14 [label = "t_14:{plain_datetime_0:PRIVATE:DATETIME}"]
2 -> 3 [label = "t_15:{left_index:PRIVATE:INT64}"]
3 -> 11 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
3 -> 13 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
3 -> 13 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
3 -> 7 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
4 -> 5 [label = "t_6:{constant_data:PUBLIC:STRING}"]
5 -> 6 [label = "t_17:{constant_data:PRIVATE:STRING}"]
6 -> 7 [label = "t_7:{plain_datetime_0:PRIVATE:DATETIME}"]
7 -> 12 [label = "t_8:{ge_out:PRIVATE:BOOL}"]
8 -> 9 [label = "t_9:{constant_data:PUBLIC:STRING}"]
9 -> 10 [label = "t_18:{constant_data:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 constant_4 make_private_5 Cast_6 GreaterEqual_7 constant_8 make_private_9 Cast_10 LessEqual_11 LogicalAnd_12 filter_13 publish_result_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, ta.plain_datetime_0 from alice.tbl_0 as ta right join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 where ta.plain_datetime_0 > '2025-04-23 12:25:42'`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.plain_datetime_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{t_12,},],attr:[input_party_codes:[alice bob],join_type:2,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_11,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="constant:{in:[],out:[Out:{t_6,},],attr:[scalar:2025-04-23 12:25:42,to_status:1,],party:[alice,bob,]}"]
5 [label="make_private:{in:[In:{t_6,},],out:[Out:{t_13,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
6 [label="Cast:{in:[In:{t_13,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
7 [label="Greater:{in:[Left:{t_5,},Right:{t_7,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
8 [label="filter:{in:[Filter:{t_8,},In:{t_4,t_5,},],out:[Out:{t_9,t_10,},],attr:[],party:[alice,]}"]
9 [label="publish_result:{in:[In:{t_9,t_10,},],out:[Out:{t_14,t_15,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{plain_datetime_0:PRIVATE:DATETIME}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_11:{left_index:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
3 -> 8 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_5:{plain_datetime_0:PRIVATE:DATETIME}"]
4 -> 5 [label = "t_6:{constant_data:PUBLIC:STRING}"]
5 -> 6 [label = "t_13:{constant_data:PRIVATE:STRING}"]
6 -> 7 [label = "t_7:{plain_datetime_0:PRIVATE:DATETIME}"]
7 -> 8 [label = "t_8:{gt_out:PRIVATE:BOOL}"]
8 -> 9 [label = "t_10:{plain_datetime_0:PRIVATE:DATETIME}"]
8 -> 9 [label = "t_9:{join_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 constant_4 make_private_5 Cast_6 Greater_7 filter_8 publish_result_9]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT PERCENTILE_DISC(u.int_0, 0.3) AS _30percent FROM (SELECT ta.plain_int_0 as int_0 FROM alice.tbl_0 AS ta UNION ALL SELECT tb.plain_int_0 as int_0 FROM bob.tbl_0 AS tb) as u`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_1,},],out:[Out:{t_5,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_2,},],out:[Out:{t_6,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_5,t_6,},],out:[Out:{t_3,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="make_private:{in:[In:{t_3,},],out:[Out:{t_7,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
6 [label="reduce[percentile_disc]:{in:[In:{t_7,},],out:[Out:{t_4,},],attr:[percent:0.3,],party:[alice,]}"]
7 [label="publish_result:{in:[In:{t_4,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
2 -> 4 [label = "t_5:{plain_int_0:SECRET:INT64}"]
3 -> 4 [label = "t_6:{plain_int_0:SECRET:INT64}"]
4 -> 5 [label = "t_3:{plain_int_0:SECRET:INT64}"]
5 -> 6 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
6 -> 7 [label = "t_4:{plain_int_0_percentile_disc:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 make_share_2 make_share_3 concat_4 make_private_5 reduce[percentile_disc]_6 publish_result_7]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT PERCENTILE_DISC(ta.plain_int_0, 0.3) AS _30percent_plain_int FROM alice.tbl_0 AS ta JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_6,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_6,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="reduce[percentile_disc]:{in:[In:{t_4,},],out:[Out:{t_5,},],attr:[percent:0.3,],party:[alice,]}"]
5 [label="publish_result:{in:[In:{t_5,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_6:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_5:{plain_int_0_percentile_disc:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 reduce[percentile_disc]_4 publish_result_5]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.groupby_string_0,tb.groupby_string_0, percentile_disc(ta.aggregate_int_0, 0.5) _50percent from alice.tbl_0 AS ta JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0 group by ta.groupby_string_0,tb.groupby_string_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,},],attr:[sql:select ta.join_int_0,ta.aggregate_int_0,ta.groupby_string_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,t_5,},],attr:[sql:select 'tb'.'join_int_0','tb'.'groupby_string_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_4,},],out:[LeftJoinIndex:{t_20,},RightJoinIndex:{t_21,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,t_3,},RowsIndexFilter:{t_20,},],out:[Out:{t_6,t_7,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_21,},],out:[Out:{t_8,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_23,},],attr:[],party:[alice,bob,]}"]
7 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_24,},],attr:[],party:[alice,bob,]}"]
8 [label="sort:{in:[In:{t_22,t_23,t_24,t_22,t_23,},Key:{t_22,t_23,},],out:[Out:{t_25,t_26,t_27,t_28,t_29,},],attr:[reverse:[false false],],party:[alice,bob,]}"]
9 [label="oblivious_group_mark:{in:[Key:{t_25,t_26,},],out:[Group:{t_30,},],attr:[],party:[alice,bob,]}"]
10 [label="count:{in:[Group:{t_30,},In:{t_30,},],out:[Out:{t_31,},],attr:[],party:[alice,bob,]}"]
11 [label="sort:{in:[In:{t_27,},Key:{t_25,t_26,t_27,},],out:[Out:{t_32,},],attr:[reverse:[false false false],],party:[alice,bob,]}"]
12 [label="percentile_disc:{in:[Group:{t_30,},In:{t_32,},],out:[Out:{t_33,},],attr:[percent:0.5,],party:[alice,bob,]}"]
13 [label="shuffle:{in:[In:{t_31,t_33,t_28,t_29,t_30,},],out:[Out:{t_34,t_35,t_36,t_37,t_38,},],attr:[],party:[alice,bob,]}"]
14 [label="make_public:{in:[In:{t_38,},],out:[Out:{t_39,},],attr:[],party:[alice,bob,]}"]
15 [label="filter:{in:[Filter:{t_39,},In:{t_34,t_35,t_36,t_37,},],out:[Out:{t_12,t_9,t_10,t_11,},],attr:[],party:[alice,bob,]}"]
16 [label="constant:{in:[],out:[Out:{t_13,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
17 [label="broadcast_to:{in:[In:{t_13,},ShapeRefTensor:{t_12,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
18 [label="GreaterEqual:{in:[Left:{t_12,},Right:{t_14,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,]}"]
19 [label="make_public:{in:[In:{t_15,},],out:[Out:{t_40,},],attr:[],party:[alice,bob,]}"]
20 [label="filter:{in:[Filter:{t_40,},In:{t_9,t_10,t_11,t_12,},],out:[Out:{t_16,t_17,t_18,t_19,},],attr:[],party:[alice,bob,]}"]
21 [label="make_public:{in:[In:{t_17,},],out:[Out:{t_41,},],attr:[],party:[alice,bob,]}"]
22 [label="make_private:{in:[In:{t_41,},],out:[Out:{t_42,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
23 [label="make_public:{in:[In:{t_18,},],out:[Out:{t_43,},],attr:[],party:[alice,bob,]}"]
24 [label="make_private:{in:[In:{t_43,},],out:[Out:{t_44,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
25 [label="make_private:{in:[In:{t_16,},],out:[Out:{t_45,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
26 [label="publish_result:{in:[In:{t_42,t_44,t_45,},],out:[Out:{t_46,t_47,t_48,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{aggregate_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{groupby_string_0:PRIVATE:STRING}"]
1 -> 2 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{groupby_string_0:PRIVATE:STRING}"]
10 -> 13 [label = "t_31:{aggregated_group_simple_count:SECRET:INT64}"]
11 -> 12 [label = "t_32:{aggregate_int_0:SECRET:INT64}"]
12 -> 13 [label = "t_33:{aggregate_int_0_percentile_disc:SECRET:INT64}"]
13 -> 14 [label = "t_38:{group_mark:SECRET:BOOL}"]
13 -> 15 [label = "t_34:{aggregated_group_simple_count:SECRET:INT64}"]
13 -> 15 [label = "t_35:{aggregate_int_0_percentile_disc:SECRET:INT64}"]
13 -> 15 [label = "t_36:{groupby_string_0:SECRET:STRING}"]
13 -> 15 [label = "t_37:{groupby_string_0:SECRET:STRING}"]
14 -> 15 [label = "t_39:{group_mark:PUBLIC:BOOL}"]
15 -> 17 [label = "t_12:{simple_count_result:SECRET:INT64}"]
15 -> 18 [label = "t_12:{simple_count_result:SECRET:INT64}"]
15 -> 20 [label = "t_10:{groupby_string_0_firstrow:SECRET:STRING}"]
15 -> 20 [label = "t_11:{groupby_string_0_firstrow:SECRET:STRING}"]
15 -> 20 [label = "t_12:{simple_count_result:SECRET:INT64}"]
15 -> 20 [label = "t_9:{aggregate_int_0_percentile_disc:SECRET:INT64}"]
16 -> 17 [label = "t_13:{constant_data:PUBLIC:INT64}"]
17 -> 18 [label = "t_14:{constant_data:PUBLIC:INT64}"]
18 -> 19 [label = "t_15:{ge_out:SECRET:BOOL}"]
19 -> 20 [label = "t_40:{ge_out:PUBLIC:BOOL}"]
2 -> 3 [label = "t_20:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_21:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_17:{groupby_string_0_firstrow:SECRET:STRING}"]
20 -> 23 [label = "t_18:{groupby_string_0_firstrow:SECRET:STRING}"]
20 -> 25 [label = "t_16:{aggregate_int_0_percentile_disc:SECRET:INT64}"]
21 -> 22 [label = "t_41:{groupby_string_0_firstrow:PUBLIC:STRING}"]
22 -> 26 [label = "t_42:{groupby_string_0_firstrow:PRIVATE:STRING}"]
23 -> 24 [label = "t_43:{groupby_string_0_firstrow:PUBLIC:STRING}"]
24 -> 26 [label = "t_44:{groupby_string_0_firstrow:PRIVATE:STRING}"]
25 -> 26 [label = "t_45:{aggregate_int_0_percentile_disc:PRIVATE:INT64}"]
3 -> 5 [label = "t_7:{groupby_string_0:PRIVATE:STRING}"]
3 -> 7 [label = "t_6:{aggregate_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_8:{groupby_string_0:PRIVATE:STRING}"]
5 -> 8 [label = "t_22:{groupby_string_0:SECRET:STRING}"]
5 -> 8 [label = "t_22:{groupby_string_0:SECRET:STRING}"]
5 -> 8 [label = "t_22:{groupby_string_0:SECRET:STRING}"]
6 -> 8 [label = "t_23:{groupby_string_0:SECRET:STRING}"]
6 -> 8 [label = "t_23:{groupby_string_0:SECRET:STRING}"]
6 -> 8 [label = "t_23:{groupby_string_0:SECRET:STRING}"]
7 -> 8 [label = "t_24:{aggregate_int_0:SECRET:INT64}"]
8 -> 11 [label = "t_25:{groupby_string_0:SECRET:STRING}"]
8 -> 11 [label = "t_26:{groupby_string_0:SECRET:STRING}"]
8 -> 11 [label = "t_27:{aggregate_int_0:SECRET:INT64}"]
8 -> 11 [label = "t_27:{aggregate_int_0:SECRET:INT64}"]
8 -> 13 [label = "t_28:{groupby_string_0:SECRET:STRING}"]
8 -> 13 [label = "t_29:{groupby_string_0:SECRET:STRING}"]
8 -> 9 [label = "t_25:{groupby_string_0:SECRET:STRING}"]
8 -> 9 [label = "t_26:{groupby_string_0:SECRET:STRING}"]
9 -> 10 [label = "t_30:{group_mark:SECRET:BOOL}"]
9 -> 10 [label = "t_30:{group_mark:SECRET:BOOL}"]
9 -> 12 [label = "t_30:{group_mark:SECRET:BOOL}"]
9 -> 13 [label = "t_30:{group_mark:SECRET:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 make_share_7 sort_8 oblivious_group_mark_9 count_10 sort_11 percentile_disc_12 shuffle_13 make_public_14 filter_15 constant_16 broadcast_to_17 GreaterEqual_18 make_public_19 filter_20 make_public_21 make_private_22 make_public_23 make_private_24 make_private_25 publish_result_26]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, PERCENTILE_DISC(ta.plain_int_0, 0.3) AS _30percent_plain_int FROM alice.tbl_0 AS ta JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0 GROUP BY ta.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_15,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_15,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="private_group:{in:[Key:{t_5,},],out:[GroupId:{t_16,},GroupNum:{t_17,},],attr:[],party:[alice,]}"]
5 [label="count:{in:[GroupId:{t_16,},GroupNum:{t_17,},In:{t_16,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
6 [label="percentile_disc:{in:[GroupId:{t_16,},GroupNum:{t_17,},In:{t_4,},],out:[Out:{t_6,},],attr:[percent:0.3,],party:[alice,]}"]
7 [label="firstrow:{in:[GroupId:{t_16,},GroupNum:{t_17,},In:{t_5,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
8 [label="constant:{in:[],out:[Out:{t_9,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_9,},ShapeRefTensor:{t_8,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
10 [label="GreaterEqual:{in:[Left:{t_8,},Right:{t_10,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
11 [label="filter:{in:[Filter:{t_11,},In:{t_6,t_7,t_8,},],out:[Out:{t_12,t_13,t_14,},],attr:[],party:[alice,]}"]
12 [label="publish_result:{in:[In:{t_13,t_12,},],out:[Out:{t_18,t_19,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_11:{ge_out:PRIVATE:BOOL}"]
11 -> 12 [label = "t_12:{plain_int_0_percentile_disc:PRIVATE:INT64}"]
11 -> 12 [label = "t_13:{join_int_0_firstrow:PRIVATE:INT64}"]
2 -> 3 [label = "t_15:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_16:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_16:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_17:{group_num:PRIVATE:INT64}"]
4 -> 6 [label = "t_16:{group_id:PRIVATE:INT64}"]
4 -> 6 [label = "t_17:{group_num:PRIVATE:INT64}"]
4 -> 7 [label = "t_16:{group_id:PRIVATE:INT64}"]
4 -> 7 [label = "t_17:{group_num:PRIVATE:INT64}"]
5 -> 10 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
5 -> 11 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
5 -> 9 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
6 -> 11 [label = "t_6:{plain_int_0_percentile_disc:PRIVATE:INT64}"]
7 -> 11 [label = "t_7:{join_int_0_firstrow:PRIVATE:INT64}"]
8 -> 9 [label = "t_9:{constant_data:PUBLIC:INT64}"]
9 -> 10 [label = "t_10:{constant_data:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 private_group_4 count_5 percentile_disc_6 firstrow_7 constant_8 broadcast_to_9 GreaterEqual_10 filter_11 publish_result_12]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0 FROM alice.tbl_0 AS ta JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0 GROUP BY ta.join_int_0 HAVING SUM(ta.plain_int_0) = ANY(SELECT ta.plain_int_0 FROM alice.tbl_0 AS ta)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_18,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_18,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="private_group:{in:[Key:{t_5,},],out:[GroupId:{t_19,},GroupNum:{t_20,},],attr:[],party:[alice,]}"]
5 [label="count:{in:[GroupId:{t_19,},GroupNum:{t_20,},In:{t_19,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
6 [label="sum:{in:[GroupId:{t_19,},GroupNum:{t_20,},In:{t_4,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
7 [label="firstrow:{in:[GroupId:{t_19,},GroupNum:{t_20,},In:{t_5,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
8 [label="constant:{in:[],out:[Out:{t_9,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_9,},ShapeRefTensor:{t_8,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
10 [label="GreaterEqual:{in:[Left:{t_8,},Right:{t_10,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
11 [label="filter:{in:[Filter:{t_11,},In:{t_6,t_7,t_8,},],out:[Out:{t_12,t_13,t_14,},],attr:[],party:[alice,]}"]
12 [label="run_sql:{in:[],out:[Out:{t_15,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
13 [label="in:{in:[Left:{t_12,},Right:{t_15,},],out:[Out:{t_16,},],attr:[in_type:2,input_party_codes:[alice alice],psi_algorithm:0,reveal_to:[alice],],party:[alice,]}"]
14 [label="filter:{in:[Filter:{t_16,},In:{t_13,},],out:[Out:{t_17,},],attr:[],party:[alice,]}"]
15 [label="publish_result:{in:[In:{t_17,},],out:[Out:{t_21,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_11:{ge_out:PRIVATE:BOOL}"]
11 -> 13 [label = "t_12:{plain_int_0_sum:PRIVATE:INT64}"]
11 -> 14 [label = "t_13:{join_int_0_firstrow:PRIVATE:INT64}"]
12 -> 13 [label = "t_15:{plain_int_0:PRIVATE:INT64}"]
13 -> 14 [label = "t_16:{in_result:PRIVATE:BOOL}"]
14 -> 15 [label = "t_17:{join_int_0_firstrow:PRIVATE:INT64}"]
2 -> 3 [label = "t_18:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_19:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_19:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_20:{group_num:PRIVATE:INT64}"]
4 -> 6 [label = "t_19:{group_id:PRIVATE:INT64}"]
4 -> 6 [label = "t_20:{group_num:PRIVATE:INT64}"]
4 -> 7 [label = "t_19:{group_id:PRIVATE:INT64}"]
4 -> 7 [label = "t_20:{group_num:PRIVATE:INT64}"]
5 -> 10 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
5 -> 11 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
5 -> 9 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
6 -> 11 [label = "t_6:{plain_int_0_sum:PRIVATE:INT64}"]
7 -> 11 [label = "t_7:{join_int_0_firstrow:PRIVATE:INT64}"]
8 -> 9 [label = "t_9:{constant_data:PUBLIC:INT64}"]
9 -> 10 [label = "t_10:{constant_data:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 private_group_4 count_5 sum_6 firstrow_7 constant_8 broadcast_to_9 GreaterEqual_10 filter_11 run_sql_12 in_13 filter_14 publish_result_15]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0 FROM alice.tbl_0 AS ta JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0 GROUP BY ta.join_int_0 HAVING SUM(ta.plain_int_0) > ANY(SELECT ta.plain_int_0 FROM alice.tbl_0 AS ta)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_23,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_23,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="private_group:{in:[Key:{t_5,},],out:[GroupId:{t_24,},GroupNum:{t_25,},],attr:[],party:[alice,]}"]
5 [label="count:{in:[GroupId:{t_24,},GroupNum:{t_25,},In:{t_24,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
6 [label="sum:{in:[GroupId:{t_24,},GroupNum:{t_25,},In:{t_4,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
7 [label="firstrow:{in:[GroupId:{t_24,},GroupNum:{t_25,},In:{t_5,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
8 [label="constant:{in:[],out:[Out:{t_9,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_9,},ShapeRefTensor:{t_8,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
10 [label="GreaterEqual:{in:[Left:{t_8,},Right:{t_10,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
11 [label="filter:{in:[Filter:{t_11,},In:{t_6,t_7,t_8,},],out:[Out:{t_12,t_13,t_14,},],attr:[],party:[alice,]}"]
12 [label="run_sql:{in:[],out:[Out:{t_16,},],attr:[sql:select min(ta.plain_int_0) as expr_362 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
13 [label="replicate:{in:[Left:{t_12,t_13,t_14,},Right:{t_16,},],out:[LeftOut:{t_17,t_18,t_19,},RightOut:{t_20,},],attr:[input_party_codes:[alice alice],],party:[alice,alice,]}"]
14 [label="Greater:{in:[Left:{t_17,},Right:{t_20,},],out:[Out:{t_21,},],attr:[],party:[alice,]}"]
15 [label="filter:{in:[Filter:{t_21,},In:{t_18,},],out:[Out:{t_22,},],attr:[],party:[alice,]}"]
16 [label="publish_result:{in:[In:{t_22,},],out:[Out:{t_26,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_11:{ge_out:PRIVATE:BOOL}"]
11 -> 13 [label = "t_12:{plain_int_0_sum:PRIVATE:INT64}"]
11 -> 13 [label = "t_13:{join_int_0_firstrow:PRIVATE:INT64}"]
11 -> 13 [label = "t_14:{simple_count_result:PRIVATE:INT64}"]
12 -> 13 [label = "t_16:{plain_int_0_min:PRIVATE:INT64}"]
13 -> 14 [label = "t_17:{plain_int_0_sum:PRIVATE:INT64}"]
13 -> 14 [label = "t_20:{plain_int_0_min:PRIVATE:INT64}"]
13 -> 15 [label = "t_18:{join_int_0_firstrow:PRIVATE:INT64}"]
14 -> 15 [label = "t_21:{gt_out:PRIVATE:BOOL}"]
15 -> 16 [label = "t_22:{join_int_0_firstrow:PRIVATE:INT64}"]
2 -> 3 [label = "t_23:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_24:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_24:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_25:{group_num:PRIVATE:INT64}"]
4 -> 6 [label = "t_24:{group_id:PRIVATE:INT64}"]
4 -> 6 [label = "t_25:{group_num:PRIVATE:INT64}"]
4 -> 7 [label = "t_24:{group_id:PRIVATE:INT64}"]
4 -> 7 [label = "t_25:{group_num:PRIVATE:INT64}"]
5 -> 10 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
5 -> 11 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
5 -> 9 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
6 -> 11 [label = "t_6:{plain_int_0_sum:PRIVATE:INT64}"]
7 -> 11 [label = "t_7:{join_int_0_firstrow:PRIVATE:INT64}"]
8 -> 9 [label = "t_9:{constant_data:PUBLIC:INT64}"]
9 -> 10 [label = "t_10:{constant_data:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 private_group_4 count_5 sum_6 firstrow_7 constant_8 broadcast_to_9 GreaterEqual_10 filter_11 run_sql_12 replicate_13 Greater_14 filter_15 publish_result_16]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, PERCENT_RANK() OVER(PARTITION BY ta.rank_float_0 ORDER BY tb.rank_float_0) as rank_percent FROM alice.tbl_0 AS ta JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.rank_float_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'rank_float_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_10,},RightJoinIndex:{t_11,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_10,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_11,},],out:[Out:{t_7,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_12,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,]}"]
7 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
8 [label="sort:{in:[In:{t_12,t_13,t_14,},Key:{t_12,t_13,},],out:[Out:{t_15,t_16,t_8,},],attr:[reverse:[false false],],party:[alice,bob,]}"]
9 [label="oblivious_group_mark:{in:[Key:{t_15,},],out:[Group:{t_17,},],attr:[],party:[alice,bob,]}"]
10 [label="oblivious_group_mark:{in:[Key:{t_15,t_16,},],out:[Group:{t_18,},],attr:[],party:[alice,bob,]}"]
11 [label="percent_rank:{in:[Group:{t_17,},In:{t_18,},],out:[Out:{t_9,},],attr:[],party:[alice,bob,]}"]
12 [label="make_private:{in:[In:{t_8,},],out:[Out:{t_19,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
13 [label="make_private:{in:[In:{t_9,},],out:[Out:{t_20,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
14 [label="publish_result:{in:[In:{t_19,t_20,},],out:[Out:{t_21,t_22,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{rank_float_0:PRIVATE:FLOAT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{rank_float_0:PRIVATE:FLOAT64}"]
10 -> 11 [label = "t_18:{order_mark:SECRET:BOOL}"]
11 -> 13 [label = "t_9:{percent_rank:SECRET:FLOAT64}"]
12 -> 14 [label = "t_19:{join_int_0:PRIVATE:INT64}"]
13 -> 14 [label = "t_20:{percent_rank:PRIVATE:FLOAT64}"]
2 -> 3 [label = "t_10:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_11:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_6:{rank_float_0:PRIVATE:FLOAT64}"]
3 -> 7 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_7:{rank_float_0:PRIVATE:FLOAT64}"]
5 -> 8 [label = "t_12:{rank_float_0:SECRET:FLOAT64}"]
5 -> 8 [label = "t_12:{rank_float_0:SECRET:FLOAT64}"]
6 -> 8 [label = "t_13:{rank_float_0:SECRET:FLOAT64}"]
6 -> 8 [label = "t_13:{rank_float_0:SECRET:FLOAT64}"]
7 -> 8 [label = "t_14:{join_int_0:SECRET:INT64}"]
8 -> 10 [label = "t_15:{rank_float_0:SECRET:FLOAT64}"]
8 -> 10 [label = "t_16:{rank_float_0:SECRET:FLOAT64}"]
8 -> 12 [label = "t_8:{join_int_0:SECRET:INT64}"]
8 -> 9 [label = "t_15:{rank_float_0:SECRET:FLOAT64}"]
9 -> 11 [label = "t_17:{group_mark:SECRET:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 make_share_7 sort_8 oblivious_group_mark_9 oblivious_group_mark_10 percent_rank_11 make_private_12 make_private_13 publish_result_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, PERCENT_RANK() OVER(PARTITION BY ta.join_int_0 ORDER BY ta.plain_int_0) as rank_percent FROM alice.tbl_0 AS ta JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_8,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_8,},],out:[Out:{t_4,t_5,},],attr:[],party:[alice,]}"]
4 [label="private_group:{in:[Key:{t_5,},],out:[GroupId:{t_9,},GroupNum:{t_10,},],attr:[],party:[alice,]}"]
5 [label="PercentRank:{in:[Key:{t_4,},PartitionId:{t_9,},PartitionNum:{t_10,},],out:[Out:{t_7,},],attr:[reverse:[0],],party:[alice,]}"]
6 [label="publish_result:{in:[In:{t_5,t_7,},],out:[Out:{t_11,t_12,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_8:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_10:{window_group_num:PRIVATE:INT64}"]
4 -> 5 [label = "t_9:{window_group_id:PRIVATE:INT64}"]
5 -> 6 [label = "t_7:{percent_rank:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 private_group_4 PercentRank_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0 FROM
		alice.tbl_0 AS ta INNER JOIN bob.tbl_0 AS tb
		ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_4,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_4,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select alice.plain_int_0 from alice.tbl_0 as alice join bob.tbl_0 as bob on alice.join_int_0 = bob.join_int_0 where alice.join_string_0 is null`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_5,t_6,},],attr:[sql:select alice.plain_int_0,alice.join_int_0 from alice.tbl_0 as alice where alice.join_string_0 is null;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_7,},],attr:[sql:select 'bob'.'join_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_6,},Right:{t_7,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_9,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_8,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_6:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_7:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.plain_int_0 FROM alice.tbl_0 AS ta INNER JOIN bob.tbl_0 AS tb ON ta.join_int_0 = tb.join_int_0 where ta.plain_int_0 > tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{t_10,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_9,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,},RowsIndexFilter:{t_10,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_6,},],out:[Out:{t_11,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="Greater:{in:[Left:{t_5,},Right:{t_11,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
7 [label="filter:{in:[Filter:{t_7,},In:{t_5,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
8 [label="publish_result:{in:[In:{t_8,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_10:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
6 -> 7 [label = "t_7:{gt_out:PRIVATE:BOOL}"]
7 -> 8 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 Greater_6 filter_7 publish_result_8]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.plain_int_0 FROM alice.tbl_0 as ta WHERE ta.plain_int_0 = ANY(SELECT ta.plain_int_0 + ta.plain_int_1 + 1 FROM alice.tbl_0 AS ta INNER JOIN bob.tbl_0 AS tb ON ta.plain_int_0 = tb.plain_int_0)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,t_3,},],attr:[sql:select ta.plain_int_0,ta.plain_int_1 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
2 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
3 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_13,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
4 [label="filter_by_index:{in:[Data:{t_2,t_3,},RowsIndexFilter:{t_13,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
5 [label="Add:{in:[Left:{t_5,},Right:{t_6,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
6 [label="constant:{in:[],out:[Out:{t_8,},],attr:[scalar:1,to_status:1,],party:[alice,bob,]}"]
7 [label="broadcast_to:{in:[In:{t_8,},ShapeRefTensor:{t_7,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
8 [label="Add:{in:[Left:{t_7,},Right:{t_9,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
9 [label="in:{in:[Left:{t_1,},Right:{t_10,},],out:[Out:{t_11,},],attr:[in_type:2,input_party_codes:[alice alice],psi_algorithm:0,reveal_to:[alice],],party:[alice,]}"]
10 [label="filter:{in:[Filter:{t_11,},In:{t_1,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
11 [label="publish_result:{in:[In:{t_12,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
0 -> 10 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 9 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{plain_int_1:PRIVATE:INT64}"]
10 -> 11 [label = "t_12:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_13:{left_index:PRIVATE:INT64}"]
4 -> 5 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_6:{plain_int_1:PRIVATE:INT64}"]
5 -> 7 [label = "t_7:{plus_out:PRIVATE:INT64}"]
5 -> 8 [label = "t_7:{plus_out:PRIVATE:INT64}"]
6 -> 7 [label = "t_8:{constant_data:PUBLIC:INT64}"]
7 -> 8 [label = "t_9:{constant_data:PRIVATE:INT64}"]
8 -> 9 [label = "t_10:{plus_out:PRIVATE:INT64}"]
9 -> 10 [label = "t_11:{in_result:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 run_sql_2 psi_join_3 filter_by_index_4 Add_5 constant_6 broadcast_to_7 Add_8 in_9 filter_10 publish_result_11]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.plain_int_0 FROM alice.tbl_0 as ta WHERE ta.plain_int_0 > (SELECT AVG(ta.plain_int_0) + SUM(ta.plain_int_1) + 1 FROM alice.tbl_0 AS ta INNER JOIN bob.tbl_0 AS tb ON ta.plain_int_0 = tb.plain_int_0)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,t_3,},],attr:[sql:select ta.plain_int_0,ta.plain_int_1 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
2 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
3 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_17,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
4 [label="filter_by_index:{in:[Data:{t_2,t_3,},RowsIndexFilter:{t_17,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
5 [label="reduce[avg]:{in:[In:{t_5,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
6 [label="reduce[sum]:{in:[In:{t_6,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
7 [label="Add:{in:[Left:{t_7,},Right:{t_8,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
8 [label="constant:{in:[],out:[Out:{t_10,},],attr:[scalar:1,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_10,},ShapeRefTensor:{t_9,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
10 [label="Add:{in:[Left:{t_9,},Right:{t_11,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
11 [label="replicate:{in:[Left:{t_1,},Right:{t_12,},],out:[LeftOut:{t_13,},RightOut:{t_14,},],attr:[input_party_codes:[alice alice],],party:[alice,alice,]}"]
12 [label="Greater:{in:[Left:{t_13,},Right:{t_14,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
13 [label="filter:{in:[Filter:{t_15,},In:{t_13,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
14 [label="publish_result:{in:[In:{t_16,},],out:[Out:{t_18,},],attr:[],party:[alice,]}"]
0 -> 11 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{plain_int_1:PRIVATE:INT64}"]
10 -> 11 [label = "t_12:{plus_out:PRIVATE:FLOAT64}"]
11 -> 12 [label = "t_13:{plain_int_0:PRIVATE:INT64}"]
11 -> 12 [label = "t_14:{plus_out:PRIVATE:FLOAT64}"]
11 -> 13 [label = "t_13:{plain_int_0:PRIVATE:INT64}"]
12 -> 13 [label = "t_15:{gt_out:PRIVATE:BOOL}"]
13 -> 14 [label = "t_16:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_17:{left_index:PRIVATE:INT64}"]
4 -> 5 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_6:{plain_int_1:PRIVATE:INT64}"]
5 -> 7 [label = "t_7:{plain_int_0_avg:PRIVATE:FLOAT64}"]
6 -> 7 [label = "t_8:{plain_int_1_sum:PRIVATE:INT64}"]
7 -> 10 [label = "t_9:{plus_out:PRIVATE:FLOAT64}"]
7 -> 9 [label = "t_9:{plus_out:PRIVATE:FLOAT64}"]
8 -> 9 [label = "t_10:{constant_data:PUBLIC:INT64}"]
9 -> 10 [label = "t_11:{constant_data:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 run_sql_2 psi_join_3 filter_by_index_4 reduce[avg]_5 reduce[sum]_6 Add_7 constant_8 broadcast_to_9 Add_10 replicate_11 Greater_12 filter_13 publish_result_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	// TODO: fix case 26 and 27
	// Case 26 skipped due to compilation error: [OperatorGraphPass] failed: failed to build operator graph: buildLogicalProjection: setLPResultTable: checkLPResultTable: tensor greatest_out.15 type(=TIMESTAMP) doesn't match scheme type(=STRING)
	{`SELECT GREATEST(ta.plain_int_0, tb.plain_float_0), LEAST(ta.plain_int_0, tb.plain_int_0), GREATEST(ta.plain_timestamp_0, tb.plain_timestamp_0) FROM alice.tbl_0 as ta INNER JOIN bob.tbl_0 as tb ON ta.join_int_0 = tb.join_int_0`, ``, ``, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	// Case 27 skipped due to compilation error: [OperatorGraphPass] failed: failed to build operator graph: buildLogicalProjection: setLPResultTable: checkLPResultTable: tensor pow_out.9 type(=INT64) doesn't match scheme type(=FLOAT64)
	{`SELECT POW(ta.plain_int_0, 2) as pow_2_int, POW(ta.plain_float_0, 3) as pow_3_float  FROM
	alice.tbl_0 AS ta INNER JOIN bob.tbl_0 AS tb
	ON ta.join_int_0 = tb.join_int_0`, ``, ``, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ATAN2(ta.plain_int_0, tb.plain_int_0) as atan2_plain_int FROM
	alice.tbl_0 AS ta INNER JOIN bob.tbl_0 AS tb
	ON ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_8,},RightJoinIndex:{t_9,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_8,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,},RowsIndexFilter:{t_9,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_6,},],out:[Out:{t_10,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="ATan2:{in:[Left:{t_5,},Right:{t_10,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
7 [label="publish_result:{in:[In:{t_7,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_8:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_9:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_10:{plain_int_0:PRIVATE:INT64}"]
6 -> 7 [label = "t_7:{atan2_out:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 ATan2_6 publish_result_7]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`SELECT ta.join_int_0, TAN(ta.plain_int_0) AS tan_plain_int_0, TAN(ta.plain_float_0) AS tan_plain_float_0,
	COT(ta.plain_int_0) AS cot_plain_int_0, COT(ta.plain_float_0) AS cot_plain_float_0,
	ASIN(ta.plain_int_0) AS asin_plain_int_0, ASIN(ta.plain_float_0) AS asin_plain_float_0,
	ATAN(ta.plain_int_0) AS atan_plain_int_0, ATAN(ta.plain_float_0) AS atan_plain_float_0
		FROM alice.tbl_0 as ta INNER JOIN bob.tbl_0 as tb
		ON ta.join_int_0 = tb.join_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,},],attr:[sql:select ta.plain_int_0,ta.join_int_0,ta.plain_float_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_22,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,t_3,},RowsIndexFilter:{t_22,},],out:[Out:{t_5,t_6,t_7,},],attr:[],party:[alice,]}"]
4 [label="Tan:{in:[In:{t_5,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
5 [label="Tan:{in:[In:{t_7,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
6 [label="Tan:{in:[In:{t_5,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
7 [label="constant:{in:[],out:[Out:{t_11,},],attr:[scalar:1,to_status:1,],party:[alice,bob,]}"]
8 [label="broadcast_to:{in:[In:{t_11,},ShapeRefTensor:{t_10,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
9 [label="Div:{in:[Left:{t_12,},Right:{t_10,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
10 [label="Tan:{in:[In:{t_7,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
11 [label="constant:{in:[],out:[Out:{t_15,},],attr:[scalar:1,to_status:1,],party:[alice,bob,]}"]
12 [label="broadcast_to:{in:[In:{t_15,},ShapeRefTensor:{t_14,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
13 [label="Div:{in:[Left:{t_16,},Right:{t_14,},],out:[Out:{t_17,},],attr:[],party:[alice,]}"]
14 [label="ASin:{in:[In:{t_5,},],out:[Out:{t_18,},],attr:[],party:[alice,]}"]
15 [label="ASin:{in:[In:{t_7,},],out:[Out:{t_19,},],attr:[],party:[alice,]}"]
16 [label="ATan:{in:[In:{t_5,},],out:[Out:{t_20,},],attr:[],party:[alice,]}"]
17 [label="ATan:{in:[In:{t_7,},],out:[Out:{t_21,},],attr:[],party:[alice,]}"]
18 [label="publish_result:{in:[In:{t_6,t_8,t_9,t_13,t_17,t_18,t_19,t_20,t_21,},],out:[Out:{t_23,t_24,t_25,t_26,t_27,t_28,t_29,t_30,t_31,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{plain_float_0:PRIVATE:FLOAT64}"]
1 -> 2 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
10 -> 12 [label = "t_14:{tan_out:PRIVATE:FLOAT64}"]
10 -> 13 [label = "t_14:{tan_out:PRIVATE:FLOAT64}"]
11 -> 12 [label = "t_15:{constant_data:PUBLIC:INT64}"]
12 -> 13 [label = "t_16:{constant_data:PRIVATE:INT64}"]
13 -> 18 [label = "t_17:{div_out:PRIVATE:FLOAT64}"]
14 -> 18 [label = "t_18:{asin_out:PRIVATE:FLOAT64}"]
15 -> 18 [label = "t_19:{asin_out:PRIVATE:FLOAT64}"]
16 -> 18 [label = "t_20:{atan_out:PRIVATE:FLOAT64}"]
17 -> 18 [label = "t_21:{atan_out:PRIVATE:FLOAT64}"]
2 -> 3 [label = "t_22:{left_index:PRIVATE:INT64}"]
3 -> 10 [label = "t_7:{plain_float_0:PRIVATE:FLOAT64}"]
3 -> 14 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
3 -> 15 [label = "t_7:{plain_float_0:PRIVATE:FLOAT64}"]
3 -> 16 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
3 -> 17 [label = "t_7:{plain_float_0:PRIVATE:FLOAT64}"]
3 -> 18 [label = "t_6:{join_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_7:{plain_float_0:PRIVATE:FLOAT64}"]
3 -> 6 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 18 [label = "t_8:{tan_out:PRIVATE:FLOAT64}"]
5 -> 18 [label = "t_9:{tan_out:PRIVATE:FLOAT64}"]
6 -> 8 [label = "t_10:{tan_out:PRIVATE:FLOAT64}"]
6 -> 9 [label = "t_10:{tan_out:PRIVATE:FLOAT64}"]
7 -> 8 [label = "t_11:{constant_data:PUBLIC:INT64}"]
8 -> 9 [label = "t_12:{constant_data:PRIVATE:INT64}"]
9 -> 18 [label = "t_13:{div_out:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 Tan_4 Tan_5 Tan_6 constant_7 broadcast_to_8 Div_9 Tan_10 constant_11 broadcast_to_12 Div_13 ASin_14 ASin_15 ATan_16 ATan_17 publish_result_18]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.join_int_0, ta.aggregate_string_0, tu.plain_float_0 from alice.tbl_0 as ta inner join (select tb.join_int_0, tb.plain_float_0 from bob.tbl_0 as tb union all select tc.join_int_0, tc.plain_float_0 from carol.tbl_0 as tc) as tu on ta.join_int_0=tu.join_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.aggregate_string_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'plain_float_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="run_sql:{in:[],out:[Out:{t_5,t_6,},],attr:[sql:select tc.join_int_0,tc.plain_float_0 from carol.tbl_0 as tc;,table_refs:[carol.tbl_0],],party:[carol,]}"]
3 [label="make_share:{in:[In:{t_3,},],out:[Out:{t_12,},],attr:[],party:[alice,bob,carol,]}"]
4 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,carol,]}"]
5 [label="concat:{in:[In:{t_12,t_13,},],out:[Out:{t_7,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
6 [label="make_share:{in:[In:{t_4,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,carol,]}"]
7 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,carol,]}"]
8 [label="concat:{in:[In:{t_14,t_15,},],out:[Out:{t_8,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
9 [label="make_share:{in:[In:{t_1,},],out:[Out:{t_16,},],attr:[],party:[alice,bob,carol,]}"]
10 [label="make_share:{in:[In:{t_2,},],out:[Out:{t_17,},],attr:[],party:[alice,bob,carol,]}"]
11 [label="secret_eq_join:{in:[Left:{t_16,t_17,},LeftKey:{t_16,},Right:{t_8,},RightKey:{t_7,},],out:[LeftOutput:{t_9,t_10,},RightOutput:{t_11,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="make_private:{in:[In:{t_9,},],out:[Out:{t_18,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
13 [label="make_public:{in:[In:{t_10,},],out:[Out:{t_19,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_private:{in:[In:{t_19,},],out:[Out:{t_20,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
15 [label="make_private:{in:[In:{t_11,},],out:[Out:{t_21,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
16 [label="publish_result:{in:[In:{t_18,t_20,t_21,},],out:[Out:{t_22,t_23,t_24,},],attr:[],party:[alice,]}"]
0 -> 10 [label = "t_2:{aggregate_string_0:PRIVATE:STRING}"]
0 -> 9 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 6 [label = "t_4:{plain_float_0:PRIVATE:FLOAT64}"]
10 -> 11 [label = "t_17:{aggregate_string_0:SECRET:STRING}"]
11 -> 12 [label = "t_9:{join_int_0:SECRET:INT64}"]
11 -> 13 [label = "t_10:{aggregate_string_0:SECRET:STRING}"]
11 -> 15 [label = "t_11:{plain_float_0:SECRET:FLOAT64}"]
12 -> 16 [label = "t_18:{join_int_0:PRIVATE:INT64}"]
13 -> 14 [label = "t_19:{aggregate_string_0:PUBLIC:STRING}"]
14 -> 16 [label = "t_20:{aggregate_string_0:PRIVATE:STRING}"]
15 -> 16 [label = "t_21:{plain_float_0:PRIVATE:FLOAT64}"]
2 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
2 -> 7 [label = "t_6:{plain_float_0:PRIVATE:FLOAT64}"]
3 -> 5 [label = "t_12:{join_int_0:SECRET:INT64}"]
4 -> 5 [label = "t_13:{join_int_0:SECRET:INT64}"]
5 -> 11 [label = "t_7:{join_int_0:SECRET:INT64}"]
6 -> 8 [label = "t_14:{plain_float_0:SECRET:FLOAT64}"]
7 -> 8 [label = "t_15:{plain_float_0:SECRET:FLOAT64}"]
8 -> 11 [label = "t_8:{plain_float_0:SECRET:FLOAT64}"]
9 -> 11 [label = "t_16:{join_int_0:SECRET:INT64}"]
9 -> 11 [label = "t_16:{join_int_0:SECRET:INT64}"]
}`, ``, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select ta.plain_int_0, ta.plain_int_0 in (select tb.plain_int_0 from bob.tbl_0 as tb) from alice.tbl_0 as ta`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="copy:{in:[In:{t_2,},],out:[Out:{t_4,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
3 [label="in:{in:[Left:{t_1,},Right:{t_4,},],out:[Out:{t_3,},],attr:[in_type:2,input_party_codes:[alice alice],psi_algorithm:0,reveal_to:[alice],],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_1,t_3,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 4 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{in_result:PRIVATE:BOOL}"]
}`, `Batched pipeline with 2 nodes`, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select ta.plain_int_0 from alice.tbl_0 as ta where ta.plain_int_0 in (select tb.plain_int_0 from bob.tbl_0 as tb)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="copy:{in:[In:{t_2,},],out:[Out:{t_5,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
3 [label="in:{in:[Left:{t_1,},Right:{t_5,},],out:[Out:{t_3,},],attr:[in_type:2,input_party_codes:[alice alice],psi_algorithm:0,reveal_to:[alice],],party:[alice,]}"]
4 [label="filter:{in:[Filter:{t_3,},In:{t_1,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
5 [label="publish_result:{in:[In:{t_4,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 4 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{in_result:PRIVATE:BOOL}"]
4 -> 5 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
}`, `Batched pipeline with 3 nodes`, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select ta.plain_int_0 in (select tb.plain_int_0 from bob.tbl_0 as tb) and ta.plain_int_1 in (select tb.plain_int_1 from bob.tbl_0 as tb) from alice.tbl_0 as ta`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.plain_int_1 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="copy:{in:[In:{t_3,},],out:[Out:{t_8,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
3 [label="in:{in:[Left:{t_1,},Right:{t_8,},],out:[Out:{t_4,},],attr:[in_type:2,input_party_codes:[alice alice],psi_algorithm:0,reveal_to:[alice],],party:[alice,]}"]
4 [label="run_sql:{in:[],out:[Out:{t_5,},],attr:[sql:select 'tb'.'plain_int_1' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
5 [label="copy:{in:[In:{t_5,},],out:[Out:{t_9,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="in:{in:[Left:{t_2,},Right:{t_9,},],out:[Out:{t_6,},],attr:[in_type:2,input_party_codes:[alice alice],psi_algorithm:0,reveal_to:[alice],],party:[alice,]}"]
7 [label="LogicalAnd:{in:[Left:{t_4,},Right:{t_6,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
8 [label="publish_result:{in:[In:{t_7,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 6 [label = "t_2:{plain_int_1:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_4:{in_result:PRIVATE:BOOL}"]
4 -> 5 [label = "t_5:{plain_int_1:PRIVATE:INT64}"]
5 -> 6 [label = "t_9:{plain_int_1:PRIVATE:INT64}"]
6 -> 7 [label = "t_6:{in_result:PRIVATE:BOOL}"]
7 -> 8 [label = "t_7:{and_out:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 copy_2 in_3 run_sql_4 copy_5 in_6 LogicalAnd_7 publish_result_8]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select if(ta.plain_float_0, -1.0, -ta.plain_float_0) as res from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.plain_float_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_11,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="constant:{in:[],out:[Out:{t_5,},],attr:[scalar:-1,to_status:1,],party:[alice,bob,]}"]
5 [label="constant:{in:[],out:[Out:{t_6,},],attr:[scalar:0,to_status:1,],party:[alice,bob,]}"]
6 [label="broadcast_to:{in:[In:{t_6,},ShapeRefTensor:{t_4,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
7 [label="Minus:{in:[Left:{t_7,},Right:{t_4,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
8 [label="broadcast_to:{in:[In:{t_5,},ShapeRefTensor:{t_8,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
9 [label="if:{in:[Condition:{t_4,},ValueIfFalse:{t_8,},ValueIfTrue:{t_9,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
10 [label="publish_result:{in:[In:{t_10,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{plain_float_0:PRIVATE:FLOAT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_11:{left_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{plain_float_0:PRIVATE:FLOAT64}"]
3 -> 7 [label = "t_4:{plain_float_0:PRIVATE:FLOAT64}"]
3 -> 9 [label = "t_4:{plain_float_0:PRIVATE:FLOAT64}"]
4 -> 8 [label = "t_5:{constant_data:PUBLIC:FLOAT64}"]
5 -> 6 [label = "t_6:{constant_data:PUBLIC:INT64}"]
6 -> 7 [label = "t_7:{constant_data:PRIVATE:INT64}"]
7 -> 8 [label = "t_8:{minus_out:PRIVATE:FLOAT64}"]
7 -> 9 [label = "t_8:{minus_out:PRIVATE:FLOAT64}"]
8 -> 9 [label = "t_9:{constant_data:PRIVATE:FLOAT64}"]
9 -> 10 [label = "t_10:{if_out:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 constant_4 constant_5 broadcast_to_6 Minus_7 broadcast_to_8 if_9 publish_result_10]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`(SELECT count(alice.groupby_int_1) as test1 FROM alice.tbl_0 as alice WHERE alice.groupby_int_0 >= 0 GROUP BY alice.groupby_int_1 HAVING test1 > 0  limit 3) union all (select count(bob.groupby_int_0) as test1 FROM bob.tbl_0 as bob WHERE bob.groupby_int_0 >= 0  limit 3);`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_13,},],attr:[sql:select t_0.test1 from (select count(alice.groupby_int_1) as test1 from alice.tbl_0 as alice where alice.groupby_int_0>=0 group by alice.groupby_int_1 having (count(alice.groupby_int_1)>0) and (count(alice.groupby_int_1)>=4) limit 3) as t_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_19,},],attr:[sql:select 't_0'.'expr_121' from (select count('bob'.'groupby_int_0') as 'expr_121' from 'bob'.'tbl_0' as 'bob' where 'bob'.'groupby_int_0'>=0 limit 3) as 't_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_13,},],out:[Out:{t_21,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_19,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_21,t_22,},],out:[Out:{t_20,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="make_private:{in:[In:{t_20,},],out:[Out:{t_23,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
6 [label="publish_result:{in:[In:{t_23,},],out:[Out:{t_24,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_13:{simple_count_result:PRIVATE:INT64}"]
1 -> 3 [label = "t_19:{groupby_int_0_count:PRIVATE:INT64}"]
2 -> 4 [label = "t_21:{simple_count_result:SECRET:INT64}"]
3 -> 4 [label = "t_22:{groupby_int_0_count:SECRET:INT64}"]
4 -> 5 [label = "t_20:{simple_count_result:SECRET:INT64}"]
5 -> 6 [label = "t_23:{simple_count_result:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 make_share_2 make_share_3 concat_4 make_private_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`(SELECT alice.groupby_int_1 is not null as c1, coalesce(alice.compare_float_0, alice.plain_float_1) as c2, ifnull(alice.join_string_0, "null") as c3 FROM alice.tbl_0 as alice join bob.tbl_0 as bob on alice.join_string_0=bob.join_string_0);`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,t_4,},],attr:[sql:select alice.compare_float_0,alice.join_string_0,alice.groupby_int_1,alice.plain_float_1 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_5,},],attr:[sql:select 'bob'.'join_string_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_5,},],out:[LeftJoinIndex:{t_16,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,t_3,t_4,},RowsIndexFilter:{t_16,},],out:[Out:{t_6,t_7,t_8,t_9,},],attr:[],party:[alice,]}"]
4 [label="IsNull:{in:[In:{t_8,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
5 [label="Not:{in:[In:{t_10,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
6 [label="coalesce:{in:[Exprs:{t_6,t_9,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
7 [label="constant:{in:[],out:[Out:{t_13,},],attr:[scalar:null,to_status:1,],party:[alice,bob,]}"]
8 [label="broadcast_to:{in:[In:{t_13,},ShapeRefTensor:{t_7,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
9 [label="if_null:{in:[AltValue:{t_14,},Expr:{t_7,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
10 [label="publish_result:{in:[In:{t_11,t_12,t_15,},],out:[Out:{t_17,t_18,t_19,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_1:{compare_float_0:PRIVATE:FLOAT64}"]
0 -> 3 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_3:{groupby_int_1:PRIVATE:INT64}"]
0 -> 3 [label = "t_4:{plain_float_1:PRIVATE:FLOAT64}"]
1 -> 2 [label = "t_5:{join_string_0:PRIVATE:STRING}"]
2 -> 3 [label = "t_16:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_8:{groupby_int_1:PRIVATE:INT64}"]
3 -> 6 [label = "t_6:{compare_float_0:PRIVATE:FLOAT64}"]
3 -> 6 [label = "t_9:{plain_float_1:PRIVATE:FLOAT64}"]
3 -> 8 [label = "t_7:{join_string_0:PRIVATE:STRING}"]
3 -> 9 [label = "t_7:{join_string_0:PRIVATE:STRING}"]
4 -> 5 [label = "t_10:{isnull_out:PRIVATE:BOOL}"]
5 -> 10 [label = "t_11:{not_out:PRIVATE:BOOL}"]
6 -> 10 [label = "t_12:{coalesce_out:PRIVATE:FLOAT64}"]
7 -> 8 [label = "t_13:{constant_data:PUBLIC:STRING}"]
8 -> 9 [label = "t_14:{constant_data:PRIVATE:STRING}"]
9 -> 10 [label = "t_15:{ifnull_out:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 IsNull_4 Not_5 coalesce_6 constant_7 broadcast_to_8 if_null_9 publish_result_10]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`(SELECT lower(alice.join_string_0) as c1, upper(alice.join_string_0) as c2, trim(alice.join_string_0) as c3, concat('prefix', alice.join_string_0, bob.join_string_0, 'suffix') FROM alice.tbl_0 as alice join bob.tbl_0 as bob on alice.join_string_0=bob.join_string_0);`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select alice.join_string_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'bob'.'join_string_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_13,},RightJoinIndex:{t_14,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_13,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_14,},],out:[Out:{t_4,},],attr:[],party:[bob,]}"]
5 [label="arrow_func[utf8_lower]:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[func_name:utf8_lower,],party:[alice,]}"]
6 [label="arrow_func[utf8_upper]:{in:[In:{t_3,},],out:[Out:{t_6,},],attr:[func_name:utf8_upper,],party:[alice,]}"]
7 [label="arrow_func[utf8_trim]:{in:[In:{t_3,},],out:[Out:{t_7,},],attr:[func_name:utf8_trim,func_opt_type:TrimOptions,],party:[alice,]}"]
8 [label="constant:{in:[],out:[Out:{t_8,},],attr:[scalar:prefix,to_status:1,],party:[alice,bob,]}"]
9 [label="constant:{in:[],out:[Out:{t_9,},],attr:[scalar:suffix,to_status:1,],party:[alice,bob,]}"]
10 [label="broadcast_to:{in:[In:{t_8,t_9,},ShapeRefTensor:{t_4,},],out:[Out:{t_10,t_11,},],attr:[],party:[bob,]}"]
11 [label="copy:{in:[In:{t_10,},],out:[Out:{t_15,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
12 [label="copy:{in:[In:{t_4,},],out:[Out:{t_16,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
13 [label="copy:{in:[In:{t_11,},],out:[Out:{t_17,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
14 [label="constant:{in:[],out:[Out:{t_18,},],attr:[scalar:,to_status:1,],party:[alice,bob,]}"]
15 [label="broadcast_to:{in:[In:{t_18,},ShapeRefTensor:{t_15,},],out:[Out:{t_19,},],attr:[],party:[alice,]}"]
16 [label="arrow_func[binary_join_element_wise]:{in:[In:{t_15,t_3,t_16,t_17,t_19,},],out:[Out:{t_12,},],attr:[func_name:binary_join_element_wise,],party:[alice,]}"]
17 [label="publish_result:{in:[In:{t_5,t_6,t_7,t_12,},],out:[Out:{t_20,t_21,t_22,t_23,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_1:{join_string_0:PRIVATE:STRING}"]
1 -> 2 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
1 -> 4 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
10 -> 11 [label = "t_10:{constant_data:PRIVATE:STRING}"]
10 -> 13 [label = "t_11:{constant_data:PRIVATE:STRING}"]
11 -> 15 [label = "t_15:{constant_data:PRIVATE:STRING}"]
11 -> 16 [label = "t_15:{constant_data:PRIVATE:STRING}"]
12 -> 16 [label = "t_16:{join_string_0:PRIVATE:STRING}"]
13 -> 16 [label = "t_17:{constant_data:PRIVATE:STRING}"]
14 -> 15 [label = "t_18:{concat_separator:PUBLIC:STRING}"]
15 -> 16 [label = "t_19:{broadcasted_concat_separator:PRIVATE:STRING}"]
16 -> 17 [label = "t_12:{concat_out:PRIVATE:STRING}"]
2 -> 3 [label = "t_13:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_14:{right_index:PRIVATE:INT64}"]
3 -> 16 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
3 -> 5 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
3 -> 6 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
3 -> 7 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
4 -> 10 [label = "t_4:{join_string_0:PRIVATE:STRING}"]
4 -> 12 [label = "t_4:{join_string_0:PRIVATE:STRING}"]
5 -> 17 [label = "t_5:{lower_out:PRIVATE:STRING}"]
6 -> 17 [label = "t_6:{upper_out:PRIVATE:STRING}"]
7 -> 17 [label = "t_7:{trim_out:PRIVATE:STRING}"]
8 -> 10 [label = "t_8:{constant_data:PUBLIC:STRING}"]
9 -> 10 [label = "t_9:{constant_data:PUBLIC:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 arrow_func[utf8_lower]_5 arrow_func[utf8_upper]_6 arrow_func[utf8_trim]_7 constant_8 constant_9 broadcast_to_10 copy_11 copy_12 copy_13 constant_14 broadcast_to_15 arrow_func[binary_join_element_wise]_16 publish_result_17]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`(SELECT substring(alice.join_string_0, 2) as c1, substring(alice.join_string_0, 1, 1) as c2 FROM alice.tbl_0 as alice join bob.tbl_0 as bob on alice.join_string_0=bob.join_string_0);`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select alice.join_string_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'bob'.'join_string_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_6,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_6,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="arrow_func[utf8_slice_codeunits]:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[func_name:utf8_slice_codeunits,func_opt_type:SliceOptions,],party:[alice,]}"]
5 [label="arrow_func[utf8_slice_codeunits]:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[func_name:utf8_slice_codeunits,func_opt_type:SliceOptions,],party:[alice,]}"]
6 [label="publish_result:{in:[In:{t_4,t_5,},],out:[Out:{t_7,t_8,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_1:{join_string_0:PRIVATE:STRING}"]
1 -> 2 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
2 -> 3 [label = "t_6:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
3 -> 5 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
4 -> 6 [label = "t_4:{substring_out:PRIVATE:STRING}"]
5 -> 6 [label = "t_5:{substring_out:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 arrow_func[utf8_slice_codeunits]_4 arrow_func[utf8_slice_codeunits]_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`(SELECT count(alice.groupby_int_1) as test1 FROM alice.tbl_0 as alice WHERE alice.groupby_int_0 >= 0 GROUP BY alice.groupby_int_1 HAVING test1 > 0  limit 3) union (select count(bob.groupby_int_0) as test1 FROM bob.tbl_0 as bob WHERE bob.groupby_int_0 >= 0  limit 3);`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_14,},],attr:[sql:select any_value(t_0.test1) as expr_244 from (select count(alice.groupby_int_1) as test1 from alice.tbl_0 as alice where alice.groupby_int_0>=0 group by alice.groupby_int_1 having (count(alice.groupby_int_1)>0) and (count(alice.groupby_int_1)>=4) limit 3) as t_0 group by t_0.test1;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_21,},],attr:[sql:select 't_0'.'expr_121' from (select count('bob'.'groupby_int_0') as 'expr_121' from 'bob'.'tbl_0' as 'bob' where 'bob'.'groupby_int_0'>=0 limit 3) as 't_0' group by 't_0'.'expr_121';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_14,},],out:[Out:{t_24,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_21,},],out:[Out:{t_25,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_24,t_25,},],out:[Out:{t_22,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="make_private:{in:[In:{t_22,},],out:[Out:{t_26,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
6 [label="private_group:{in:[Key:{t_26,},],out:[GroupId:{t_27,},GroupNum:{t_28,},],attr:[],party:[alice,]}"]
7 [label="firstrow:{in:[GroupId:{t_27,},GroupNum:{t_28,},In:{t_26,},],out:[Out:{t_23,},],attr:[],party:[alice,]}"]
8 [label="publish_result:{in:[In:{t_23,},],out:[Out:{t_29,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_14:{simple_count_result_firstrow:PRIVATE:INT64}"]
1 -> 3 [label = "t_21:{groupby_int_0_count_firstrow:PRIVATE:INT64}"]
2 -> 4 [label = "t_24:{simple_count_result_firstrow:SECRET:INT64}"]
3 -> 4 [label = "t_25:{groupby_int_0_count_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_22:{simple_count_result_firstrow:SECRET:INT64}"]
5 -> 6 [label = "t_26:{simple_count_result_firstrow:PRIVATE:INT64}"]
5 -> 7 [label = "t_26:{simple_count_result_firstrow:PRIVATE:INT64}"]
6 -> 7 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 7 [label = "t_28:{group_num:PRIVATE:INT64}"]
7 -> 8 [label = "t_23:{simple_count_result_firstrow_firstrow:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 make_share_2 make_share_3 concat_4 make_private_5 private_group_6 firstrow_7 publish_result_8]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select if(ta.plain_int_0, -1, -ta.plain_int_0) as res from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_11,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="constant:{in:[],out:[Out:{t_5,},],attr:[scalar:-1,to_status:1,],party:[alice,bob,]}"]
5 [label="constant:{in:[],out:[Out:{t_6,},],attr:[scalar:0,to_status:1,],party:[alice,bob,]}"]
6 [label="broadcast_to:{in:[In:{t_6,},ShapeRefTensor:{t_4,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
7 [label="Minus:{in:[Left:{t_7,},Right:{t_4,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
8 [label="broadcast_to:{in:[In:{t_5,},ShapeRefTensor:{t_8,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
9 [label="if:{in:[Condition:{t_4,},ValueIfFalse:{t_8,},ValueIfTrue:{t_9,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
10 [label="publish_result:{in:[In:{t_10,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_11:{left_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 9 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
4 -> 8 [label = "t_5:{constant_data:PUBLIC:INT64}"]
5 -> 6 [label = "t_6:{constant_data:PUBLIC:INT64}"]
6 -> 7 [label = "t_7:{constant_data:PRIVATE:INT64}"]
7 -> 8 [label = "t_8:{minus_out:PRIVATE:INT64}"]
7 -> 9 [label = "t_8:{minus_out:PRIVATE:INT64}"]
8 -> 9 [label = "t_9:{constant_data:PRIVATE:INT64}"]
9 -> 10 [label = "t_10:{if_out:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 constant_4 constant_5 broadcast_to_6 Minus_7 broadcast_to_8 if_9 publish_result_10]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(tb.join_string_0) from  alice.tbl_0 as ta inner join bob.tbl_0 as tb on ta.join_string_0=tb.join_string_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.join_string_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'join_string_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{},RightJoinIndex:{t_5,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_5,},],out:[Out:{t_3,},],attr:[],party:[bob,]}"]
4 [label="reduce[count]:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_4,},],out:[Out:{t_6,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="publish_result:{in:[In:{t_6,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_string_0:PRIVATE:STRING}"]
1 -> 2 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
1 -> 3 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
2 -> 3 [label = "t_5:{right_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{join_string_0:PRIVATE:STRING}"]
4 -> 5 [label = "t_4:{join_string_0_count:PRIVATE:INT64}"]
5 -> 6 [label = "t_6:{join_string_0_count:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 reduce[count]_4 copy_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select tt.compare_int_0 > 0 from (select compare_int_0 from alice.tbl_0 UNION select compare_int_0 from bob.tbl_0) as tt;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select any_value(tbl_0.compare_int_0) as expr_243 from alice.tbl_0 group by tbl_0.compare_int_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 'tbl_0'.'compare_int_0' from 'bob'.'tbl_0' group by 'tbl_0'.'compare_int_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_2,},],out:[Out:{t_10,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_4,},],out:[Out:{t_11,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_10,t_11,},],out:[Out:{t_5,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="sort:{in:[In:{t_5,t_5,},Key:{t_5,},],out:[Out:{t_12,t_13,},],attr:[reverse:[false],],party:[alice,bob,]}"]
6 [label="oblivious_group_mark:{in:[Key:{t_12,},],out:[Group:{t_14,},],attr:[],party:[alice,bob,]}"]
7 [label="shuffle:{in:[In:{t_13,t_14,},],out:[Out:{t_15,t_16,},],attr:[],party:[alice,bob,]}"]
8 [label="make_public:{in:[In:{t_16,},],out:[Out:{t_17,},],attr:[],party:[alice,bob,]}"]
9 [label="filter:{in:[Filter:{t_17,},In:{t_15,},],out:[Out:{t_6,},],attr:[],party:[alice,bob,]}"]
10 [label="constant:{in:[],out:[Out:{t_7,},],attr:[scalar:0,to_status:1,],party:[alice,bob,]}"]
11 [label="broadcast_to:{in:[In:{t_7,},ShapeRefTensor:{t_6,},],out:[Out:{t_8,},],attr:[],party:[alice,bob,]}"]
12 [label="Greater:{in:[Left:{t_6,},Right:{t_8,},],out:[Out:{t_9,},],attr:[],party:[alice,bob,]}"]
13 [label="make_private:{in:[In:{t_9,},],out:[Out:{t_18,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
14 [label="publish_result:{in:[In:{t_18,},],out:[Out:{t_19,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{compare_int_0_firstrow:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{compare_int_0_firstrow:PRIVATE:INT64}"]
10 -> 11 [label = "t_7:{constant_data:PUBLIC:INT64}"]
11 -> 12 [label = "t_8:{constant_data:PUBLIC:INT64}"]
12 -> 13 [label = "t_9:{gt_out:SECRET:BOOL}"]
13 -> 14 [label = "t_18:{gt_out:PRIVATE:BOOL}"]
2 -> 4 [label = "t_10:{compare_int_0_firstrow:SECRET:INT64}"]
3 -> 4 [label = "t_11:{compare_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{compare_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{compare_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{compare_int_0_firstrow:SECRET:INT64}"]
5 -> 6 [label = "t_12:{compare_int_0_firstrow:SECRET:INT64}"]
5 -> 7 [label = "t_13:{compare_int_0_firstrow:SECRET:INT64}"]
6 -> 7 [label = "t_14:{group_mark:SECRET:BOOL}"]
7 -> 8 [label = "t_16:{group_mark:SECRET:BOOL}"]
7 -> 9 [label = "t_15:{compare_int_0_firstrow:SECRET:INT64}"]
8 -> 9 [label = "t_17:{group_mark:PUBLIC:BOOL}"]
9 -> 11 [label = "t_6:{compare_int_0_firstrow_firstrow:SECRET:INT64}"]
9 -> 12 [label = "t_6:{compare_int_0_firstrow_firstrow:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 make_share_2 make_share_3 concat_4 sort_5 oblivious_group_mark_6 shuffle_7 make_public_8 filter_9 constant_10 broadcast_to_11 Greater_12 make_private_13 publish_result_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.join_int_0, tb.join_int_0 from (select distinct tbl_0.join_int_0, tbl_0.join_int_1 from alice.tbl_0) as ta join (select distinct tbl_0.join_int_0, tbl_0.join_int_1 from bob.tbl_0) as tb on ta.join_int_0 = tb.join_int_0 and ta.join_int_1 = tb.join_int_1;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select any_value(tbl_0.join_int_0) as expr_2,any_value(tbl_0.join_int_1) as expr_42 from alice.tbl_0 group by tbl_0.join_int_0,tbl_0.join_int_1;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_7,t_8,},],attr:[sql:select 'tbl_0'.'join_int_0','tbl_0'.'join_int_1' from 'bob'.'tbl_0' group by 'tbl_0'.'join_int_0','tbl_0'.'join_int_1';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_3,t_4,},Right:{t_7,t_8,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{t_12,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_3,},RowsIndexFilter:{t_11,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_7,},RowsIndexFilter:{t_12,},],out:[Out:{t_10,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_10,},],out:[Out:{t_13,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="publish_result:{in:[In:{t_9,t_13,},],out:[Out:{t_14,t_15,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_3:{join_int_0_firstrow:PRIVATE:INT64}"]
0 -> 2 [label = "t_4:{join_int_1_firstrow:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{join_int_0_firstrow:PRIVATE:INT64}"]
1 -> 2 [label = "t_7:{join_int_0_firstrow:PRIVATE:INT64}"]
1 -> 2 [label = "t_8:{join_int_1_firstrow:PRIVATE:INT64}"]
1 -> 4 [label = "t_7:{join_int_0_firstrow:PRIVATE:INT64}"]
2 -> 3 [label = "t_11:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_12:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_9:{join_int_0_firstrow:PRIVATE:INT64}"]
4 -> 5 [label = "t_10:{join_int_0_firstrow:PRIVATE:INT64}"]
5 -> 6 [label = "t_13:{join_int_0_firstrow:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.groupby_int_0 from alice.tbl_0 as ta WHERE groupby_int_0>0 UNION (select tb.groupby_int_0 from bob.tbl_0 as tb GROUP BY tb.groupby_int_0);`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_5,},],attr:[sql:select any_value(ta.groupby_int_0) as expr_243 from alice.tbl_0 as ta where ta.groupby_int_0>0 group by ta.groupby_int_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_13,},],attr:[sql:select 't_0'.'groupby_int_0' from (select 'tb'.'groupby_int_0' from 'bob'.'tbl_0' as 'tb' group by 'tb'.'groupby_int_0' having count(1)>=4) as 't_0' group by 't_0'.'groupby_int_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_16,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_13,},],out:[Out:{t_17,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_16,t_17,},],out:[Out:{t_14,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="sort:{in:[In:{t_14,t_14,},Key:{t_14,},],out:[Out:{t_18,t_19,},],attr:[reverse:[false],],party:[alice,bob,]}"]
6 [label="oblivious_group_mark:{in:[Key:{t_18,},],out:[Group:{t_20,},],attr:[],party:[alice,bob,]}"]
7 [label="shuffle:{in:[In:{t_19,t_20,},],out:[Out:{t_21,t_22,},],attr:[],party:[alice,bob,]}"]
8 [label="make_public:{in:[In:{t_22,},],out:[Out:{t_23,},],attr:[],party:[alice,bob,]}"]
9 [label="filter:{in:[Filter:{t_23,},In:{t_21,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,]}"]
10 [label="make_private:{in:[In:{t_15,},],out:[Out:{t_24,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
11 [label="publish_result:{in:[In:{t_24,},],out:[Out:{t_25,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_5:{groupby_int_0_firstrow:PRIVATE:INT64}"]
1 -> 3 [label = "t_13:{groupby_int_0_firstrow_firstrow:PRIVATE:INT64}"]
10 -> 11 [label = "t_24:{groupby_int_0_firstrow_firstrow:PRIVATE:INT64}"]
2 -> 4 [label = "t_16:{groupby_int_0_firstrow:SECRET:INT64}"]
3 -> 4 [label = "t_17:{groupby_int_0_firstrow_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_14:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_14:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_14:{groupby_int_0_firstrow:SECRET:INT64}"]
5 -> 6 [label = "t_18:{groupby_int_0_firstrow:SECRET:INT64}"]
5 -> 7 [label = "t_19:{groupby_int_0_firstrow:SECRET:INT64}"]
6 -> 7 [label = "t_20:{group_mark:SECRET:BOOL}"]
7 -> 8 [label = "t_22:{group_mark:SECRET:BOOL}"]
7 -> 9 [label = "t_21:{groupby_int_0_firstrow:SECRET:INT64}"]
8 -> 9 [label = "t_23:{group_mark:PUBLIC:BOOL}"]
9 -> 10 [label = "t_15:{groupby_int_0_firstrow_firstrow:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 make_share_2 make_share_3 concat_4 sort_5 oblivious_group_mark_6 shuffle_7 make_public_8 filter_9 make_private_10 publish_result_11]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(distinct (if(ta.encrypt_int_0>1, tb.join_string_0, "aa"))) from  alice.tbl_0 as ta inner join bob.tbl_0 as tb on ta.join_string_0=tb.join_string_0 group by tb.groupby_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.encrypt_int_0,ta.join_string_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'groupby_int_0','tb'.'join_string_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_21,},RightJoinIndex:{t_22,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_21,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,t_4,},RowsIndexFilter:{t_22,},],out:[Out:{t_6,t_7,},],attr:[],party:[bob,]}"]
5 [label="constant:{in:[],out:[Out:{t_8,},],attr:[scalar:1,to_status:1,],party:[alice,bob,]}"]
6 [label="broadcast_to:{in:[In:{t_8,},ShapeRefTensor:{t_5,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
7 [label="Greater:{in:[Left:{t_5,},Right:{t_9,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
8 [label="constant:{in:[],out:[Out:{t_11,},],attr:[scalar:aa,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_11,},ShapeRefTensor:{t_7,},],out:[Out:{t_12,},],attr:[],party:[bob,]}"]
10 [label="copy:{in:[In:{t_7,},],out:[Out:{t_23,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
11 [label="copy:{in:[In:{t_12,},],out:[Out:{t_24,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
12 [label="if:{in:[Condition:{t_10,},ValueIfFalse:{t_24,},ValueIfTrue:{t_23,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
13 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_25,},],attr:[],party:[alice,bob,]}"]
14 [label="make_share:{in:[In:{t_13,},],out:[Out:{t_26,},],attr:[],party:[alice,bob,]}"]
15 [label="sort:{in:[In:{t_25,t_26,},Key:{t_25,},],out:[Out:{t_27,t_28,},],attr:[reverse:[false],],party:[alice,bob,]}"]
16 [label="oblivious_group_mark:{in:[Key:{t_27,},],out:[Group:{t_29,},],attr:[],party:[alice,bob,]}"]
17 [label="count:{in:[Group:{t_29,},In:{t_29,},],out:[Out:{t_30,},],attr:[],party:[alice,bob,]}"]
18 [label="sort:{in:[In:{t_28,},Key:{t_27,t_28,},],out:[Out:{t_32,},],attr:[reverse:[false false],],party:[alice,bob,]}"]
19 [label="oblivious_group_mark:{in:[Key:{t_32,},],out:[Group:{t_33,},],attr:[],party:[alice,bob,]}"]
20 [label="LogicalOr:{in:[Left:{t_29,},Right:{t_33,},],out:[Out:{t_34,},],attr:[],party:[alice,bob,]}"]
21 [label="sum:{in:[Group:{t_29,},In:{t_34,},],out:[Out:{t_31,},],attr:[],party:[alice,bob,]}"]
22 [label="shuffle:{in:[In:{t_30,t_31,t_29,},],out:[Out:{t_35,t_36,t_37,},],attr:[],party:[alice,bob,]}"]
23 [label="make_public:{in:[In:{t_37,},],out:[Out:{t_38,},],attr:[],party:[alice,bob,]}"]
24 [label="filter:{in:[Filter:{t_38,},In:{t_35,t_36,},],out:[Out:{t_15,t_14,},],attr:[],party:[alice,bob,]}"]
25 [label="constant:{in:[],out:[Out:{t_16,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
26 [label="broadcast_to:{in:[In:{t_16,},ShapeRefTensor:{t_15,},],out:[Out:{t_17,},],attr:[],party:[alice,bob,]}"]
27 [label="make_private:{in:[In:{t_15,},],out:[Out:{t_39,},],attr:[reveal_to:bob,],party:[alice,bob,]}"]
28 [label="make_private:{in:[In:{t_17,},],out:[Out:{t_40,},],attr:[reveal_to:bob,],party:[alice,bob,]}"]
29 [label="GreaterEqual:{in:[Left:{t_39,},Right:{t_40,},],out:[Out:{t_18,},],attr:[],party:[bob,]}"]
30 [label="make_private:{in:[In:{t_14,},],out:[Out:{t_41,},],attr:[reveal_to:bob,],party:[alice,bob,]}"]
31 [label="filter:{in:[Filter:{t_18,},In:{t_39,t_41,},],out:[Out:{t_20,t_19,},],attr:[],party:[bob,]}"]
32 [label="copy:{in:[In:{t_19,},],out:[Out:{t_42,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
33 [label="publish_result:{in:[In:{t_42,},],out:[Out:{t_43,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_1:{encrypt_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{join_string_0:PRIVATE:STRING}"]
1 -> 4 [label = "t_3:{groupby_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{join_string_0:PRIVATE:STRING}"]
10 -> 12 [label = "t_23:{join_string_0:PRIVATE:STRING}"]
11 -> 12 [label = "t_24:{constant_data:PRIVATE:STRING}"]
12 -> 14 [label = "t_13:{if_out:PRIVATE:STRING}"]
13 -> 15 [label = "t_25:{groupby_int_0:SECRET:INT64}"]
13 -> 15 [label = "t_25:{groupby_int_0:SECRET:INT64}"]
14 -> 15 [label = "t_26:{if_out:SECRET:STRING}"]
15 -> 16 [label = "t_27:{groupby_int_0:SECRET:INT64}"]
15 -> 18 [label = "t_27:{groupby_int_0:SECRET:INT64}"]
15 -> 18 [label = "t_28:{if_out:SECRET:STRING}"]
15 -> 18 [label = "t_28:{if_out:SECRET:STRING}"]
16 -> 17 [label = "t_29:{group_mark:SECRET:BOOL}"]
16 -> 17 [label = "t_29:{group_mark:SECRET:BOOL}"]
16 -> 20 [label = "t_29:{group_mark:SECRET:BOOL}"]
16 -> 21 [label = "t_29:{group_mark:SECRET:BOOL}"]
16 -> 22 [label = "t_29:{group_mark:SECRET:BOOL}"]
17 -> 22 [label = "t_30:{aggregated_group_simple_count:SECRET:INT64}"]
18 -> 19 [label = "t_32:{if_out:SECRET:STRING}"]
19 -> 20 [label = "t_33:{group_mark_distinct:SECRET:BOOL}"]
2 -> 3 [label = "t_21:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_22:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_34:{group_mark_full:SECRET:BOOL}"]
21 -> 22 [label = "t_31:{if_out_count:SECRET:INT64}"]
22 -> 23 [label = "t_37:{group_mark:SECRET:BOOL}"]
22 -> 24 [label = "t_35:{aggregated_group_simple_count:SECRET:INT64}"]
22 -> 24 [label = "t_36:{if_out_count:SECRET:INT64}"]
23 -> 24 [label = "t_38:{group_mark:PUBLIC:BOOL}"]
24 -> 26 [label = "t_15:{simple_count_result:SECRET:INT64}"]
24 -> 27 [label = "t_15:{simple_count_result:SECRET:INT64}"]
24 -> 30 [label = "t_14:{if_out_count:SECRET:INT64}"]
25 -> 26 [label = "t_16:{constant_data:PUBLIC:INT64}"]
26 -> 28 [label = "t_17:{constant_data:PUBLIC:INT64}"]
27 -> 29 [label = "t_39:{simple_count_result:PRIVATE:INT64}"]
27 -> 31 [label = "t_39:{simple_count_result:PRIVATE:INT64}"]
28 -> 29 [label = "t_40:{constant_data:PRIVATE:INT64}"]
29 -> 31 [label = "t_18:{ge_out:PRIVATE:BOOL}"]
3 -> 6 [label = "t_5:{encrypt_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{encrypt_int_0:PRIVATE:INT64}"]
30 -> 31 [label = "t_41:{if_out_count:PRIVATE:INT64}"]
31 -> 32 [label = "t_19:{if_out_count:PRIVATE:INT64}"]
32 -> 33 [label = "t_42:{if_out_count:PRIVATE:INT64}"]
4 -> 10 [label = "t_7:{join_string_0:PRIVATE:STRING}"]
4 -> 13 [label = "t_6:{groupby_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_7:{join_string_0:PRIVATE:STRING}"]
5 -> 6 [label = "t_8:{constant_data:PUBLIC:INT64}"]
6 -> 7 [label = "t_9:{constant_data:PRIVATE:INT64}"]
7 -> 12 [label = "t_10:{gt_out:PRIVATE:BOOL}"]
8 -> 9 [label = "t_11:{constant_data:PUBLIC:STRING}"]
9 -> 11 [label = "t_12:{constant_data:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 constant_5 broadcast_to_6 Greater_7 constant_8 broadcast_to_9 copy_10 copy_11 if_12 make_share_13 make_share_14 sort_15 oblivious_group_mark_16 count_17 sort_18 oblivious_group_mark_19 LogicalOr_20 sum_21 shuffle_22 make_public_23 filter_24 constant_25 broadcast_to_26 make_private_27 make_private_28 GreaterEqual_29 make_private_30 filter_31 copy_32 publish_result_33]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(1) from (select aggregate_int_0 from alice.tbl_0 as ta union select aggregate_int_0 from bob.tbl_0) ua;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select any_value(1) as expr_245,any_value(ta.aggregate_int_0) as expr_241 from alice.tbl_0 as ta group by ta.aggregate_int_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_7,t_8,},],attr:[sql:select 1 as 'expr_245','tbl_0'.'aggregate_int_0' from 'bob'.'tbl_0' group by 'tbl_0'.'aggregate_int_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_3,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_13,t_14,},],out:[Out:{t_9,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="make_share:{in:[In:{t_4,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_16,},],attr:[],party:[alice,bob,]}"]
7 [label="concat:{in:[In:{t_15,t_16,},],out:[Out:{t_10,},],attr:[axis:0,],party:[alice,bob,]}"]
8 [label="sort:{in:[In:{t_10,t_9,},Key:{t_10,},],out:[Out:{t_17,t_18,},],attr:[reverse:[false],],party:[alice,bob,]}"]
9 [label="oblivious_group_mark:{in:[Key:{t_17,},],out:[Group:{t_19,},],attr:[],party:[alice,bob,]}"]
10 [label="shuffle:{in:[In:{t_18,t_19,},],out:[Out:{t_20,t_21,},],attr:[],party:[alice,bob,]}"]
11 [label="make_public:{in:[In:{t_21,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,]}"]
12 [label="filter:{in:[Filter:{t_22,},In:{t_20,},],out:[Out:{t_11,},],attr:[],party:[alice,bob,]}"]
13 [label="shape:{in:[In:{t_11,},],out:[Out:{t_12,},],attr:[axis:0,],party:[alice,]}"]
14 [label="publish_result:{in:[In:{t_12,},],out:[Out:{t_23,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_3:{constant_data_firstrow:PRIVATE:BOOL}"]
0 -> 5 [label = "t_4:{aggregate_int_0_firstrow:PRIVATE:INT64}"]
1 -> 3 [label = "t_7:{constant_data_firstrow:PRIVATE:BOOL}"]
1 -> 6 [label = "t_8:{aggregate_int_0_firstrow:PRIVATE:INT64}"]
10 -> 11 [label = "t_21:{group_mark:SECRET:BOOL}"]
10 -> 12 [label = "t_20:{constant_data_firstrow:SECRET:BOOL}"]
11 -> 12 [label = "t_22:{group_mark:PUBLIC:BOOL}"]
12 -> 13 [label = "t_11:{constant_data_firstrow_firstrow:SECRET:BOOL}"]
13 -> 14 [label = "t_12:{constant_data_firstrow_firstrow_count:PRIVATE:INT64}"]
2 -> 4 [label = "t_13:{constant_data_firstrow:SECRET:BOOL}"]
3 -> 4 [label = "t_14:{constant_data_firstrow:SECRET:BOOL}"]
4 -> 8 [label = "t_9:{constant_data_firstrow:SECRET:BOOL}"]
5 -> 7 [label = "t_15:{aggregate_int_0_firstrow:SECRET:INT64}"]
6 -> 7 [label = "t_16:{aggregate_int_0_firstrow:SECRET:INT64}"]
7 -> 8 [label = "t_10:{aggregate_int_0_firstrow:SECRET:INT64}"]
7 -> 8 [label = "t_10:{aggregate_int_0_firstrow:SECRET:INT64}"]
8 -> 10 [label = "t_18:{constant_data_firstrow:SECRET:BOOL}"]
8 -> 9 [label = "t_17:{aggregate_int_0_firstrow:SECRET:INT64}"]
9 -> 10 [label = "t_19:{group_mark:SECRET:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 make_share_2 make_share_3 concat_4 make_share_5 make_share_6 concat_7 sort_8 oblivious_group_mark_9 shuffle_10 make_public_11 filter_12 shape_13 publish_result_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0, ta.compare_int_0 < tb.compare_int_0 from alice.tbl_1 as ta inner join bob.tbl_1 as tb on ta.join_int_0=tb.join_int_0 limit 1,11;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,},],attr:[sql:select ta.plain_int_0,ta.join_int_0,ta.compare_int_0 from alice.tbl_1 as ta;,table_refs:[alice.tbl_1],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,t_5,},],attr:[sql:select 'tb'.'join_int_0','tb'.'compare_int_0' from 'bob'.'tbl_1' as 'tb';,table_refs:[bob.tbl_1],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_12,},RightJoinIndex:{t_13,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_3,},RowsIndexFilter:{t_12,},],out:[Out:{t_6,t_7,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_13,},],out:[Out:{t_8,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,]}"]
7 [label="Less:{in:[Left:{t_14,},Right:{t_15,},],out:[Out:{t_9,},],attr:[],party:[alice,bob,]}"]
8 [label="limit:{in:[In:{t_9,},],out:[Out:{t_11,},],attr:[count:11,offset:1,],party:[alice,bob,]}"]
9 [label="limit:{in:[In:{t_6,},],out:[Out:{t_10,},],attr:[count:11,offset:1,],party:[alice,]}"]
10 [label="make_private:{in:[In:{t_11,},],out:[Out:{t_16,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
11 [label="publish_result:{in:[In:{t_10,t_16,},],out:[Out:{t_17,t_18,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{compare_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_16:{lt_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_12:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_13:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_7:{compare_int_0:PRIVATE:INT64}"]
3 -> 9 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_8:{compare_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_14:{compare_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_15:{compare_int_0:SECRET:INT64}"]
7 -> 8 [label = "t_9:{lt_out:SECRET:BOOL}"]
8 -> 10 [label = "t_11:{lt_out:SECRET:BOOL}"]
9 -> 11 [label = "t_10:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 Less_7 limit_8 limit_9 make_private_10 publish_result_11]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0,tb.plain_int_0, sum(tb.aggregate_int_0), count(tb.encrypt_string_1) from alice.tbl_1 as ta inner join bob.tbl_1 as tb on ta.join_int_0 = tb.join_int_0 group by ta.plain_int_0, tb.plain_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_1 as ta;,table_refs:[alice.tbl_1],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,t_5,t_6,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'join_int_0','tb'.'aggregate_int_0','tb'.'encrypt_string_1' from 'bob'.'tbl_1' as 'tb';,table_refs:[bob.tbl_1],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_15,},RightJoinIndex:{t_16,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_15,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,t_5,t_6,},RowsIndexFilter:{t_16,},],out:[Out:{t_8,t_9,t_10,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_8,},],out:[Out:{t_17,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="private_group:{in:[Key:{t_7,t_17,},],out:[GroupId:{t_18,},GroupNum:{t_19,},],attr:[],party:[alice,]}"]
7 [label="count:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_18,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
8 [label="make_public:{in:[In:{t_19,},],out:[Out:{t_20,},],attr:[],party:[alice,bob,]}"]
9 [label="make_share:{in:[In:{t_18,},],out:[Out:{t_21,},],attr:[],party:[alice,bob,]}"]
10 [label="make_share:{in:[In:{t_9,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,]}"]
11 [label="private_group_secret_sum:{in:[GroupId:{t_21,},GroupNum:{t_20,},In:{t_22,},],out:[Out:{t_23,},],attr:[],party:[alice,bob,]}"]
12 [label="make_private:{in:[In:{t_23,},],out:[Out:{t_11,},],attr:[reveal_to:bob,],party:[alice,bob,]}"]
13 [label="firstrow:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_7,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
14 [label="firstrow:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_17,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
15 [label="copy:{in:[In:{t_11,},],out:[Out:{t_24,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
16 [label="publish_result:{in:[In:{t_13,t_14,t_24,t_12,},],out:[Out:{t_25,t_26,t_27,t_28,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{aggregate_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_6:{encrypt_string_1:PRIVATE:STRING}"]
10 -> 11 [label = "t_22:{aggregate_int_0:SECRET:INT64}"]
11 -> 12 [label = "t_23:{aggregate_int_0_sum:SECRET:INT64}"]
12 -> 15 [label = "t_11:{aggregate_int_0_sum:PRIVATE:INT64}"]
13 -> 16 [label = "t_13:{plain_int_0_firstrow:PRIVATE:INT64}"]
14 -> 16 [label = "t_14:{plain_int_0_firstrow:PRIVATE:INT64}"]
15 -> 16 [label = "t_24:{aggregate_int_0_sum:PRIVATE:INT64}"]
2 -> 3 [label = "t_15:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_16:{right_index:PRIVATE:INT64}"]
3 -> 13 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
4 -> 10 [label = "t_9:{aggregate_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
5 -> 14 [label = "t_17:{plain_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_17:{plain_int_0:PRIVATE:INT64}"]
6 -> 13 [label = "t_18:{group_id:PRIVATE:INT64}"]
6 -> 13 [label = "t_19:{group_num:PRIVATE:INT64}"]
6 -> 14 [label = "t_18:{group_id:PRIVATE:INT64}"]
6 -> 14 [label = "t_19:{group_num:PRIVATE:INT64}"]
6 -> 7 [label = "t_18:{group_id:PRIVATE:INT64}"]
6 -> 7 [label = "t_18:{group_id:PRIVATE:INT64}"]
6 -> 7 [label = "t_19:{group_num:PRIVATE:INT64}"]
6 -> 8 [label = "t_19:{group_num:PRIVATE:INT64}"]
6 -> 9 [label = "t_18:{group_id:PRIVATE:INT64}"]
7 -> 16 [label = "t_12:{simple_count_result:PRIVATE:INT64}"]
8 -> 11 [label = "t_20:{group_num:PUBLIC:INT64}"]
9 -> 11 [label = "t_21:{group_id:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 private_group_6 count_7 make_public_8 make_share_9 make_share_10 private_group_secret_sum_11 make_private_12 firstrow_13 firstrow_14 copy_15 publish_result_16]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 1, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from alice.tbl_1 where plain_int_0 in (2, 5, 15) and plain_int_1 not in (2, 5, 15);`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_21,},],attr:[sql:select tbl_1.plain_int_0 from alice.tbl_1 where (tbl_1.plain_int_0=2 or tbl_1.plain_int_0=5 or tbl_1.plain_int_0=15) and (not(tbl_1.plain_int_1=2 or tbl_1.plain_int_1=5 or tbl_1.plain_int_1=15));,table_refs:[alice.tbl_1],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_21,},],out:[Out:{t_22,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_21:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*), bob.gb_pl_en_int_0, carol.gb_en_pl_int_0, min(bob.ag_pl_en_int_0), max(carol.agg_en_pl_int_0) from alice.tbl_3 as alice join bob.tbl_3 as bob on alice.pl_jn_cp_int_0 = bob.jn_pl_cp_int_0 join carol.tbl_3 as carol on bob.cp_pl_jn_int_0 = carol.cp_jn_pl_int_0 group by bob.gb_pl_en_int_0, carol.gb_en_pl_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select alice.pl_jn_cp_int_0 from alice.tbl_3 as alice;,table_refs:[alice.tbl_3],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,t_3,t_4,t_5,},],attr:[sql:select 'bob'.'cp_pl_jn_int_0','bob'.'jn_pl_cp_int_0','bob'.'ag_pl_en_int_0','bob'.'gb_pl_en_int_0' from 'bob'.'tbl_3' as 'bob';,table_refs:[bob.tbl_3],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{},RightJoinIndex:{t_29,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,t_4,t_5,},RowsIndexFilter:{t_29,},],out:[Out:{t_6,t_7,t_8,},],attr:[],party:[bob,]}"]
4 [label="run_sql:{in:[],out:[Out:{t_9,t_10,t_11,},],attr:[sql:select carol.cp_jn_pl_int_0,carol.gb_en_pl_int_0,carol.agg_en_pl_int_0 from carol.tbl_3 as carol;,table_refs:[carol.tbl_3],],party:[carol,]}"]
5 [label="psi_join:{in:[Left:{t_6,},Right:{t_9,},],out:[LeftJoinIndex:{t_30,},RightJoinIndex:{t_31,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
6 [label="filter_by_index:{in:[Data:{t_7,t_8,},RowsIndexFilter:{t_30,},],out:[Out:{t_12,t_13,},],attr:[],party:[bob,]}"]
7 [label="filter_by_index:{in:[Data:{t_10,t_11,},RowsIndexFilter:{t_31,},],out:[Out:{t_14,t_15,},],attr:[],party:[carol,]}"]
8 [label="make_share:{in:[In:{t_13,},],out:[Out:{t_32,},],attr:[],party:[alice,bob,carol,]}"]
9 [label="make_share:{in:[In:{t_14,},],out:[Out:{t_33,},],attr:[],party:[alice,bob,carol,]}"]
10 [label="make_share:{in:[In:{t_12,},],out:[Out:{t_34,},],attr:[],party:[alice,bob,carol,]}"]
11 [label="make_share:{in:[In:{t_15,},],out:[Out:{t_35,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="sort:{in:[In:{t_32,t_33,t_34,t_35,t_32,t_33,},Key:{t_32,t_33,},],out:[Out:{t_36,t_37,t_38,t_39,t_40,t_41,},],attr:[reverse:[false false],],party:[alice,bob,carol,]}"]
13 [label="oblivious_group_mark:{in:[Key:{t_36,t_37,},],out:[Group:{t_42,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="count:{in:[Group:{t_42,},In:{t_42,},],out:[Out:{t_43,},],attr:[],party:[alice,bob,carol,]}"]
15 [label="min:{in:[Group:{t_42,},In:{t_38,},],out:[Out:{t_44,},],attr:[],party:[alice,bob,carol,]}"]
16 [label="max:{in:[Group:{t_42,},In:{t_39,},],out:[Out:{t_45,},],attr:[],party:[alice,bob,carol,]}"]
17 [label="shuffle:{in:[In:{t_43,t_44,t_45,t_40,t_41,t_42,},],out:[Out:{t_46,t_47,t_48,t_49,t_50,t_51,},],attr:[],party:[alice,bob,carol,]}"]
18 [label="make_public:{in:[In:{t_51,},],out:[Out:{t_52,},],attr:[],party:[alice,bob,carol,]}"]
19 [label="filter:{in:[Filter:{t_52,},In:{t_46,t_47,t_48,t_49,t_50,},],out:[Out:{t_16,t_17,t_18,t_19,t_20,},],attr:[],party:[alice,bob,carol,]}"]
20 [label="constant:{in:[],out:[Out:{t_21,},],attr:[scalar:4,to_status:1,],party:[alice,bob,carol,]}"]
21 [label="broadcast_to:{in:[In:{t_21,},ShapeRefTensor:{t_16,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,carol,]}"]
22 [label="GreaterEqual:{in:[Left:{t_16,},Right:{t_22,},],out:[Out:{t_23,},],attr:[],party:[alice,bob,carol,]}"]
23 [label="make_public:{in:[In:{t_23,},],out:[Out:{t_53,},],attr:[],party:[alice,bob,carol,]}"]
24 [label="filter:{in:[Filter:{t_53,},In:{t_16,t_17,t_18,t_19,t_20,},],out:[Out:{t_24,t_25,t_26,t_27,t_28,},],attr:[],party:[alice,bob,carol,]}"]
25 [label="make_private:{in:[In:{t_24,},],out:[Out:{t_54,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
26 [label="make_private:{in:[In:{t_27,},],out:[Out:{t_55,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
27 [label="make_private:{in:[In:{t_28,},],out:[Out:{t_56,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
28 [label="make_private:{in:[In:{t_25,},],out:[Out:{t_57,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
29 [label="make_private:{in:[In:{t_26,},],out:[Out:{t_58,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
30 [label="publish_result:{in:[In:{t_54,t_55,t_56,t_57,t_58,},],out:[Out:{t_59,t_60,t_61,t_62,t_63,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{pl_jn_cp_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{jn_pl_cp_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{cp_pl_jn_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{ag_pl_en_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_5:{gb_pl_en_int_0:PRIVATE:INT64}"]
10 -> 12 [label = "t_34:{ag_pl_en_int_0:SECRET:INT64}"]
11 -> 12 [label = "t_35:{agg_en_pl_int_0:SECRET:INT64}"]
12 -> 13 [label = "t_36:{gb_pl_en_int_0:SECRET:INT64}"]
12 -> 13 [label = "t_37:{gb_en_pl_int_0:SECRET:INT64}"]
12 -> 15 [label = "t_38:{ag_pl_en_int_0:SECRET:INT64}"]
12 -> 16 [label = "t_39:{agg_en_pl_int_0:SECRET:INT64}"]
12 -> 17 [label = "t_40:{gb_pl_en_int_0:SECRET:INT64}"]
12 -> 17 [label = "t_41:{gb_en_pl_int_0:SECRET:INT64}"]
13 -> 14 [label = "t_42:{group_mark:SECRET:BOOL}"]
13 -> 14 [label = "t_42:{group_mark:SECRET:BOOL}"]
13 -> 15 [label = "t_42:{group_mark:SECRET:BOOL}"]
13 -> 16 [label = "t_42:{group_mark:SECRET:BOOL}"]
13 -> 17 [label = "t_42:{group_mark:SECRET:BOOL}"]
14 -> 17 [label = "t_43:{aggregated_group_simple_count:SECRET:INT64}"]
15 -> 17 [label = "t_44:{ag_pl_en_int_0_min:SECRET:INT64}"]
16 -> 17 [label = "t_45:{agg_en_pl_int_0_max:SECRET:INT64}"]
17 -> 18 [label = "t_51:{group_mark:SECRET:BOOL}"]
17 -> 19 [label = "t_46:{aggregated_group_simple_count:SECRET:INT64}"]
17 -> 19 [label = "t_47:{ag_pl_en_int_0_min:SECRET:INT64}"]
17 -> 19 [label = "t_48:{agg_en_pl_int_0_max:SECRET:INT64}"]
17 -> 19 [label = "t_49:{gb_pl_en_int_0:SECRET:INT64}"]
17 -> 19 [label = "t_50:{gb_en_pl_int_0:SECRET:INT64}"]
18 -> 19 [label = "t_52:{group_mark:PUBLIC:BOOL}"]
19 -> 21 [label = "t_16:{simple_count_result:SECRET:INT64}"]
19 -> 22 [label = "t_16:{simple_count_result:SECRET:INT64}"]
19 -> 24 [label = "t_16:{simple_count_result:SECRET:INT64}"]
19 -> 24 [label = "t_17:{ag_pl_en_int_0_min:SECRET:INT64}"]
19 -> 24 [label = "t_18:{agg_en_pl_int_0_max:SECRET:INT64}"]
19 -> 24 [label = "t_19:{gb_pl_en_int_0_firstrow:SECRET:INT64}"]
19 -> 24 [label = "t_20:{gb_en_pl_int_0_firstrow:SECRET:INT64}"]
2 -> 3 [label = "t_29:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_21:{constant_data:PUBLIC:INT64}"]
21 -> 22 [label = "t_22:{constant_data:PUBLIC:INT64}"]
22 -> 23 [label = "t_23:{ge_out:SECRET:BOOL}"]
23 -> 24 [label = "t_53:{ge_out:PUBLIC:BOOL}"]
24 -> 25 [label = "t_24:{simple_count_result:SECRET:INT64}"]
24 -> 26 [label = "t_27:{gb_pl_en_int_0_firstrow:SECRET:INT64}"]
24 -> 27 [label = "t_28:{gb_en_pl_int_0_firstrow:SECRET:INT64}"]
24 -> 28 [label = "t_25:{ag_pl_en_int_0_min:SECRET:INT64}"]
24 -> 29 [label = "t_26:{agg_en_pl_int_0_max:SECRET:INT64}"]
25 -> 30 [label = "t_54:{simple_count_result:PRIVATE:INT64}"]
26 -> 30 [label = "t_55:{gb_pl_en_int_0_firstrow:PRIVATE:INT64}"]
27 -> 30 [label = "t_56:{gb_en_pl_int_0_firstrow:PRIVATE:INT64}"]
28 -> 30 [label = "t_57:{ag_pl_en_int_0_min:PRIVATE:INT64}"]
29 -> 30 [label = "t_58:{agg_en_pl_int_0_max:PRIVATE:INT64}"]
3 -> 5 [label = "t_6:{cp_pl_jn_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_7:{ag_pl_en_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_8:{gb_pl_en_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_9:{cp_jn_pl_int_0:PRIVATE:INT64}"]
4 -> 7 [label = "t_10:{gb_en_pl_int_0:PRIVATE:INT64}"]
4 -> 7 [label = "t_11:{agg_en_pl_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_30:{left_index:PRIVATE:INT64}"]
5 -> 7 [label = "t_31:{right_index:PRIVATE:INT64}"]
6 -> 10 [label = "t_12:{ag_pl_en_int_0:PRIVATE:INT64}"]
6 -> 8 [label = "t_13:{gb_pl_en_int_0:PRIVATE:INT64}"]
7 -> 11 [label = "t_15:{agg_en_pl_int_0:PRIVATE:INT64}"]
7 -> 9 [label = "t_14:{gb_en_pl_int_0:PRIVATE:INT64}"]
8 -> 12 [label = "t_32:{gb_pl_en_int_0:SECRET:INT64}"]
8 -> 12 [label = "t_32:{gb_pl_en_int_0:SECRET:INT64}"]
8 -> 12 [label = "t_32:{gb_pl_en_int_0:SECRET:INT64}"]
9 -> 12 [label = "t_33:{gb_en_pl_int_0:SECRET:INT64}"]
9 -> 12 [label = "t_33:{gb_en_pl_int_0:SECRET:INT64}"]
9 -> 12 [label = "t_33:{gb_en_pl_int_0:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 run_sql_4 psi_join_5 filter_by_index_6 filter_by_index_7 make_share_8 make_share_9 make_share_10 make_share_11 sort_12 oblivious_group_mark_13 count_14 min_15 max_16 shuffle_17 make_public_18 filter_19 constant_20 broadcast_to_21 GreaterEqual_22 make_public_23 filter_24 make_private_25 make_private_26 make_private_27 make_private_28 make_private_29 publish_result_30]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: true}},
	{`select bob.cp_pl_jn_int_0 > carol.cp_jn_pl_int_0, bob.cp_pl_jn_int_1 > carol.cp_jn_pl_int_1 from alice.tbl_3 as alice join bob.tbl_3 as bob on alice.pl_jn_cp_int_0 = bob.jn_pl_cp_int_0 join carol.tbl_3 as carol on bob.cp_pl_jn_int_0 = carol.cp_jn_pl_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select alice.pl_jn_cp_int_0 from alice.tbl_3 as alice;,table_refs:[alice.tbl_3],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,t_3,t_4,},],attr:[sql:select 'bob'.'cp_pl_jn_int_0','bob'.'cp_pl_jn_int_1','bob'.'jn_pl_cp_int_0' from 'bob'.'tbl_3' as 'bob';,table_refs:[bob.tbl_3],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_4,},],out:[LeftJoinIndex:{},RightJoinIndex:{t_15,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,t_3,},RowsIndexFilter:{t_15,},],out:[Out:{t_5,t_6,},],attr:[],party:[bob,]}"]
4 [label="run_sql:{in:[],out:[Out:{t_7,t_8,},],attr:[sql:select carol.cp_jn_pl_int_0,carol.cp_jn_pl_int_1 from carol.tbl_3 as carol;,table_refs:[carol.tbl_3],],party:[carol,]}"]
5 [label="psi_join:{in:[Left:{t_5,},Right:{t_7,},],out:[LeftJoinIndex:{t_16,},RightJoinIndex:{t_17,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
6 [label="filter_by_index:{in:[Data:{t_5,t_6,},RowsIndexFilter:{t_16,},],out:[Out:{t_9,t_10,},],attr:[],party:[bob,]}"]
7 [label="filter_by_index:{in:[Data:{t_7,t_8,},RowsIndexFilter:{t_17,},],out:[Out:{t_11,t_12,},],attr:[],party:[carol,]}"]
8 [label="copy:{in:[In:{t_11,},],out:[Out:{t_18,},],attr:[input_party_codes:carol,output_party_codes:bob,],party:[carol,bob,]}"]
9 [label="Greater:{in:[Left:{t_9,},Right:{t_18,},],out:[Out:{t_13,},],attr:[],party:[bob,]}"]
10 [label="make_share:{in:[In:{t_10,},],out:[Out:{t_19,},],attr:[],party:[alice,bob,carol,]}"]
11 [label="make_share:{in:[In:{t_12,},],out:[Out:{t_20,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="Greater:{in:[Left:{t_19,},Right:{t_20,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,carol,]}"]
13 [label="copy:{in:[In:{t_13,},],out:[Out:{t_21,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
14 [label="make_private:{in:[In:{t_14,},],out:[Out:{t_22,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
15 [label="publish_result:{in:[In:{t_21,t_22,},],out:[Out:{t_23,t_24,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{pl_jn_cp_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{jn_pl_cp_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{cp_pl_jn_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_3:{cp_pl_jn_int_1:PRIVATE:INT64}"]
10 -> 12 [label = "t_19:{cp_pl_jn_int_1:SECRET:INT64}"]
11 -> 12 [label = "t_20:{cp_jn_pl_int_1:SECRET:INT64}"]
12 -> 14 [label = "t_14:{gt_out:SECRET:BOOL}"]
13 -> 15 [label = "t_21:{gt_out:PRIVATE:BOOL}"]
14 -> 15 [label = "t_22:{gt_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_15:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{cp_pl_jn_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_5:{cp_pl_jn_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_6:{cp_pl_jn_int_1:PRIVATE:INT64}"]
4 -> 5 [label = "t_7:{cp_jn_pl_int_0:PRIVATE:INT64}"]
4 -> 7 [label = "t_7:{cp_jn_pl_int_0:PRIVATE:INT64}"]
4 -> 7 [label = "t_8:{cp_jn_pl_int_1:PRIVATE:INT64}"]
5 -> 6 [label = "t_16:{left_index:PRIVATE:INT64}"]
5 -> 7 [label = "t_17:{right_index:PRIVATE:INT64}"]
6 -> 10 [label = "t_10:{cp_pl_jn_int_1:PRIVATE:INT64}"]
6 -> 9 [label = "t_9:{cp_pl_jn_int_0:PRIVATE:INT64}"]
7 -> 11 [label = "t_12:{cp_jn_pl_int_1:PRIVATE:INT64}"]
7 -> 8 [label = "t_11:{cp_jn_pl_int_0:PRIVATE:INT64}"]
8 -> 9 [label = "t_18:{cp_jn_pl_int_0:PRIVATE:INT64}"]
9 -> 13 [label = "t_13:{gt_out:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 run_sql_4 psi_join_5 filter_by_index_6 filter_by_index_7 copy_8 Greater_9 make_share_10 make_share_11 Greater_12 copy_13 make_private_14 publish_result_15]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select bob.cp_pl_jn_int_0 > carol.cp_jn_pl_int_0 from alice.tbl_3 as alice join bob.tbl_3 as bob on alice.pl_jn_cp_int_0 = bob.jn_pl_cp_int_0 join carol.tbl_3 as carol on bob.cp_pl_jn_int_0 = carol.cp_jn_pl_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select alice.pl_jn_cp_int_0 from alice.tbl_3 as alice;,table_refs:[alice.tbl_3],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,t_3,},],attr:[sql:select 'bob'.'cp_pl_jn_int_0','bob'.'jn_pl_cp_int_0' from 'bob'.'tbl_3' as 'bob';,table_refs:[bob.tbl_3],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{},RightJoinIndex:{t_9,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_9,},],out:[Out:{t_4,},],attr:[],party:[bob,]}"]
4 [label="run_sql:{in:[],out:[Out:{t_5,},],attr:[sql:select carol.cp_jn_pl_int_0 from carol.tbl_3 as carol;,table_refs:[carol.tbl_3],],party:[carol,]}"]
5 [label="psi_join:{in:[Left:{t_4,},Right:{t_5,},],out:[LeftJoinIndex:{t_10,},RightJoinIndex:{t_11,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
6 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_10,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
7 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_11,},],out:[Out:{t_7,},],attr:[],party:[carol,]}"]
8 [label="copy:{in:[In:{t_7,},],out:[Out:{t_12,},],attr:[input_party_codes:carol,output_party_codes:bob,],party:[carol,bob,]}"]
9 [label="Greater:{in:[Left:{t_6,},Right:{t_12,},],out:[Out:{t_8,},],attr:[],party:[bob,]}"]
10 [label="copy:{in:[In:{t_8,},],out:[Out:{t_13,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
11 [label="publish_result:{in:[In:{t_13,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{pl_jn_cp_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{jn_pl_cp_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{cp_pl_jn_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_13:{gt_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_9:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_4:{cp_pl_jn_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{cp_pl_jn_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_5:{cp_jn_pl_int_0:PRIVATE:INT64}"]
4 -> 7 [label = "t_5:{cp_jn_pl_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_10:{left_index:PRIVATE:INT64}"]
5 -> 7 [label = "t_11:{right_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_6:{cp_pl_jn_int_0:PRIVATE:INT64}"]
7 -> 8 [label = "t_7:{cp_jn_pl_int_0:PRIVATE:INT64}"]
8 -> 9 [label = "t_12:{cp_jn_pl_int_0:PRIVATE:INT64}"]
9 -> 10 [label = "t_8:{gt_out:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 run_sql_4 psi_join_5 filter_by_index_6 filter_by_index_7 copy_8 Greater_9 copy_10 publish_result_11]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select if(ta.plain_int_0, tb.plain_int_0, ta.plain_int_0) as res,if(ta.compare_int_0 > tb.compare_int_0, ta.compare_int_0, tb.compare_int_0) > ta.compare_int_1 as res1, if(ta.plain_int_0, ta.compare_int_0, tb.compare_int_0) > ta.compare_int_1 as res1, if(ta.compare_int_0 > tb.compare_int_1, ta.plain_string_0, tb.plain_string_0) as res2 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,t_4,t_5,},],attr:[sql:select ta.plain_int_0,ta.join_int_0,ta.compare_int_0,ta.plain_string_0,ta.compare_int_1 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_6,t_7,t_8,t_9,t_10,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'join_int_0','tb'.'compare_int_0','tb'.'plain_string_0','tb'.'compare_int_1' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_7,},],out:[LeftJoinIndex:{t_27,},RightJoinIndex:{t_28,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_3,t_4,t_5,},RowsIndexFilter:{t_27,},],out:[Out:{t_11,t_12,t_13,t_14,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_6,t_8,t_9,t_10,},RowsIndexFilter:{t_28,},],out:[Out:{t_15,t_16,t_17,t_18,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_15,},],out:[Out:{t_29,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="if:{in:[Condition:{t_11,},ValueIfFalse:{t_11,},ValueIfTrue:{t_29,},],out:[Out:{t_19,},],attr:[],party:[alice,]}"]
7 [label="make_share:{in:[In:{t_12,},],out:[Out:{t_30,},],attr:[],party:[alice,bob,]}"]
8 [label="make_share:{in:[In:{t_16,},],out:[Out:{t_31,},],attr:[],party:[alice,bob,]}"]
9 [label="Greater:{in:[Left:{t_30,},Right:{t_31,},],out:[Out:{t_20,},],attr:[],party:[alice,bob,]}"]
10 [label="if:{in:[Condition:{t_20,},ValueIfFalse:{t_31,},ValueIfTrue:{t_30,},],out:[Out:{t_21,},],attr:[],party:[alice,bob,]}"]
11 [label="make_share:{in:[In:{t_14,},],out:[Out:{t_32,},],attr:[],party:[alice,bob,]}"]
12 [label="Greater:{in:[Left:{t_21,},Right:{t_32,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,]}"]
13 [label="make_public:{in:[In:{t_11,},],out:[Out:{t_33,},],attr:[],party:[alice,bob,]}"]
14 [label="if:{in:[Condition:{t_33,},ValueIfFalse:{t_31,},ValueIfTrue:{t_30,},],out:[Out:{t_23,},],attr:[],party:[alice,bob,]}"]
15 [label="Greater:{in:[Left:{t_23,},Right:{t_32,},],out:[Out:{t_24,},],attr:[],party:[alice,bob,]}"]
16 [label="make_share:{in:[In:{t_18,},],out:[Out:{t_34,},],attr:[],party:[alice,bob,]}"]
17 [label="Greater:{in:[Left:{t_30,},Right:{t_34,},],out:[Out:{t_25,},],attr:[],party:[alice,bob,]}"]
18 [label="make_public:{in:[In:{t_13,},],out:[Out:{t_35,},],attr:[],party:[alice,bob,]}"]
19 [label="make_public:{in:[In:{t_17,},],out:[Out:{t_36,},],attr:[],party:[alice,bob,]}"]
20 [label="if:{in:[Condition:{t_25,},ValueIfFalse:{t_36,},ValueIfTrue:{t_35,},],out:[Out:{t_26,},],attr:[],party:[alice,bob,]}"]
21 [label="make_private:{in:[In:{t_22,},],out:[Out:{t_37,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
22 [label="make_private:{in:[In:{t_24,},],out:[Out:{t_38,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
23 [label="make_public:{in:[In:{t_26,},],out:[Out:{t_39,},],attr:[],party:[alice,bob,]}"]
24 [label="make_private:{in:[In:{t_39,},],out:[Out:{t_40,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
25 [label="publish_result:{in:[In:{t_19,t_37,t_38,t_40,},],out:[Out:{t_41,t_42,t_43,t_44,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{compare_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_4:{plain_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_5:{compare_int_1:PRIVATE:INT64}"]
1 -> 2 [label = "t_7:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_10:{compare_int_1:PRIVATE:INT64}"]
1 -> 4 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_8:{compare_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_9:{plain_string_0:PRIVATE:STRING}"]
10 -> 12 [label = "t_21:{if_out:SECRET:INT64}"]
11 -> 12 [label = "t_32:{compare_int_1:SECRET:INT64}"]
11 -> 15 [label = "t_32:{compare_int_1:SECRET:INT64}"]
12 -> 21 [label = "t_22:{gt_out:SECRET:BOOL}"]
13 -> 14 [label = "t_33:{plain_int_0:PUBLIC:INT64}"]
14 -> 15 [label = "t_23:{if_out:SECRET:INT64}"]
15 -> 22 [label = "t_24:{gt_out:SECRET:BOOL}"]
16 -> 17 [label = "t_34:{compare_int_1:SECRET:INT64}"]
17 -> 20 [label = "t_25:{gt_out:SECRET:BOOL}"]
18 -> 20 [label = "t_35:{plain_string_0:PUBLIC:STRING}"]
19 -> 20 [label = "t_36:{plain_string_0:PUBLIC:STRING}"]
2 -> 3 [label = "t_27:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_28:{right_index:PRIVATE:INT64}"]
20 -> 23 [label = "t_26:{if_out:SECRET:STRING}"]
21 -> 25 [label = "t_37:{gt_out:PRIVATE:BOOL}"]
22 -> 25 [label = "t_38:{gt_out:PRIVATE:BOOL}"]
23 -> 24 [label = "t_39:{if_out:PUBLIC:STRING}"]
24 -> 25 [label = "t_40:{if_out:PRIVATE:STRING}"]
3 -> 11 [label = "t_14:{compare_int_1:PRIVATE:INT64}"]
3 -> 13 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
3 -> 18 [label = "t_13:{plain_string_0:PRIVATE:STRING}"]
3 -> 6 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_12:{compare_int_0:PRIVATE:INT64}"]
4 -> 16 [label = "t_18:{compare_int_1:PRIVATE:INT64}"]
4 -> 19 [label = "t_17:{plain_string_0:PRIVATE:STRING}"]
4 -> 5 [label = "t_15:{plain_int_0:PRIVATE:INT64}"]
4 -> 8 [label = "t_16:{compare_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_29:{plain_int_0:PRIVATE:INT64}"]
6 -> 25 [label = "t_19:{if_out:PRIVATE:INT64}"]
7 -> 10 [label = "t_30:{compare_int_0:SECRET:INT64}"]
7 -> 14 [label = "t_30:{compare_int_0:SECRET:INT64}"]
7 -> 17 [label = "t_30:{compare_int_0:SECRET:INT64}"]
7 -> 9 [label = "t_30:{compare_int_0:SECRET:INT64}"]
8 -> 10 [label = "t_31:{compare_int_0:SECRET:INT64}"]
8 -> 14 [label = "t_31:{compare_int_0:SECRET:INT64}"]
8 -> 9 [label = "t_31:{compare_int_0:SECRET:INT64}"]
9 -> 10 [label = "t_20:{gt_out:SECRET:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 if_6 make_share_7 make_share_8 Greater_9 if_10 make_share_11 Greater_12 make_public_13 if_14 Greater_15 make_share_16 Greater_17 make_public_18 make_public_19 if_20 make_private_21 make_private_22 make_public_23 make_private_24 publish_result_25]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select key1, key2, count(*) as c, count(distinct bob_encrypt) as cd, sum(bob_aggregate) as sb, max(carol_aggregate) as sc, min(carol_aggregate) as min_ca, avg(carol_aggregate) as avg_ca from (select bob.plain_int_0 as bob_encrypt, bob.plain_int_0 as bob_aggregate, carol.plain_int_0 as carol_aggregate, alice.plain_int_0 as alice_join, bob.plain_int_0 as bob_join, carol.plain_int_0 as carol_join, alice.plain_int_0 + bob.plain_int_0 as key1, carol.plain_int_0 + bob.plain_int_0 as key2 from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol) as tt where alice_join = bob_join and bob_join = carol_join group by key1, key2;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select alice.plain_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'bob'.'plain_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_30,},RightJoinIndex:{t_31,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_30,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_31,},],out:[Out:{t_4,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_5,},],attr:[sql:select carol.plain_int_0 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_4,},Right:{t_5,},],out:[LeftJoinIndex:{t_32,},RightJoinIndex:{t_33,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_32,},],out:[Out:{t_34,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_3,},RowsIndexFilter:{t_34,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_32,},],out:[Out:{t_7,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_33,},],out:[Out:{t_8,},],attr:[],party:[carol,]}"]
11 [label="copy:{in:[In:{t_7,},],out:[Out:{t_35,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
12 [label="Add:{in:[Left:{t_6,},Right:{t_35,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
13 [label="copy:{in:[In:{t_8,},],out:[Out:{t_36,},],attr:[input_party_codes:carol,output_party_codes:alice,],party:[carol,alice,]}"]
14 [label="Add:{in:[Left:{t_36,},Right:{t_35,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
15 [label="private_group:{in:[Key:{t_9,t_10,},],out:[GroupId:{t_37,},GroupNum:{t_38,},],attr:[],party:[alice,]}"]
16 [label="count:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_37,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
17 [label="count_distinct:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_35,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
18 [label="sum:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_35,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
19 [label="max:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_36,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
20 [label="min:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_36,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
21 [label="avg:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_36,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
22 [label="firstrow:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_9,},],out:[Out:{t_17,},],attr:[],party:[alice,]}"]
23 [label="firstrow:{in:[GroupId:{t_37,},GroupNum:{t_38,},In:{t_10,},],out:[Out:{t_18,},],attr:[],party:[alice,]}"]
24 [label="constant:{in:[],out:[Out:{t_19,},],attr:[scalar:4,to_status:1,],party:[alice,bob,carol,]}"]
25 [label="broadcast_to:{in:[In:{t_19,},ShapeRefTensor:{t_11,},],out:[Out:{t_20,},],attr:[],party:[alice,]}"]
26 [label="GreaterEqual:{in:[Left:{t_11,},Right:{t_20,},],out:[Out:{t_21,},],attr:[],party:[alice,]}"]
27 [label="filter:{in:[Filter:{t_21,},In:{t_11,t_12,t_13,t_14,t_15,t_16,t_17,t_18,},],out:[Out:{t_22,t_23,t_24,t_25,t_26,t_27,t_28,t_29,},],attr:[],party:[alice,]}"]
28 [label="publish_result:{in:[In:{t_28,t_29,t_22,t_23,t_24,t_25,t_26,t_27,},],out:[Out:{t_39,t_40,t_41,t_42,t_43,t_44,t_45,t_46,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
10 -> 13 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
11 -> 12 [label = "t_35:{plain_int_0:PRIVATE:INT64}"]
11 -> 14 [label = "t_35:{plain_int_0:PRIVATE:INT64}"]
11 -> 17 [label = "t_35:{plain_int_0:PRIVATE:INT64}"]
11 -> 18 [label = "t_35:{plain_int_0:PRIVATE:INT64}"]
12 -> 15 [label = "t_9:{plus_out:PRIVATE:INT64}"]
12 -> 22 [label = "t_9:{plus_out:PRIVATE:INT64}"]
13 -> 14 [label = "t_36:{plain_int_0:PRIVATE:INT64}"]
13 -> 19 [label = "t_36:{plain_int_0:PRIVATE:INT64}"]
13 -> 20 [label = "t_36:{plain_int_0:PRIVATE:INT64}"]
13 -> 21 [label = "t_36:{plain_int_0:PRIVATE:INT64}"]
14 -> 15 [label = "t_10:{plus_out:PRIVATE:INT64}"]
14 -> 23 [label = "t_10:{plus_out:PRIVATE:INT64}"]
15 -> 16 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 16 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 16 [label = "t_38:{group_num:PRIVATE:INT64}"]
15 -> 17 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 17 [label = "t_38:{group_num:PRIVATE:INT64}"]
15 -> 18 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 18 [label = "t_38:{group_num:PRIVATE:INT64}"]
15 -> 19 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 19 [label = "t_38:{group_num:PRIVATE:INT64}"]
15 -> 20 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 20 [label = "t_38:{group_num:PRIVATE:INT64}"]
15 -> 21 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 21 [label = "t_38:{group_num:PRIVATE:INT64}"]
15 -> 22 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 22 [label = "t_38:{group_num:PRIVATE:INT64}"]
15 -> 23 [label = "t_37:{group_id:PRIVATE:INT64}"]
15 -> 23 [label = "t_38:{group_num:PRIVATE:INT64}"]
16 -> 25 [label = "t_11:{simple_count_result:PRIVATE:INT64}"]
16 -> 26 [label = "t_11:{simple_count_result:PRIVATE:INT64}"]
16 -> 27 [label = "t_11:{simple_count_result:PRIVATE:INT64}"]
17 -> 27 [label = "t_12:{plain_int_0_count:PRIVATE:INT64}"]
18 -> 27 [label = "t_13:{plain_int_0_sum:PRIVATE:INT64}"]
19 -> 27 [label = "t_14:{plain_int_0_max:PRIVATE:INT64}"]
2 -> 3 [label = "t_30:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_31:{right_index:PRIVATE:INT64}"]
20 -> 27 [label = "t_15:{plain_int_0_min:PRIVATE:INT64}"]
21 -> 27 [label = "t_16:{plain_int_0_avg:PRIVATE:FLOAT64}"]
22 -> 27 [label = "t_17:{plus_out_firstrow:PRIVATE:INT64}"]
23 -> 27 [label = "t_18:{plus_out_firstrow:PRIVATE:INT64}"]
24 -> 25 [label = "t_19:{constant_data:PUBLIC:INT64}"]
25 -> 26 [label = "t_20:{constant_data:PRIVATE:INT64}"]
26 -> 27 [label = "t_21:{ge_out:PRIVATE:BOOL}"]
27 -> 28 [label = "t_22:{simple_count_result:PRIVATE:INT64}"]
27 -> 28 [label = "t_23:{plain_int_0_count:PRIVATE:INT64}"]
27 -> 28 [label = "t_24:{plain_int_0_sum:PRIVATE:INT64}"]
27 -> 28 [label = "t_25:{plain_int_0_max:PRIVATE:INT64}"]
27 -> 28 [label = "t_26:{plain_int_0_min:PRIVATE:INT64}"]
27 -> 28 [label = "t_27:{plain_int_0_avg:PRIVATE:FLOAT64}"]
27 -> 28 [label = "t_28:{plus_out_firstrow:PRIVATE:INT64}"]
27 -> 28 [label = "t_29:{plus_out_firstrow:PRIVATE:INT64}"]
3 -> 8 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_33:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_32:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_32:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_34:{left_index:PRIVATE:INT64}"]
8 -> 12 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
9 -> 11 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 copy_11 Add_12 copy_13 Add_14 private_group_15 count_16 count_distinct_17 sum_18 max_19 min_20 avg_21 firstrow_22 firstrow_23 constant_24 broadcast_to_25 GreaterEqual_26 filter_27 publish_result_28]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) from (select ta.groupby_string_0 from alice.tbl_0 as ta union select tb.groupby_string_0 from bob.tbl_0 as tb union select tc.groupby_string_0 from carol.tbl_0 as tc) as uu`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select any_value(1) as expr_365,any_value(ta.groupby_string_0) as expr_361 from alice.tbl_0 as ta group by ta.groupby_string_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_7,t_8,},],attr:[sql:select 1 as 'expr_365','tb'.'groupby_string_0' from 'bob'.'tbl_0' as 'tb' group by 'tb'.'groupby_string_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="run_sql:{in:[],out:[Out:{t_11,t_12,},],attr:[sql:select 1 as expr_365,tc.groupby_string_0 from carol.tbl_0 as tc group by tc.groupby_string_0;,table_refs:[carol.tbl_0],],party:[carol,]}"]
3 [label="make_share:{in:[In:{t_3,},],out:[Out:{t_17,},],attr:[],party:[alice,bob,carol,]}"]
4 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_18,},],attr:[],party:[alice,bob,carol,]}"]
5 [label="make_share:{in:[In:{t_11,},],out:[Out:{t_19,},],attr:[],party:[alice,bob,carol,]}"]
6 [label="concat:{in:[In:{t_17,t_18,t_19,},],out:[Out:{t_13,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
7 [label="make_share:{in:[In:{t_4,},],out:[Out:{t_20,},],attr:[],party:[alice,bob,carol,]}"]
8 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_21,},],attr:[],party:[alice,bob,carol,]}"]
9 [label="make_share:{in:[In:{t_12,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,carol,]}"]
10 [label="concat:{in:[In:{t_20,t_21,t_22,},],out:[Out:{t_14,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
11 [label="sort:{in:[In:{t_14,t_13,},Key:{t_14,},],out:[Out:{t_23,t_24,},],attr:[reverse:[false],],party:[alice,bob,carol,]}"]
12 [label="oblivious_group_mark:{in:[Key:{t_23,},],out:[Group:{t_25,},],attr:[],party:[alice,bob,carol,]}"]
13 [label="shuffle:{in:[In:{t_24,t_25,},],out:[Out:{t_26,t_27,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_public:{in:[In:{t_27,},],out:[Out:{t_28,},],attr:[],party:[alice,bob,carol,]}"]
15 [label="filter:{in:[Filter:{t_28,},In:{t_26,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,carol,]}"]
16 [label="shape:{in:[In:{t_15,},],out:[Out:{t_16,},],attr:[axis:0,],party:[alice,]}"]
17 [label="publish_result:{in:[In:{t_16,},],out:[Out:{t_29,},],attr:[],party:[alice,]}"]
0 -> 3 [label = "t_3:{constant_data_firstrow:PRIVATE:BOOL}"]
0 -> 7 [label = "t_4:{groupby_string_0_firstrow:PRIVATE:STRING}"]
1 -> 4 [label = "t_7:{constant_data_firstrow:PRIVATE:BOOL}"]
1 -> 8 [label = "t_8:{groupby_string_0_firstrow:PRIVATE:STRING}"]
10 -> 11 [label = "t_14:{groupby_string_0_firstrow:SECRET:STRING}"]
10 -> 11 [label = "t_14:{groupby_string_0_firstrow:SECRET:STRING}"]
11 -> 12 [label = "t_23:{groupby_string_0_firstrow:SECRET:STRING}"]
11 -> 13 [label = "t_24:{constant_data_firstrow:SECRET:BOOL}"]
12 -> 13 [label = "t_25:{group_mark:SECRET:BOOL}"]
13 -> 14 [label = "t_27:{group_mark:SECRET:BOOL}"]
13 -> 15 [label = "t_26:{constant_data_firstrow:SECRET:BOOL}"]
14 -> 15 [label = "t_28:{group_mark:PUBLIC:BOOL}"]
15 -> 16 [label = "t_15:{constant_data_firstrow_firstrow:SECRET:BOOL}"]
16 -> 17 [label = "t_16:{constant_data_firstrow_firstrow_count:PRIVATE:INT64}"]
2 -> 5 [label = "t_11:{constant_data_firstrow:PRIVATE:BOOL}"]
2 -> 9 [label = "t_12:{groupby_string_0_firstrow:PRIVATE:STRING}"]
3 -> 6 [label = "t_17:{constant_data_firstrow:SECRET:BOOL}"]
4 -> 6 [label = "t_18:{constant_data_firstrow:SECRET:BOOL}"]
5 -> 6 [label = "t_19:{constant_data_firstrow:SECRET:BOOL}"]
6 -> 11 [label = "t_13:{constant_data_firstrow:SECRET:BOOL}"]
7 -> 10 [label = "t_20:{groupby_string_0_firstrow:SECRET:STRING}"]
8 -> 10 [label = "t_21:{groupby_string_0_firstrow:SECRET:STRING}"]
9 -> 10 [label = "t_22:{groupby_string_0_firstrow:SECRET:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 run_sql_2 make_share_3 make_share_4 make_share_5 concat_6 make_share_7 make_share_8 make_share_9 concat_10 sort_11 oblivious_group_mark_12 shuffle_13 make_public_14 filter_15 shape_16 publish_result_17]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select alice.encrypt_float_1 from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol where alice.plain_int_0 = bob.join_int_0 and bob.join_int_1 = carol.join_int_1;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select alice.plain_int_0,alice.encrypt_float_1 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'bob'.'join_int_0','bob'.'join_int_1' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{t_10,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_9,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_10,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_7,},],attr:[sql:select carol.join_int_1 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_6,},Right:{t_7,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_11,},],out:[Out:{t_12,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_12,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
9 [label="publish_result:{in:[In:{t_8,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{encrypt_float_1:PRIVATE:FLOAT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{join_int_1:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_10:{right_index:PRIVATE:INT64}"]
3 -> 8 [label = "t_5:{encrypt_float_1:PRIVATE:FLOAT64}"]
4 -> 6 [label = "t_6:{join_int_1:PRIVATE:INT64}"]
5 -> 6 [label = "t_7:{join_int_1:PRIVATE:INT64}"]
6 -> 7 [label = "t_11:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_12:{left_index:PRIVATE:INT64}"]
8 -> 9 [label = "t_8:{encrypt_float_1:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 publish_result_9]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) as c, count(distinct bob.encrypt_int_0) as cd, sum(bob.aggregate_int_0) as sb, sum(carol.aggregate_int_0) as sc from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol where alice.join_int_0 = bob.join_int_0 and bob.join_int_0 = carol.join_int_0 group by alice.groupby_int_0 + bob.groupby_int_0, carol.groupby_int_0 + bob.groupby_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select alice.join_int_0,alice.groupby_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,t_5,t_6,},],attr:[sql:select 'bob'.'join_int_0','bob'.'groupby_int_0','bob'.'aggregate_int_0','bob'.'encrypt_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_34,},RightJoinIndex:{t_35,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_34,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,t_4,t_5,t_6,},RowsIndexFilter:{t_35,},],out:[Out:{t_8,t_9,t_10,t_11,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_12,t_13,t_14,},],attr:[sql:select carol.join_int_0,carol.groupby_int_0,carol.aggregate_int_0 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_8,},Right:{t_12,},],out:[LeftJoinIndex:{t_36,},RightJoinIndex:{t_37,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_36,},],out:[Out:{t_38,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_7,},RowsIndexFilter:{t_38,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_9,t_10,t_11,},RowsIndexFilter:{t_36,},],out:[Out:{t_16,t_17,t_18,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_13,t_14,},RowsIndexFilter:{t_37,},],out:[Out:{t_19,t_20,},],attr:[],party:[carol,]}"]
11 [label="make_share:{in:[In:{t_15,},],out:[Out:{t_39,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="make_share:{in:[In:{t_16,},],out:[Out:{t_40,},],attr:[],party:[alice,bob,carol,]}"]
13 [label="Add:{in:[Left:{t_39,},Right:{t_40,},],out:[Out:{t_21,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_share:{in:[In:{t_19,},],out:[Out:{t_41,},],attr:[],party:[alice,bob,carol,]}"]
15 [label="Add:{in:[Left:{t_41,},Right:{t_40,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,carol,]}"]
16 [label="make_share:{in:[In:{t_18,},],out:[Out:{t_42,},],attr:[],party:[alice,bob,carol,]}"]
17 [label="make_share:{in:[In:{t_17,},],out:[Out:{t_43,},],attr:[],party:[alice,bob,carol,]}"]
18 [label="make_share:{in:[In:{t_20,},],out:[Out:{t_44,},],attr:[],party:[alice,bob,carol,]}"]
19 [label="sort:{in:[In:{t_21,t_22,t_42,t_43,t_44,},Key:{t_21,t_22,},],out:[Out:{t_45,t_46,t_47,t_48,t_49,},],attr:[reverse:[false false],],party:[alice,bob,carol,]}"]
20 [label="oblivious_group_mark:{in:[Key:{t_45,t_46,},],out:[Group:{t_50,},],attr:[],party:[alice,bob,carol,]}"]
21 [label="count:{in:[Group:{t_50,},In:{t_50,},],out:[Out:{t_51,},],attr:[],party:[alice,bob,carol,]}"]
22 [label="sort:{in:[In:{t_47,},Key:{t_45,t_46,t_47,},],out:[Out:{t_53,},],attr:[reverse:[false false false],],party:[alice,bob,carol,]}"]
23 [label="oblivious_group_mark:{in:[Key:{t_53,},],out:[Group:{t_54,},],attr:[],party:[alice,bob,carol,]}"]
24 [label="LogicalOr:{in:[Left:{t_50,},Right:{t_54,},],out:[Out:{t_55,},],attr:[],party:[alice,bob,carol,]}"]
25 [label="sum:{in:[Group:{t_50,},In:{t_55,},],out:[Out:{t_52,},],attr:[],party:[alice,bob,carol,]}"]
26 [label="sum:{in:[Group:{t_50,},In:{t_48,},],out:[Out:{t_56,},],attr:[],party:[alice,bob,carol,]}"]
27 [label="sum:{in:[Group:{t_50,},In:{t_49,},],out:[Out:{t_57,},],attr:[],party:[alice,bob,carol,]}"]
28 [label="shuffle:{in:[In:{t_51,t_52,t_56,t_57,t_50,},],out:[Out:{t_58,t_59,t_60,t_61,t_62,},],attr:[],party:[alice,bob,carol,]}"]
29 [label="make_public:{in:[In:{t_62,},],out:[Out:{t_63,},],attr:[],party:[alice,bob,carol,]}"]
30 [label="filter:{in:[Filter:{t_63,},In:{t_58,t_59,t_60,t_61,},],out:[Out:{t_23,t_24,t_25,t_26,},],attr:[],party:[alice,bob,carol,]}"]
31 [label="constant:{in:[],out:[Out:{t_27,},],attr:[scalar:4,to_status:1,],party:[alice,bob,carol,]}"]
32 [label="broadcast_to:{in:[In:{t_27,},ShapeRefTensor:{t_23,},],out:[Out:{t_28,},],attr:[],party:[alice,bob,carol,]}"]
33 [label="GreaterEqual:{in:[Left:{t_23,},Right:{t_28,},],out:[Out:{t_29,},],attr:[],party:[alice,bob,carol,]}"]
34 [label="make_public:{in:[In:{t_29,},],out:[Out:{t_64,},],attr:[],party:[alice,bob,carol,]}"]
35 [label="filter:{in:[Filter:{t_64,},In:{t_23,t_24,t_25,t_26,},],out:[Out:{t_30,t_31,t_32,t_33,},],attr:[],party:[alice,bob,carol,]}"]
36 [label="make_private:{in:[In:{t_30,},],out:[Out:{t_65,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
37 [label="make_private:{in:[In:{t_31,},],out:[Out:{t_66,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
38 [label="make_private:{in:[In:{t_32,},],out:[Out:{t_67,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
39 [label="make_private:{in:[In:{t_33,},],out:[Out:{t_68,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
40 [label="publish_result:{in:[In:{t_65,t_66,t_67,t_68,},],out:[Out:{t_69,t_70,t_71,t_72,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{groupby_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{groupby_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{aggregate_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_6:{encrypt_int_0:PRIVATE:INT64}"]
10 -> 14 [label = "t_19:{groupby_int_0:PRIVATE:INT64}"]
10 -> 18 [label = "t_20:{aggregate_int_0:PRIVATE:INT64}"]
11 -> 13 [label = "t_39:{groupby_int_0:SECRET:INT64}"]
12 -> 13 [label = "t_40:{groupby_int_0:SECRET:INT64}"]
12 -> 15 [label = "t_40:{groupby_int_0:SECRET:INT64}"]
13 -> 19 [label = "t_21:{plus_out:SECRET:INT64}"]
13 -> 19 [label = "t_21:{plus_out:SECRET:INT64}"]
14 -> 15 [label = "t_41:{groupby_int_0:SECRET:INT64}"]
15 -> 19 [label = "t_22:{plus_out:SECRET:INT64}"]
15 -> 19 [label = "t_22:{plus_out:SECRET:INT64}"]
16 -> 19 [label = "t_42:{encrypt_int_0:SECRET:INT64}"]
17 -> 19 [label = "t_43:{aggregate_int_0:SECRET:INT64}"]
18 -> 19 [label = "t_44:{aggregate_int_0:SECRET:INT64}"]
19 -> 20 [label = "t_45:{plus_out:SECRET:INT64}"]
19 -> 20 [label = "t_46:{plus_out:SECRET:INT64}"]
19 -> 22 [label = "t_45:{plus_out:SECRET:INT64}"]
19 -> 22 [label = "t_46:{plus_out:SECRET:INT64}"]
19 -> 22 [label = "t_47:{encrypt_int_0:SECRET:INT64}"]
19 -> 22 [label = "t_47:{encrypt_int_0:SECRET:INT64}"]
19 -> 26 [label = "t_48:{aggregate_int_0:SECRET:INT64}"]
19 -> 27 [label = "t_49:{aggregate_int_0:SECRET:INT64}"]
2 -> 3 [label = "t_34:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_35:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_50:{group_mark:SECRET:BOOL}"]
20 -> 21 [label = "t_50:{group_mark:SECRET:BOOL}"]
20 -> 24 [label = "t_50:{group_mark:SECRET:BOOL}"]
20 -> 25 [label = "t_50:{group_mark:SECRET:BOOL}"]
20 -> 26 [label = "t_50:{group_mark:SECRET:BOOL}"]
20 -> 27 [label = "t_50:{group_mark:SECRET:BOOL}"]
20 -> 28 [label = "t_50:{group_mark:SECRET:BOOL}"]
21 -> 28 [label = "t_51:{aggregated_group_simple_count:SECRET:INT64}"]
22 -> 23 [label = "t_53:{encrypt_int_0:SECRET:INT64}"]
23 -> 24 [label = "t_54:{group_mark_distinct:SECRET:BOOL}"]
24 -> 25 [label = "t_55:{group_mark_full:SECRET:BOOL}"]
25 -> 28 [label = "t_52:{encrypt_int_0_count:SECRET:INT64}"]
26 -> 28 [label = "t_56:{aggregate_int_0_sum:SECRET:INT64}"]
27 -> 28 [label = "t_57:{aggregate_int_0_sum:SECRET:INT64}"]
28 -> 29 [label = "t_62:{group_mark:SECRET:BOOL}"]
28 -> 30 [label = "t_58:{aggregated_group_simple_count:SECRET:INT64}"]
28 -> 30 [label = "t_59:{encrypt_int_0_count:SECRET:INT64}"]
28 -> 30 [label = "t_60:{aggregate_int_0_sum:SECRET:INT64}"]
28 -> 30 [label = "t_61:{aggregate_int_0_sum:SECRET:INT64}"]
29 -> 30 [label = "t_63:{group_mark:PUBLIC:BOOL}"]
3 -> 8 [label = "t_7:{groupby_int_0:PRIVATE:INT64}"]
30 -> 32 [label = "t_23:{simple_count_result:SECRET:INT64}"]
30 -> 33 [label = "t_23:{simple_count_result:SECRET:INT64}"]
30 -> 35 [label = "t_23:{simple_count_result:SECRET:INT64}"]
30 -> 35 [label = "t_24:{encrypt_int_0_count:SECRET:INT64}"]
30 -> 35 [label = "t_25:{aggregate_int_0_sum:SECRET:INT64}"]
30 -> 35 [label = "t_26:{aggregate_int_0_sum:SECRET:INT64}"]
31 -> 32 [label = "t_27:{constant_data:PUBLIC:INT64}"]
32 -> 33 [label = "t_28:{constant_data:PUBLIC:INT64}"]
33 -> 34 [label = "t_29:{ge_out:SECRET:BOOL}"]
34 -> 35 [label = "t_64:{ge_out:PUBLIC:BOOL}"]
35 -> 36 [label = "t_30:{simple_count_result:SECRET:INT64}"]
35 -> 37 [label = "t_31:{encrypt_int_0_count:SECRET:INT64}"]
35 -> 38 [label = "t_32:{aggregate_int_0_sum:SECRET:INT64}"]
35 -> 39 [label = "t_33:{aggregate_int_0_sum:SECRET:INT64}"]
36 -> 40 [label = "t_65:{simple_count_result:PRIVATE:INT64}"]
37 -> 40 [label = "t_66:{encrypt_int_0_count:PRIVATE:INT64}"]
38 -> 40 [label = "t_67:{aggregate_int_0_sum:PRIVATE:INT64}"]
39 -> 40 [label = "t_68:{aggregate_int_0_sum:PRIVATE:INT64}"]
4 -> 6 [label = "t_8:{join_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_10:{aggregate_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_11:{encrypt_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_9:{groupby_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_13:{groupby_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_14:{aggregate_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_12:{join_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_37:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_36:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_36:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_38:{left_index:PRIVATE:INT64}"]
8 -> 11 [label = "t_15:{groupby_int_0:PRIVATE:INT64}"]
9 -> 12 [label = "t_16:{groupby_int_0:PRIVATE:INT64}"]
9 -> 16 [label = "t_18:{encrypt_int_0:PRIVATE:INT64}"]
9 -> 17 [label = "t_17:{aggregate_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 make_share_11 make_share_12 Add_13 make_share_14 Add_15 make_share_16 make_share_17 make_share_18 sort_19 oblivious_group_mark_20 count_21 sort_22 oblivious_group_mark_23 LogicalOr_24 sum_25 sum_26 sum_27 shuffle_28 make_public_29 filter_30 constant_31 broadcast_to_32 GreaterEqual_33 make_public_34 filter_35 make_private_36 make_private_37 make_private_38 make_private_39 publish_result_40]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: true}},
	{`select plain_string_0 in (select plain_int_0 from alice.tbl_1) as da from alice.tbl_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select tbl_0.plain_string_0 in (select tbl_1.plain_int_0 from alice.tbl_1) as da from alice.tbl_0;,table_refs:[alice.tbl_0 alice.tbl_1],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_3:{Column#241:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_string_0 from alice.tbl_0 where plain_string_0 in (select plain_int_0 from alice.tbl_1)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select tbl_0.plain_string_0 from alice.tbl_0 where exists (select tbl_1.plain_int_0 from alice.tbl_1 where tbl_0.plain_string_0=tbl_1.plain_int_0);,table_refs:[alice.tbl_0 alice.tbl_1],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_3:{plain_string_0:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) as c, count(distinct bob.encrypt_int_0) as cd, sum(bob.aggregate_int_0) as sb, sum(carol.aggregate_int_0) as sc from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol where alice.join_int_0 = bob.join_int_0 and bob.join_int_0 = carol.join_int_0 group by alice.groupby_int_0, bob.groupby_int_0, carol.groupby_int_0, carol.groupby_string_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select alice.join_int_0,alice.groupby_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,t_5,t_6,},],attr:[sql:select 'bob'.'join_int_0','bob'.'groupby_int_0','bob'.'aggregate_int_0','bob'.'encrypt_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_34,},RightJoinIndex:{t_35,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_34,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,t_4,t_5,t_6,},RowsIndexFilter:{t_35,},],out:[Out:{t_8,t_9,t_10,t_11,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_12,t_13,t_14,t_15,},],attr:[sql:select carol.join_int_0,carol.groupby_int_0,carol.aggregate_int_0,carol.groupby_string_0 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_8,},Right:{t_12,},],out:[LeftJoinIndex:{t_36,},RightJoinIndex:{t_37,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_36,},],out:[Out:{t_38,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_7,},RowsIndexFilter:{t_38,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_9,t_10,t_11,},RowsIndexFilter:{t_36,},],out:[Out:{t_17,t_18,t_19,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_13,t_14,t_15,},RowsIndexFilter:{t_37,},],out:[Out:{t_20,t_21,t_22,},],attr:[],party:[carol,]}"]
11 [label="make_share:{in:[In:{t_16,},],out:[Out:{t_39,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="make_share:{in:[In:{t_17,},],out:[Out:{t_40,},],attr:[],party:[alice,bob,carol,]}"]
13 [label="make_share:{in:[In:{t_20,},],out:[Out:{t_41,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_share:{in:[In:{t_22,},],out:[Out:{t_42,},],attr:[],party:[alice,bob,carol,]}"]
15 [label="make_share:{in:[In:{t_19,},],out:[Out:{t_43,},],attr:[],party:[alice,bob,carol,]}"]
16 [label="make_share:{in:[In:{t_18,},],out:[Out:{t_44,},],attr:[],party:[alice,bob,carol,]}"]
17 [label="make_share:{in:[In:{t_21,},],out:[Out:{t_45,},],attr:[],party:[alice,bob,carol,]}"]
18 [label="sort:{in:[In:{t_39,t_40,t_41,t_42,t_43,t_44,t_45,},Key:{t_39,t_40,t_41,t_42,},],out:[Out:{t_46,t_47,t_48,t_49,t_50,t_51,t_52,},],attr:[reverse:[false false false false],],party:[alice,bob,carol,]}"]
19 [label="oblivious_group_mark:{in:[Key:{t_46,t_47,t_48,t_49,},],out:[Group:{t_53,},],attr:[],party:[alice,bob,carol,]}"]
20 [label="count:{in:[Group:{t_53,},In:{t_53,},],out:[Out:{t_54,},],attr:[],party:[alice,bob,carol,]}"]
21 [label="sort:{in:[In:{t_50,},Key:{t_46,t_47,t_48,t_49,t_50,},],out:[Out:{t_56,},],attr:[reverse:[false false false false false],],party:[alice,bob,carol,]}"]
22 [label="oblivious_group_mark:{in:[Key:{t_56,},],out:[Group:{t_57,},],attr:[],party:[alice,bob,carol,]}"]
23 [label="LogicalOr:{in:[Left:{t_53,},Right:{t_57,},],out:[Out:{t_58,},],attr:[],party:[alice,bob,carol,]}"]
24 [label="sum:{in:[Group:{t_53,},In:{t_58,},],out:[Out:{t_55,},],attr:[],party:[alice,bob,carol,]}"]
25 [label="sum:{in:[Group:{t_53,},In:{t_51,},],out:[Out:{t_59,},],attr:[],party:[alice,bob,carol,]}"]
26 [label="sum:{in:[Group:{t_53,},In:{t_52,},],out:[Out:{t_60,},],attr:[],party:[alice,bob,carol,]}"]
27 [label="shuffle:{in:[In:{t_54,t_55,t_59,t_60,t_53,},],out:[Out:{t_61,t_62,t_63,t_64,t_65,},],attr:[],party:[alice,bob,carol,]}"]
28 [label="make_public:{in:[In:{t_65,},],out:[Out:{t_66,},],attr:[],party:[alice,bob,carol,]}"]
29 [label="filter:{in:[Filter:{t_66,},In:{t_61,t_62,t_63,t_64,},],out:[Out:{t_23,t_24,t_25,t_26,},],attr:[],party:[alice,bob,carol,]}"]
30 [label="constant:{in:[],out:[Out:{t_27,},],attr:[scalar:4,to_status:1,],party:[alice,bob,carol,]}"]
31 [label="broadcast_to:{in:[In:{t_27,},ShapeRefTensor:{t_23,},],out:[Out:{t_28,},],attr:[],party:[alice,bob,carol,]}"]
32 [label="GreaterEqual:{in:[Left:{t_23,},Right:{t_28,},],out:[Out:{t_29,},],attr:[],party:[alice,bob,carol,]}"]
33 [label="make_public:{in:[In:{t_29,},],out:[Out:{t_67,},],attr:[],party:[alice,bob,carol,]}"]
34 [label="filter:{in:[Filter:{t_67,},In:{t_23,t_24,t_25,t_26,},],out:[Out:{t_30,t_31,t_32,t_33,},],attr:[],party:[alice,bob,carol,]}"]
35 [label="make_private:{in:[In:{t_30,},],out:[Out:{t_68,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
36 [label="make_private:{in:[In:{t_31,},],out:[Out:{t_69,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
37 [label="make_private:{in:[In:{t_32,},],out:[Out:{t_70,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
38 [label="make_private:{in:[In:{t_33,},],out:[Out:{t_71,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
39 [label="publish_result:{in:[In:{t_68,t_69,t_70,t_71,},],out:[Out:{t_72,t_73,t_74,t_75,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{groupby_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{groupby_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{aggregate_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_6:{encrypt_int_0:PRIVATE:INT64}"]
10 -> 13 [label = "t_20:{groupby_int_0:PRIVATE:INT64}"]
10 -> 14 [label = "t_22:{groupby_string_0:PRIVATE:STRING}"]
10 -> 17 [label = "t_21:{aggregate_int_0:PRIVATE:INT64}"]
11 -> 18 [label = "t_39:{groupby_int_0:SECRET:INT64}"]
11 -> 18 [label = "t_39:{groupby_int_0:SECRET:INT64}"]
12 -> 18 [label = "t_40:{groupby_int_0:SECRET:INT64}"]
12 -> 18 [label = "t_40:{groupby_int_0:SECRET:INT64}"]
13 -> 18 [label = "t_41:{groupby_int_0:SECRET:INT64}"]
13 -> 18 [label = "t_41:{groupby_int_0:SECRET:INT64}"]
14 -> 18 [label = "t_42:{groupby_string_0:SECRET:STRING}"]
14 -> 18 [label = "t_42:{groupby_string_0:SECRET:STRING}"]
15 -> 18 [label = "t_43:{encrypt_int_0:SECRET:INT64}"]
16 -> 18 [label = "t_44:{aggregate_int_0:SECRET:INT64}"]
17 -> 18 [label = "t_45:{aggregate_int_0:SECRET:INT64}"]
18 -> 19 [label = "t_46:{groupby_int_0:SECRET:INT64}"]
18 -> 19 [label = "t_47:{groupby_int_0:SECRET:INT64}"]
18 -> 19 [label = "t_48:{groupby_int_0:SECRET:INT64}"]
18 -> 19 [label = "t_49:{groupby_string_0:SECRET:STRING}"]
18 -> 21 [label = "t_46:{groupby_int_0:SECRET:INT64}"]
18 -> 21 [label = "t_47:{groupby_int_0:SECRET:INT64}"]
18 -> 21 [label = "t_48:{groupby_int_0:SECRET:INT64}"]
18 -> 21 [label = "t_49:{groupby_string_0:SECRET:STRING}"]
18 -> 21 [label = "t_50:{encrypt_int_0:SECRET:INT64}"]
18 -> 21 [label = "t_50:{encrypt_int_0:SECRET:INT64}"]
18 -> 25 [label = "t_51:{aggregate_int_0:SECRET:INT64}"]
18 -> 26 [label = "t_52:{aggregate_int_0:SECRET:INT64}"]
19 -> 20 [label = "t_53:{group_mark:SECRET:BOOL}"]
19 -> 20 [label = "t_53:{group_mark:SECRET:BOOL}"]
19 -> 23 [label = "t_53:{group_mark:SECRET:BOOL}"]
19 -> 24 [label = "t_53:{group_mark:SECRET:BOOL}"]
19 -> 25 [label = "t_53:{group_mark:SECRET:BOOL}"]
19 -> 26 [label = "t_53:{group_mark:SECRET:BOOL}"]
19 -> 27 [label = "t_53:{group_mark:SECRET:BOOL}"]
2 -> 3 [label = "t_34:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_35:{right_index:PRIVATE:INT64}"]
20 -> 27 [label = "t_54:{aggregated_group_simple_count:SECRET:INT64}"]
21 -> 22 [label = "t_56:{encrypt_int_0:SECRET:INT64}"]
22 -> 23 [label = "t_57:{group_mark_distinct:SECRET:BOOL}"]
23 -> 24 [label = "t_58:{group_mark_full:SECRET:BOOL}"]
24 -> 27 [label = "t_55:{encrypt_int_0_count:SECRET:INT64}"]
25 -> 27 [label = "t_59:{aggregate_int_0_sum:SECRET:INT64}"]
26 -> 27 [label = "t_60:{aggregate_int_0_sum:SECRET:INT64}"]
27 -> 28 [label = "t_65:{group_mark:SECRET:BOOL}"]
27 -> 29 [label = "t_61:{aggregated_group_simple_count:SECRET:INT64}"]
27 -> 29 [label = "t_62:{encrypt_int_0_count:SECRET:INT64}"]
27 -> 29 [label = "t_63:{aggregate_int_0_sum:SECRET:INT64}"]
27 -> 29 [label = "t_64:{aggregate_int_0_sum:SECRET:INT64}"]
28 -> 29 [label = "t_66:{group_mark:PUBLIC:BOOL}"]
29 -> 31 [label = "t_23:{simple_count_result:SECRET:INT64}"]
29 -> 32 [label = "t_23:{simple_count_result:SECRET:INT64}"]
29 -> 34 [label = "t_23:{simple_count_result:SECRET:INT64}"]
29 -> 34 [label = "t_24:{encrypt_int_0_count:SECRET:INT64}"]
29 -> 34 [label = "t_25:{aggregate_int_0_sum:SECRET:INT64}"]
29 -> 34 [label = "t_26:{aggregate_int_0_sum:SECRET:INT64}"]
3 -> 8 [label = "t_7:{groupby_int_0:PRIVATE:INT64}"]
30 -> 31 [label = "t_27:{constant_data:PUBLIC:INT64}"]
31 -> 32 [label = "t_28:{constant_data:PUBLIC:INT64}"]
32 -> 33 [label = "t_29:{ge_out:SECRET:BOOL}"]
33 -> 34 [label = "t_67:{ge_out:PUBLIC:BOOL}"]
34 -> 35 [label = "t_30:{simple_count_result:SECRET:INT64}"]
34 -> 36 [label = "t_31:{encrypt_int_0_count:SECRET:INT64}"]
34 -> 37 [label = "t_32:{aggregate_int_0_sum:SECRET:INT64}"]
34 -> 38 [label = "t_33:{aggregate_int_0_sum:SECRET:INT64}"]
35 -> 39 [label = "t_68:{simple_count_result:PRIVATE:INT64}"]
36 -> 39 [label = "t_69:{encrypt_int_0_count:PRIVATE:INT64}"]
37 -> 39 [label = "t_70:{aggregate_int_0_sum:PRIVATE:INT64}"]
38 -> 39 [label = "t_71:{aggregate_int_0_sum:PRIVATE:INT64}"]
4 -> 6 [label = "t_8:{join_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_10:{aggregate_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_11:{encrypt_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_9:{groupby_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_13:{groupby_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_14:{aggregate_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_15:{groupby_string_0:PRIVATE:STRING}"]
5 -> 6 [label = "t_12:{join_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_37:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_36:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_36:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_38:{left_index:PRIVATE:INT64}"]
8 -> 11 [label = "t_16:{groupby_int_0:PRIVATE:INT64}"]
9 -> 12 [label = "t_17:{groupby_int_0:PRIVATE:INT64}"]
9 -> 15 [label = "t_19:{encrypt_int_0:PRIVATE:INT64}"]
9 -> 16 [label = "t_18:{aggregate_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 make_share_11 make_share_12 make_share_13 make_share_14 make_share_15 make_share_16 make_share_17 sort_18 oblivious_group_mark_19 count_20 sort_21 oblivious_group_mark_22 LogicalOr_23 sum_24 sum_25 sum_26 shuffle_27 make_public_28 filter_29 constant_30 broadcast_to_31 GreaterEqual_32 make_public_33 filter_34 make_private_35 make_private_36 make_private_37 make_private_38 publish_result_39]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) as c, count(distinct bob.encrypt_int_0) as cd, sum(bob.aggregate_int_0) as sb, sum(carol.aggregate_int_0) as sc from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol where alice.join_int_0 = bob.join_int_0 and bob.join_int_0 = carol.join_int_0 group by alice.groupby_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select alice.join_int_0,alice.groupby_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,t_5,},],attr:[sql:select 'bob'.'join_int_0','bob'.'aggregate_int_0','bob'.'encrypt_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_27,},RightJoinIndex:{t_28,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_27,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,t_4,t_5,},RowsIndexFilter:{t_28,},],out:[Out:{t_7,t_8,t_9,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_10,t_11,},],attr:[sql:select carol.join_int_0,carol.aggregate_int_0 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_7,},Right:{t_10,},],out:[LeftJoinIndex:{t_29,},RightJoinIndex:{t_30,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_29,},],out:[Out:{t_31,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_6,},RowsIndexFilter:{t_31,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_8,t_9,},RowsIndexFilter:{t_29,},],out:[Out:{t_13,t_14,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_11,},RowsIndexFilter:{t_30,},],out:[Out:{t_15,},],attr:[],party:[carol,]}"]
11 [label="make_share:{in:[In:{t_12,},],out:[Out:{t_32,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="make_share:{in:[In:{t_14,},],out:[Out:{t_33,},],attr:[],party:[alice,bob,carol,]}"]
13 [label="make_share:{in:[In:{t_13,},],out:[Out:{t_34,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_share:{in:[In:{t_15,},],out:[Out:{t_35,},],attr:[],party:[alice,bob,carol,]}"]
15 [label="sort:{in:[In:{t_32,t_33,t_34,t_35,},Key:{t_32,},],out:[Out:{t_36,t_37,t_38,t_39,},],attr:[reverse:[false],],party:[alice,bob,carol,]}"]
16 [label="oblivious_group_mark:{in:[Key:{t_36,},],out:[Group:{t_40,},],attr:[],party:[alice,bob,carol,]}"]
17 [label="count:{in:[Group:{t_40,},In:{t_40,},],out:[Out:{t_41,},],attr:[],party:[alice,bob,carol,]}"]
18 [label="sort:{in:[In:{t_37,},Key:{t_36,t_37,},],out:[Out:{t_43,},],attr:[reverse:[false false],],party:[alice,bob,carol,]}"]
19 [label="oblivious_group_mark:{in:[Key:{t_43,},],out:[Group:{t_44,},],attr:[],party:[alice,bob,carol,]}"]
20 [label="LogicalOr:{in:[Left:{t_40,},Right:{t_44,},],out:[Out:{t_45,},],attr:[],party:[alice,bob,carol,]}"]
21 [label="sum:{in:[Group:{t_40,},In:{t_45,},],out:[Out:{t_42,},],attr:[],party:[alice,bob,carol,]}"]
22 [label="sum:{in:[Group:{t_40,},In:{t_38,},],out:[Out:{t_46,},],attr:[],party:[alice,bob,carol,]}"]
23 [label="sum:{in:[Group:{t_40,},In:{t_39,},],out:[Out:{t_47,},],attr:[],party:[alice,bob,carol,]}"]
24 [label="shuffle:{in:[In:{t_41,t_42,t_46,t_47,t_40,},],out:[Out:{t_48,t_49,t_50,t_51,t_52,},],attr:[],party:[alice,bob,carol,]}"]
25 [label="make_public:{in:[In:{t_52,},],out:[Out:{t_53,},],attr:[],party:[alice,bob,carol,]}"]
26 [label="filter:{in:[Filter:{t_53,},In:{t_48,t_49,t_50,t_51,},],out:[Out:{t_16,t_17,t_18,t_19,},],attr:[],party:[alice,bob,carol,]}"]
27 [label="constant:{in:[],out:[Out:{t_20,},],attr:[scalar:4,to_status:1,],party:[alice,bob,carol,]}"]
28 [label="broadcast_to:{in:[In:{t_20,},ShapeRefTensor:{t_16,},],out:[Out:{t_21,},],attr:[],party:[alice,bob,carol,]}"]
29 [label="make_private:{in:[In:{t_16,},],out:[Out:{t_54,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
30 [label="make_private:{in:[In:{t_21,},],out:[Out:{t_55,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
31 [label="GreaterEqual:{in:[Left:{t_54,},Right:{t_55,},],out:[Out:{t_22,},],attr:[],party:[alice,]}"]
32 [label="make_private:{in:[In:{t_17,},],out:[Out:{t_56,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
33 [label="filter:{in:[Filter:{t_22,},In:{t_54,t_56,},],out:[Out:{t_23,t_24,},],attr:[],party:[alice,]}"]
34 [label="make_public:{in:[In:{t_22,},],out:[Out:{t_57,},],attr:[],party:[alice,bob,carol,]}"]
35 [label="filter:{in:[Filter:{t_57,},In:{t_18,t_19,},],out:[Out:{t_25,t_26,},],attr:[],party:[alice,bob,carol,]}"]
36 [label="make_private:{in:[In:{t_25,},],out:[Out:{t_58,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
37 [label="make_private:{in:[In:{t_26,},],out:[Out:{t_59,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
38 [label="publish_result:{in:[In:{t_23,t_24,t_58,t_59,},],out:[Out:{t_60,t_61,t_62,t_63,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{groupby_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{aggregate_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{encrypt_int_0:PRIVATE:INT64}"]
10 -> 14 [label = "t_15:{aggregate_int_0:PRIVATE:INT64}"]
11 -> 15 [label = "t_32:{groupby_int_0:SECRET:INT64}"]
11 -> 15 [label = "t_32:{groupby_int_0:SECRET:INT64}"]
12 -> 15 [label = "t_33:{encrypt_int_0:SECRET:INT64}"]
13 -> 15 [label = "t_34:{aggregate_int_0:SECRET:INT64}"]
14 -> 15 [label = "t_35:{aggregate_int_0:SECRET:INT64}"]
15 -> 16 [label = "t_36:{groupby_int_0:SECRET:INT64}"]
15 -> 18 [label = "t_36:{groupby_int_0:SECRET:INT64}"]
15 -> 18 [label = "t_37:{encrypt_int_0:SECRET:INT64}"]
15 -> 18 [label = "t_37:{encrypt_int_0:SECRET:INT64}"]
15 -> 22 [label = "t_38:{aggregate_int_0:SECRET:INT64}"]
15 -> 23 [label = "t_39:{aggregate_int_0:SECRET:INT64}"]
16 -> 17 [label = "t_40:{group_mark:SECRET:BOOL}"]
16 -> 17 [label = "t_40:{group_mark:SECRET:BOOL}"]
16 -> 20 [label = "t_40:{group_mark:SECRET:BOOL}"]
16 -> 21 [label = "t_40:{group_mark:SECRET:BOOL}"]
16 -> 22 [label = "t_40:{group_mark:SECRET:BOOL}"]
16 -> 23 [label = "t_40:{group_mark:SECRET:BOOL}"]
16 -> 24 [label = "t_40:{group_mark:SECRET:BOOL}"]
17 -> 24 [label = "t_41:{aggregated_group_simple_count:SECRET:INT64}"]
18 -> 19 [label = "t_43:{encrypt_int_0:SECRET:INT64}"]
19 -> 20 [label = "t_44:{group_mark_distinct:SECRET:BOOL}"]
2 -> 3 [label = "t_27:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_28:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_45:{group_mark_full:SECRET:BOOL}"]
21 -> 24 [label = "t_42:{encrypt_int_0_count:SECRET:INT64}"]
22 -> 24 [label = "t_46:{aggregate_int_0_sum:SECRET:INT64}"]
23 -> 24 [label = "t_47:{aggregate_int_0_sum:SECRET:INT64}"]
24 -> 25 [label = "t_52:{group_mark:SECRET:BOOL}"]
24 -> 26 [label = "t_48:{aggregated_group_simple_count:SECRET:INT64}"]
24 -> 26 [label = "t_49:{encrypt_int_0_count:SECRET:INT64}"]
24 -> 26 [label = "t_50:{aggregate_int_0_sum:SECRET:INT64}"]
24 -> 26 [label = "t_51:{aggregate_int_0_sum:SECRET:INT64}"]
25 -> 26 [label = "t_53:{group_mark:PUBLIC:BOOL}"]
26 -> 28 [label = "t_16:{simple_count_result:SECRET:INT64}"]
26 -> 29 [label = "t_16:{simple_count_result:SECRET:INT64}"]
26 -> 32 [label = "t_17:{encrypt_int_0_count:SECRET:INT64}"]
26 -> 35 [label = "t_18:{aggregate_int_0_sum:SECRET:INT64}"]
26 -> 35 [label = "t_19:{aggregate_int_0_sum:SECRET:INT64}"]
27 -> 28 [label = "t_20:{constant_data:PUBLIC:INT64}"]
28 -> 30 [label = "t_21:{constant_data:PUBLIC:INT64}"]
29 -> 31 [label = "t_54:{simple_count_result:PRIVATE:INT64}"]
29 -> 33 [label = "t_54:{simple_count_result:PRIVATE:INT64}"]
3 -> 8 [label = "t_6:{groupby_int_0:PRIVATE:INT64}"]
30 -> 31 [label = "t_55:{constant_data:PRIVATE:INT64}"]
31 -> 33 [label = "t_22:{ge_out:PRIVATE:BOOL}"]
31 -> 34 [label = "t_22:{ge_out:PRIVATE:BOOL}"]
32 -> 33 [label = "t_56:{encrypt_int_0_count:PRIVATE:INT64}"]
33 -> 38 [label = "t_23:{simple_count_result:PRIVATE:INT64}"]
33 -> 38 [label = "t_24:{encrypt_int_0_count:PRIVATE:INT64}"]
34 -> 35 [label = "t_57:{ge_out:PUBLIC:BOOL}"]
35 -> 36 [label = "t_25:{aggregate_int_0_sum:SECRET:INT64}"]
35 -> 37 [label = "t_26:{aggregate_int_0_sum:SECRET:INT64}"]
36 -> 38 [label = "t_58:{aggregate_int_0_sum:PRIVATE:INT64}"]
37 -> 38 [label = "t_59:{aggregate_int_0_sum:PRIVATE:INT64}"]
4 -> 6 [label = "t_7:{join_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_8:{aggregate_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_9:{encrypt_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_11:{aggregate_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_10:{join_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_30:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_29:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_29:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_31:{left_index:PRIVATE:INT64}"]
8 -> 11 [label = "t_12:{groupby_int_0:PRIVATE:INT64}"]
9 -> 12 [label = "t_14:{encrypt_int_0:PRIVATE:INT64}"]
9 -> 13 [label = "t_13:{aggregate_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 make_share_11 make_share_12 make_share_13 make_share_14 sort_15 oblivious_group_mark_16 count_17 sort_18 oblivious_group_mark_19 LogicalOr_20 sum_21 sum_22 sum_23 shuffle_24 make_public_25 filter_26 constant_27 broadcast_to_28 make_private_29 make_private_30 GreaterEqual_31 make_private_32 filter_33 make_public_34 filter_35 make_private_36 make_private_37 publish_result_38]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select (alice.join_int_0 + bob.compare_int_0 + carol.compare_int_0) <> 0 as reduce_res from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol where alice.join_int_0 = bob.join_int_0 and bob.join_int_0 = carol.join_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select alice.join_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,t_3,},],attr:[sql:select 'bob'.'join_int_0','bob'.'compare_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_17,},RightJoinIndex:{t_18,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_17,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_2,t_3,},RowsIndexFilter:{t_18,},],out:[Out:{t_5,t_6,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_7,t_8,},],attr:[sql:select carol.join_int_0,carol.compare_int_0 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_5,},Right:{t_7,},],out:[LeftJoinIndex:{t_19,},RightJoinIndex:{t_20,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_19,},],out:[Out:{t_21,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_21,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_6,},RowsIndexFilter:{t_19,},],out:[Out:{t_10,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_8,},RowsIndexFilter:{t_20,},],out:[Out:{t_11,},],attr:[],party:[carol,]}"]
11 [label="copy:{in:[In:{t_9,},],out:[Out:{t_22,},],attr:[input_party_codes:alice,output_party_codes:bob,],party:[alice,bob,]}"]
12 [label="Add:{in:[Left:{t_22,},Right:{t_10,},],out:[Out:{t_12,},],attr:[],party:[bob,]}"]
13 [label="make_share:{in:[In:{t_12,},],out:[Out:{t_23,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_share:{in:[In:{t_11,},],out:[Out:{t_24,},],attr:[],party:[alice,bob,carol,]}"]
15 [label="Add:{in:[Left:{t_23,},Right:{t_24,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,carol,]}"]
16 [label="constant:{in:[],out:[Out:{t_14,},],attr:[scalar:0,to_status:1,],party:[alice,bob,carol,]}"]
17 [label="broadcast_to:{in:[In:{t_14,},ShapeRefTensor:{t_13,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,carol,]}"]
18 [label="NotEqual:{in:[Left:{t_13,},Right:{t_15,},],out:[Out:{t_16,},],attr:[],party:[alice,bob,carol,]}"]
19 [label="make_private:{in:[In:{t_16,},],out:[Out:{t_25,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
20 [label="publish_result:{in:[In:{t_25,},],out:[Out:{t_26,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{compare_int_0:PRIVATE:INT64}"]
10 -> 14 [label = "t_11:{compare_int_0:PRIVATE:INT64}"]
11 -> 12 [label = "t_22:{join_int_0:PRIVATE:INT64}"]
12 -> 13 [label = "t_12:{plus_out:PRIVATE:INT64}"]
13 -> 15 [label = "t_23:{plus_out:SECRET:INT64}"]
14 -> 15 [label = "t_24:{compare_int_0:SECRET:INT64}"]
15 -> 17 [label = "t_13:{plus_out:SECRET:INT64}"]
15 -> 18 [label = "t_13:{plus_out:SECRET:INT64}"]
16 -> 17 [label = "t_14:{constant_data:PUBLIC:INT64}"]
17 -> 18 [label = "t_15:{constant_data:PUBLIC:INT64}"]
18 -> 19 [label = "t_16:{ne_out:SECRET:BOOL}"]
19 -> 20 [label = "t_25:{ne_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_17:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_18:{right_index:PRIVATE:INT64}"]
3 -> 8 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_8:{compare_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_7:{join_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_20:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_19:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_19:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_21:{left_index:PRIVATE:INT64}"]
8 -> 11 [label = "t_9:{join_int_0:PRIVATE:INT64}"]
9 -> 12 [label = "t_10:{compare_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 copy_11 Add_12 make_share_13 make_share_14 Add_15 constant_16 broadcast_to_17 NotEqual_18 make_private_19 publish_result_20]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select alice.plain_int_0 + bob.join_int_0 + carol.join_int_0 as add_res, alice.plain_int_0 - bob.join_int_0 - carol.join_int_0 as minus_res, alice.plain_int_0 * bob.join_int_0 * carol.join_int_0 as multi_res, alice.plain_int_0 / bob.join_int_0 / carol.join_int_0 as div_res from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol where alice.join_int_0 = bob.join_int_0 and bob.join_int_0 = carol.join_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select alice.plain_int_0,alice.join_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'bob'.'join_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_19,},RightJoinIndex:{t_20,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_19,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,},RowsIndexFilter:{t_20,},],out:[Out:{t_5,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_6,},],attr:[sql:select carol.join_int_0 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_5,},Right:{t_6,},],out:[LeftJoinIndex:{t_21,},RightJoinIndex:{t_22,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_21,},],out:[Out:{t_23,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_23,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_21,},],out:[Out:{t_8,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_6,},RowsIndexFilter:{t_22,},],out:[Out:{t_9,},],attr:[],party:[carol,]}"]
11 [label="copy:{in:[In:{t_8,},],out:[Out:{t_24,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
12 [label="Add:{in:[Left:{t_7,},Right:{t_24,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
13 [label="copy:{in:[In:{t_9,},],out:[Out:{t_25,},],attr:[input_party_codes:carol,output_party_codes:alice,],party:[carol,alice,]}"]
14 [label="Add:{in:[Left:{t_10,},Right:{t_25,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
15 [label="Minus:{in:[Left:{t_7,},Right:{t_24,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
16 [label="Minus:{in:[Left:{t_12,},Right:{t_25,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
17 [label="Mul:{in:[Left:{t_7,},Right:{t_24,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
18 [label="Mul:{in:[Left:{t_14,},Right:{t_25,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
19 [label="Cast:{in:[In:{t_7,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
20 [label="Div:{in:[Left:{t_16,},Right:{t_24,},],out:[Out:{t_17,},],attr:[],party:[alice,]}"]
21 [label="Div:{in:[Left:{t_17,},Right:{t_25,},],out:[Out:{t_18,},],attr:[],party:[alice,]}"]
22 [label="publish_result:{in:[In:{t_11,t_13,t_15,t_18,},],out:[Out:{t_26,t_27,t_28,t_29,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
10 -> 13 [label = "t_9:{join_int_0:PRIVATE:INT64}"]
11 -> 12 [label = "t_24:{join_int_0:PRIVATE:INT64}"]
11 -> 15 [label = "t_24:{join_int_0:PRIVATE:INT64}"]
11 -> 17 [label = "t_24:{join_int_0:PRIVATE:INT64}"]
11 -> 20 [label = "t_24:{join_int_0:PRIVATE:INT64}"]
12 -> 14 [label = "t_10:{plus_out:PRIVATE:INT64}"]
13 -> 14 [label = "t_25:{join_int_0:PRIVATE:INT64}"]
13 -> 16 [label = "t_25:{join_int_0:PRIVATE:INT64}"]
13 -> 18 [label = "t_25:{join_int_0:PRIVATE:INT64}"]
13 -> 21 [label = "t_25:{join_int_0:PRIVATE:INT64}"]
14 -> 22 [label = "t_11:{plus_out:PRIVATE:INT64}"]
15 -> 16 [label = "t_12:{minus_out:PRIVATE:INT64}"]
16 -> 22 [label = "t_13:{minus_out:PRIVATE:INT64}"]
17 -> 18 [label = "t_14:{mul_out:PRIVATE:INT64}"]
18 -> 22 [label = "t_15:{mul_out:PRIVATE:INT64}"]
19 -> 20 [label = "t_16:{plain_int_0:PRIVATE:FLOAT64}"]
2 -> 3 [label = "t_19:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_20:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_17:{div_out:PRIVATE:FLOAT64}"]
21 -> 22 [label = "t_18:{div_out:PRIVATE:FLOAT64}"]
3 -> 8 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_6:{join_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_6:{join_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_22:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_21:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_21:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_23:{left_index:PRIVATE:INT64}"]
8 -> 12 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
8 -> 15 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
8 -> 17 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
8 -> 19 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
9 -> 11 [label = "t_8:{join_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 copy_11 Add_12 copy_13 Add_14 Minus_15 Minus_16 Mul_17 Mul_18 Cast_19 Div_20 Div_21 publish_result_22]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select concat(plain_string_0, plain_string_1) as tt from alice.tbl_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select concat(tbl_0.plain_string_0, tbl_0.plain_string_1) as tt from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_3:{concat_out:PRIVATE:STRING}"]
}`, ``, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select count(*) as c from alice.tbl_1 join alice.tbl_2 on tbl_1.plain_int_0 = tbl_2.plain_int_0 group by tbl_1.plain_float_0 having count(*) > 3`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_11,},],attr:[sql:select count(1) as c from alice.tbl_1 join alice.tbl_2 on tbl_1.plain_int_0=tbl_2.plain_int_0 group by tbl_1.plain_float_0 having (count(1)>3) and (count(1)>=4);,table_refs:[alice.tbl_1 alice.tbl_2],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_11,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_11:{simple_count_result:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select tbl_1.plain_float_0 from alice.tbl_1 join alice.tbl_2 on tbl_1.plain_int_0 = tbl_2.plain_int_0 group by tbl_1.plain_float_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_9,},],attr:[sql:select any_value(tbl_1.plain_float_0) as expr_9 from alice.tbl_1 join alice.tbl_2 on tbl_1.plain_int_0=tbl_2.plain_int_0 group by tbl_1.plain_float_0 having count(1)>=4;,table_refs:[alice.tbl_1 alice.tbl_2],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_9,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_9:{plain_float_0_firstrow:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from alice.tbl_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select tbl_0.plain_int_0 from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_1,},],out:[Out:{t_2,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) as c, sum(plain_int_0) as b, max(plain_int_0) as a, min(plain_int_0) as d from alice.tbl_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_2,t_3,t_4,t_5,},],attr:[sql:select count(1) as c,sum(tbl_0.plain_int_0) as b,max(tbl_0.plain_int_0) as a,min(tbl_0.plain_int_0) as d from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_2,t_3,t_4,t_5,},],out:[Out:{t_6,t_7,t_8,t_9,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_2:{plain_int_0_count:PRIVATE:INT64}"]
0 -> 1 [label = "t_3:{plain_int_0_sum:PRIVATE:INT64}"]
0 -> 1 [label = "t_4:{plain_int_0_max:PRIVATE:INT64}"]
0 -> 1 [label = "t_5:{plain_int_0_min:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from alice.tbl_0 into outfile '/tmp/output.txt' fields terminated BY ','`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select tbl_0.plain_int_0 from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="dump_file:{in:[In:{t_1,},],out:[Out:{t_2,},],attr:[field_deliminator:,,file_path:/tmp/output.txt,line_terminator:
,quoting_style:0,],party:[alice,]}"]
0 -> 1 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 dump_file_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from alice.tbl_0 into outfile party_code 'alice' '/tmp/output.txt' columns terminated BY '|' optionally enclosed BY '"' lines terminated BY 'end of line';`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select tbl_0.plain_int_0 from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="dump_file:{in:[In:{t_1,},],out:[Out:{t_2,},],attr:[field_deliminator:|,file_path:/tmp/output.txt,line_terminator:end of line,quoting_style:1,],party:[alice,]}"]
0 -> 1 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 dump_file_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from alice.tbl_0 into outfile party_code 'alice' '/tmp/output_alice.txt' party_code 'bob' '/tmp/output_bob.txt' party_code 'carol' '/tmp/output_carol.txt';`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select tbl_0.plain_int_0 from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="dump_file:{in:[In:{t_1,},],out:[Out:{t_2,},],attr:[field_deliminator:	,file_path:/tmp/output_alice.txt,line_terminator:
,quoting_style:0,],party:[alice,]}"]
2 [label="copy:{in:[In:{t_1,},],out:[Out:{t_3,},],attr:[input_party_codes:alice,output_party_codes:bob,],party:[alice,bob,]}"]
3 [label="dump_file:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[field_deliminator:	,file_path:/tmp/output_bob.txt,line_terminator:
,quoting_style:0,],party:[bob,]}"]
4 [label="copy:{in:[In:{t_1,},],out:[Out:{t_5,},],attr:[input_party_codes:alice,output_party_codes:carol,],party:[alice,carol,]}"]
5 [label="dump_file:{in:[In:{t_5,},],out:[Out:{t_6,},],attr:[field_deliminator:	,file_path:/tmp/output_carol.txt,line_terminator:
,quoting_style:0,],party:[carol,]}"]
0 -> 1 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 4 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 dump_file_1 copy_2 dump_file_3 copy_4 dump_file_5]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from alice.tbl_0 into outfile party_code 'bob' '/tmp/output_bob.txt' party_code 'carol' '/tmp/output_carol.txt' fields terminated BY ',';`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select tbl_0.plain_int_0 from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="copy:{in:[In:{t_1,},],out:[Out:{t_2,},],attr:[input_party_codes:alice,output_party_codes:bob,],party:[alice,bob,]}"]
2 [label="dump_file:{in:[In:{t_2,},],out:[Out:{t_3,},],attr:[field_deliminator:,,file_path:/tmp/output_bob.txt,line_terminator:
,quoting_style:0,],party:[bob,]}"]
3 [label="copy:{in:[In:{t_1,},],out:[Out:{t_4,},],attr:[input_party_codes:alice,output_party_codes:carol,],party:[alice,carol,]}"]
4 [label="dump_file:{in:[In:{t_4,},],out:[Out:{t_5,},],attr:[field_deliminator:,,file_path:/tmp/output_carol.txt,line_terminator:
,quoting_style:0,],party:[carol,]}"]
0 -> 1 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 copy_1 dump_file_2 copy_3 dump_file_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from bob.tbl_0 into outfile party_code 'alice' '/tmp/output_alice.txt' party_code 'carol' '/tmp/output_carol.txt' fields terminated BY ',';`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select 'tbl_0'.'plain_int_0' from 'bob'.'tbl_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
1 [label="copy:{in:[In:{t_1,},],out:[Out:{t_2,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
2 [label="dump_file:{in:[In:{t_2,},],out:[Out:{t_3,},],attr:[field_deliminator:,,file_path:/tmp/output_alice.txt,line_terminator:
,quoting_style:0,],party:[alice,]}"]
3 [label="copy:{in:[In:{t_2,},],out:[Out:{t_4,},],attr:[input_party_codes:alice,output_party_codes:carol,],party:[alice,carol,]}"]
4 [label="dump_file:{in:[In:{t_4,},],out:[Out:{t_5,},],attr:[field_deliminator:,,file_path:/tmp/output_carol.txt,line_terminator:
,quoting_style:0,],party:[carol,]}"]
0 -> 1 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 copy_1 dump_file_2 copy_3 dump_file_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_int_0 from bob.tbl_0 into outfile party_code 'carol' '/tmp/output_carol.txt' fields terminated BY ',';`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select 'tbl_0'.'plain_int_0' from 'bob'.'tbl_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
1 [label="copy:{in:[In:{t_1,},],out:[Out:{t_2,},],attr:[input_party_codes:bob,output_party_codes:carol,],party:[bob,carol,]}"]
2 [label="dump_file:{in:[In:{t_2,},],out:[Out:{t_3,},],attr:[field_deliminator:,,file_path:/tmp/output_carol.txt,line_terminator:
,quoting_style:0,],party:[carol,]}"]
0 -> 1 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 copy_1 dump_file_2]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.join_int_0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 into outfile party_code 'alice' '/tmp/output_alice.txt' party_code 'bob' '/tmp/output_bob.txt' fields terminated BY ','`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_4,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_4,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="dump_file:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[field_deliminator:,,file_path:/tmp/output_alice.txt,line_terminator:
,quoting_style:0,],party:[alice,]}"]
5 [label="copy:{in:[In:{t_3,},],out:[Out:{t_6,},],attr:[input_party_codes:alice,output_party_codes:bob,],party:[alice,bob,]}"]
6 [label="dump_file:{in:[In:{t_6,},],out:[Out:{t_7,},],attr:[field_deliminator:,,file_path:/tmp/output_bob.txt,line_terminator:
,quoting_style:0,],party:[bob,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_6:{join_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 dump_file_4 copy_5 dump_file_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select (ta.compare_int_0 + tb.compare_int_0) > 0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 into outfile party_code 'alice' '/tmp/output.txt' fields terminated BY ','`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{t_12,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_11,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_12,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
7 [label="Add:{in:[Left:{t_13,},Right:{t_14,},],out:[Out:{t_7,},],attr:[],party:[alice,bob,]}"]
8 [label="constant:{in:[],out:[Out:{t_8,},],attr:[scalar:0,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_8,},ShapeRefTensor:{t_7,},],out:[Out:{t_9,},],attr:[],party:[alice,bob,]}"]
10 [label="Greater:{in:[Left:{t_7,},Right:{t_9,},],out:[Out:{t_10,},],attr:[],party:[alice,bob,]}"]
11 [label="make_private:{in:[In:{t_10,},],out:[Out:{t_15,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
12 [label="dump_file:{in:[In:{t_15,},],out:[Out:{t_16,},],attr:[field_deliminator:,,file_path:/tmp/output.txt,line_terminator:
,quoting_style:0,],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_10:{gt_out:SECRET:BOOL}"]
11 -> 12 [label = "t_15:{gt_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_11:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_12:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{compare_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_13:{compare_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_14:{compare_int_0:SECRET:INT64}"]
7 -> 10 [label = "t_7:{plus_out:SECRET:INT64}"]
7 -> 9 [label = "t_7:{plus_out:SECRET:INT64}"]
8 -> 9 [label = "t_8:{constant_data:PUBLIC:INT64}"]
9 -> 10 [label = "t_9:{constant_data:PUBLIC:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 Add_7 constant_8 broadcast_to_9 Greater_10 make_private_11 dump_file_12]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select (ta.compare_int_0 + tb.compare_int_0) > 0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 into outfile party_code 'alice' '/tmp/output_alice.txt' party_code 'bob' '/tmp/output_bob.txt' fields terminated BY ','`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{t_12,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_11,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_12,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
7 [label="Add:{in:[Left:{t_13,},Right:{t_14,},],out:[Out:{t_7,},],attr:[],party:[alice,bob,]}"]
8 [label="constant:{in:[],out:[Out:{t_8,},],attr:[scalar:0,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_8,},ShapeRefTensor:{t_7,},],out:[Out:{t_9,},],attr:[],party:[alice,bob,]}"]
10 [label="Greater:{in:[Left:{t_7,},Right:{t_9,},],out:[Out:{t_10,},],attr:[],party:[alice,bob,]}"]
11 [label="make_private:{in:[In:{t_10,},],out:[Out:{t_15,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
12 [label="dump_file:{in:[In:{t_15,},],out:[Out:{t_16,},],attr:[field_deliminator:,,file_path:/tmp/output_alice.txt,line_terminator:
,quoting_style:0,],party:[alice,]}"]
13 [label="copy:{in:[In:{t_15,},],out:[Out:{t_17,},],attr:[input_party_codes:alice,output_party_codes:bob,],party:[alice,bob,]}"]
14 [label="dump_file:{in:[In:{t_17,},],out:[Out:{t_18,},],attr:[field_deliminator:,,file_path:/tmp/output_bob.txt,line_terminator:
,quoting_style:0,],party:[bob,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_10:{gt_out:SECRET:BOOL}"]
11 -> 12 [label = "t_15:{gt_out:PRIVATE:BOOL}"]
11 -> 13 [label = "t_15:{gt_out:PRIVATE:BOOL}"]
13 -> 14 [label = "t_17:{gt_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_11:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_12:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{compare_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_13:{compare_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_14:{compare_int_0:SECRET:INT64}"]
7 -> 10 [label = "t_7:{plus_out:SECRET:INT64}"]
7 -> 9 [label = "t_7:{plus_out:SECRET:INT64}"]
8 -> 9 [label = "t_8:{constant_data:PUBLIC:INT64}"]
9 -> 10 [label = "t_9:{constant_data:PUBLIC:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 Add_7 constant_8 broadcast_to_9 Greater_10 make_private_11 dump_file_12 copy_13 dump_file_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`insert into testdb.test_table (ci, cl) select a.plain_int_0, b.plain_string_0 from alice.tbl_0 a join bob.tbl_0  b on a.join_int_0=b.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select a.plain_int_0,a.join_int_0 from alice.tbl_0 as a;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'b'.'join_int_0','b'.'plain_string_0' from 'bob'.'tbl_0' as 'b';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_7,},RightJoinIndex:{t_8,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_7,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_8,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_6,},],out:[Out:{t_9,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="insert_table:{in:[In:{t_5,t_9,},],out:[Out:{t_10,t_11,},],attr:[column_names:[ci cl],table_name:testdb.test_table,],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{plain_string_0:PRIVATE:STRING}"]
2 -> 3 [label = "t_7:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_8:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_6:{plain_string_0:PRIVATE:STRING}"]
5 -> 6 [label = "t_9:{plain_string_0:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 insert_table_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`insert into test_table (ci, cl) select a.plain_int_0, b.plain_string_0 from alice.tbl_0 a join bob.tbl_0  b on a.join_int_0=b.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select a.plain_int_0,a.join_int_0 from alice.tbl_0 as a;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'b'.'join_int_0','b'.'plain_string_0' from 'bob'.'tbl_0' as 'b';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_7,},RightJoinIndex:{t_8,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_7,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_8,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_6,},],out:[Out:{t_9,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="insert_table:{in:[In:{t_5,t_9,},],out:[Out:{t_10,t_11,},],attr:[column_names:[ci cl],table_name:test_table,],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{plain_string_0:PRIVATE:STRING}"]
2 -> 3 [label = "t_7:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_8:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_6:{plain_string_0:PRIVATE:STRING}"]
5 -> 6 [label = "t_9:{plain_string_0:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 insert_table_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0, count(*) as c, sum(ta.plain_int_0) as b, max(ta.plain_int_0) as a, min(ta.plain_int_0) as d from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0 group by ta.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_17,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_17,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="private_group:{in:[Key:{t_3,},],out:[GroupId:{t_18,},GroupNum:{t_19,},],attr:[],party:[alice,]}"]
5 [label="count:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_18,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
6 [label="sum:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
7 [label="max:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_3,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
8 [label="min:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_3,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
9 [label="firstrow:{in:[GroupId:{t_18,},GroupNum:{t_19,},In:{t_3,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
10 [label="constant:{in:[],out:[Out:{t_9,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
11 [label="broadcast_to:{in:[In:{t_9,},ShapeRefTensor:{t_4,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
12 [label="GreaterEqual:{in:[Left:{t_4,},Right:{t_10,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
13 [label="filter:{in:[Filter:{t_11,},In:{t_4,t_5,t_6,t_7,t_8,},],out:[Out:{t_12,t_13,t_14,t_15,t_16,},],attr:[],party:[alice,]}"]
14 [label="publish_result:{in:[In:{t_16,t_12,t_13,t_14,t_15,},],out:[Out:{t_20,t_21,t_22,t_23,t_24,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_9:{constant_data:PUBLIC:INT64}"]
11 -> 12 [label = "t_10:{constant_data:PRIVATE:INT64}"]
12 -> 13 [label = "t_11:{ge_out:PRIVATE:BOOL}"]
13 -> 14 [label = "t_12:{simple_count_result:PRIVATE:INT64}"]
13 -> 14 [label = "t_13:{plain_int_0_sum:PRIVATE:INT64}"]
13 -> 14 [label = "t_14:{plain_int_0_max:PRIVATE:INT64}"]
13 -> 14 [label = "t_15:{plain_int_0_min:PRIVATE:INT64}"]
13 -> 14 [label = "t_16:{plain_int_0_firstrow:PRIVATE:INT64}"]
2 -> 3 [label = "t_17:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 9 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_18:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_18:{group_id:PRIVATE:INT64}"]
4 -> 5 [label = "t_19:{group_num:PRIVATE:INT64}"]
4 -> 6 [label = "t_18:{group_id:PRIVATE:INT64}"]
4 -> 6 [label = "t_19:{group_num:PRIVATE:INT64}"]
4 -> 7 [label = "t_18:{group_id:PRIVATE:INT64}"]
4 -> 7 [label = "t_19:{group_num:PRIVATE:INT64}"]
4 -> 8 [label = "t_18:{group_id:PRIVATE:INT64}"]
4 -> 8 [label = "t_19:{group_num:PRIVATE:INT64}"]
4 -> 9 [label = "t_18:{group_id:PRIVATE:INT64}"]
4 -> 9 [label = "t_19:{group_num:PRIVATE:INT64}"]
5 -> 11 [label = "t_4:{simple_count_result:PRIVATE:INT64}"]
5 -> 12 [label = "t_4:{simple_count_result:PRIVATE:INT64}"]
5 -> 13 [label = "t_4:{simple_count_result:PRIVATE:INT64}"]
6 -> 13 [label = "t_5:{plain_int_0_sum:PRIVATE:INT64}"]
7 -> 13 [label = "t_6:{plain_int_0_max:PRIVATE:INT64}"]
8 -> 13 [label = "t_7:{plain_int_0_min:PRIVATE:INT64}"]
9 -> 13 [label = "t_8:{plain_int_0_firstrow:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 private_group_4 count_5 sum_6 max_7 min_8 firstrow_9 constant_10 broadcast_to_11 GreaterEqual_12 filter_13 publish_result_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.groupby_int_0, count(distinct(ta.compare_int_0)), sum(ta.compare_int_0) as b, max(ta.compare_int_0) as a, min(ta.compare_int_0) as d from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0 group by ta.groupby_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,},],attr:[sql:select ta.plain_int_0,ta.groupby_int_0,ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="bucket:{in:[In:{t_1,t_2,t_3,},Key:{t_1,},],out:[Out:{t_22,t_23,t_24,},],attr:[input_party_codes:[alice],],party:[alice,]}"]
3 [label="bucket:{in:[In:{t_4,},Key:{t_4,},],out:[Out:{t_25,},],attr:[input_party_codes:[bob],],party:[bob,]}"]
4 [label="psi_join:{in:[Left:{t_22,},Right:{t_25,},],out:[LeftJoinIndex:{t_26,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
5 [label="filter_by_index:{in:[Data:{t_23,t_24,},RowsIndexFilter:{t_26,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
6 [label="private_group:{in:[Key:{t_5,},],out:[GroupId:{t_27,},GroupNum:{t_28,},],attr:[],party:[alice,]}"]
7 [label="count:{in:[GroupId:{t_27,},GroupNum:{t_28,},In:{t_27,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
8 [label="count_distinct:{in:[GroupId:{t_27,},GroupNum:{t_28,},In:{t_6,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
9 [label="sum:{in:[GroupId:{t_27,},GroupNum:{t_28,},In:{t_6,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
10 [label="max:{in:[GroupId:{t_27,},GroupNum:{t_28,},In:{t_6,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
11 [label="min:{in:[GroupId:{t_27,},GroupNum:{t_28,},In:{t_6,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
12 [label="firstrow:{in:[GroupId:{t_27,},GroupNum:{t_28,},In:{t_5,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
13 [label="constant:{in:[],out:[Out:{t_13,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
14 [label="broadcast_to:{in:[In:{t_13,},ShapeRefTensor:{t_12,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
15 [label="GreaterEqual:{in:[Left:{t_12,},Right:{t_14,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
16 [label="filter:{in:[Filter:{t_15,},In:{t_7,t_8,t_9,t_10,t_11,t_12,},],out:[Out:{t_16,t_17,t_18,t_19,t_20,t_21,},],attr:[],party:[alice,]}"]
17 [label="publish_result:{in:[In:{t_20,t_16,t_17,t_18,t_19,},],out:[Out:{t_29,t_30,t_31,t_32,t_33,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 2 [label = "t_2:{groupby_int_0:PRIVATE:INT64}"]
0 -> 2 [label = "t_3:{compare_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
10 -> 16 [label = "t_9:{compare_int_0_max:PRIVATE:INT64}"]
11 -> 16 [label = "t_10:{compare_int_0_min:PRIVATE:INT64}"]
12 -> 16 [label = "t_11:{groupby_int_0_firstrow:PRIVATE:INT64}"]
13 -> 14 [label = "t_13:{constant_data:PUBLIC:INT64}"]
14 -> 15 [label = "t_14:{constant_data:PRIVATE:INT64}"]
15 -> 16 [label = "t_15:{ge_out:PRIVATE:BOOL}"]
16 -> 17 [label = "t_16:{compare_int_0_count:PRIVATE:INT64}"]
16 -> 17 [label = "t_17:{compare_int_0_sum:PRIVATE:INT64}"]
16 -> 17 [label = "t_18:{compare_int_0_max:PRIVATE:INT64}"]
16 -> 17 [label = "t_19:{compare_int_0_min:PRIVATE:INT64}"]
16 -> 17 [label = "t_20:{groupby_int_0_firstrow:PRIVATE:INT64}"]
2 -> 4 [label = "t_22:{plain_int_0:PRIVATE:INT64}"]
2 -> 5 [label = "t_23:{groupby_int_0:PRIVATE:INT64}"]
2 -> 5 [label = "t_24:{compare_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_25:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_26:{left_index:PRIVATE:INT64}"]
5 -> 10 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 11 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 12 [label = "t_5:{groupby_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_5:{groupby_int_0:PRIVATE:INT64}"]
5 -> 8 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 9 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 10 [label = "t_28:{group_num:PRIVATE:INT64}"]
6 -> 11 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 11 [label = "t_28:{group_num:PRIVATE:INT64}"]
6 -> 12 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 12 [label = "t_28:{group_num:PRIVATE:INT64}"]
6 -> 7 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 7 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 7 [label = "t_28:{group_num:PRIVATE:INT64}"]
6 -> 8 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 8 [label = "t_28:{group_num:PRIVATE:INT64}"]
6 -> 9 [label = "t_27:{group_id:PRIVATE:INT64}"]
6 -> 9 [label = "t_28:{group_num:PRIVATE:INT64}"]
7 -> 14 [label = "t_12:{simple_count_result:PRIVATE:INT64}"]
7 -> 15 [label = "t_12:{simple_count_result:PRIVATE:INT64}"]
7 -> 16 [label = "t_12:{simple_count_result:PRIVATE:INT64}"]
8 -> 16 [label = "t_7:{compare_int_0_count:PRIVATE:INT64}"]
9 -> 16 [label = "t_8:{compare_int_0_sum:PRIVATE:INT64}"]
}`, `Batched pipeline with 1 nodes`, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select count(distinct(ta.compare_int_0)), sum(ta.compare_int_0) as b, max(ta.compare_int_0) as a, min(ta.compare_int_0) as d from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_9,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="unique:{in:[Key:{t_4,},],out:[UniqueKey:{t_10,},],attr:[],party:[alice,]}"]
5 [label="reduce[count]:{in:[In:{t_10,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
6 [label="reduce[sum]:{in:[In:{t_4,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
7 [label="reduce[max]:{in:[In:{t_4,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
8 [label="reduce[min]:{in:[In:{t_4,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
9 [label="publish_result:{in:[In:{t_5,t_6,t_7,t_8,},],out:[Out:{t_11,t_12,t_13,t_14,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_10:{compare_int_0:PRIVATE:INT64}"]
5 -> 9 [label = "t_5:{compare_int_0_count:PRIVATE:INT64}"]
6 -> 9 [label = "t_6:{compare_int_0_sum:PRIVATE:INT64}"]
7 -> 9 [label = "t_7:{compare_int_0_max:PRIVATE:INT64}"]
8 -> 9 [label = "t_8:{compare_int_0_min:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 unique_4 reduce[count]_5 reduce[sum]_6 reduce[max]_7 reduce[min]_8 publish_result_9]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_4,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_4,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 from alice.tbl_0 as ta left join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_5,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:1,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_5,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_4,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_5:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 from alice.tbl_0 as ta left join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 left join carol.tbl_0 as tc on tb.join_int_1 = tc.join_int_1`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'join_int_1' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_3,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{t_10,},],attr:[input_party_codes:[alice bob],join_type:1,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_9,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_10,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_7,},],attr:[sql:select tc.join_int_1 from carol.tbl_0 as tc;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_6,},Right:{t_7,},],out:[LeftJoinIndex:{t_11,},RightJoinIndex:{},],attr:[input_party_codes:[bob carol],join_type:1,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_11,},],out:[Out:{t_12,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_12,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
9 [label="publish_result:{in:[In:{t_8,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{join_int_1:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_10:{right_index:PRIVATE:INT64}"]
3 -> 8 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_6:{join_int_1:PRIVATE:INT64}"]
5 -> 6 [label = "t_7:{join_int_1:PRIVATE:INT64}"]
6 -> 7 [label = "t_11:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_12:{left_index:PRIVATE:INT64}"]
8 -> 9 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 publish_result_9]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select max(ta.aggregate_float_0 + ta.aggregate_float_0) from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.aggregate_float_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_7,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_7,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="Add:{in:[Left:{t_4,},Right:{t_4,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
5 [label="reduce[max]:{in:[In:{t_5,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
6 [label="publish_result:{in:[In:{t_6,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{aggregate_float_0:PRIVATE:FLOAT64}"]
1 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_7:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_4:{aggregate_float_0:PRIVATE:FLOAT64}"]
3 -> 4 [label = "t_4:{aggregate_float_0:PRIVATE:FLOAT64}"]
4 -> 5 [label = "t_5:{plus_out:PRIVATE:FLOAT64}"]
5 -> 6 [label = "t_6:{plus_out_max:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 Add_4 reduce[max]_5 publish_result_6]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) as c, sum(ta.plain_int_0) as b, max(ta.plain_int_0) as a, min(ta.plain_int_0) as d, avg(ta.plain_int_0) as f from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_9,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="shape:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[axis:0,],party:[alice,]}"]
5 [label="reduce[sum]:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
6 [label="reduce[max]:{in:[In:{t_3,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
7 [label="reduce[min]:{in:[In:{t_3,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
8 [label="reduce[avg]:{in:[In:{t_3,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
9 [label="publish_result:{in:[In:{t_4,t_5,t_6,t_7,t_8,},],out:[Out:{t_10,t_11,t_12,t_13,t_14,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 7 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_4:{plain_int_0_count:PRIVATE:INT64}"]
5 -> 9 [label = "t_5:{plain_int_0_sum:PRIVATE:INT64}"]
6 -> 9 [label = "t_6:{plain_int_0_max:PRIVATE:INT64}"]
7 -> 9 [label = "t_7:{plain_int_0_min:PRIVATE:INT64}"]
8 -> 9 [label = "t_8:{plain_int_0_avg:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 shape_4 reduce[sum]_5 reduce[max]_6 reduce[min]_7 reduce[avg]_8 publish_result_9]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0 where ta.plain_int_1 > tb.plain_int_1`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.plain_int_1 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'plain_int_1' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_10,},RightJoinIndex:{t_11,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_10,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_11,},],out:[Out:{t_7,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_7,},],out:[Out:{t_12,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="Greater:{in:[Left:{t_6,},Right:{t_12,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
7 [label="filter:{in:[Filter:{t_8,},In:{t_5,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
8 [label="publish_result:{in:[In:{t_9,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{plain_int_1:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{plain_int_1:PRIVATE:INT64}"]
2 -> 3 [label = "t_10:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_11:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_6:{plain_int_1:PRIVATE:INT64}"]
3 -> 7 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_7:{plain_int_1:PRIVATE:INT64}"]
5 -> 6 [label = "t_12:{plain_int_1:PRIVATE:INT64}"]
6 -> 7 [label = "t_8:{gt_out:PRIVATE:BOOL}"]
7 -> 8 [label = "t_9:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 Greater_6 filter_7 publish_result_8]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 * tb.plain_int_0 as t1, ta.plain_int_0 + tb.plain_int_0 as t2, ta.plain_int_0 - tb.plain_int_0 as t3, ta.plain_int_0 / tb.plain_int_0 as t1 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0 where ta.plain_int_1 > tb.plain_int_1`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.plain_int_1 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'plain_int_1' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_17,},RightJoinIndex:{t_18,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_17,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_3,t_4,},RowsIndexFilter:{t_18,},],out:[Out:{t_7,t_8,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_8,},],out:[Out:{t_19,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="Greater:{in:[Left:{t_6,},Right:{t_19,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
7 [label="copy:{in:[In:{t_7,},],out:[Out:{t_20,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter:{in:[Filter:{t_9,},In:{t_5,t_20,},],out:[Out:{t_10,t_11,},],attr:[],party:[alice,]}"]
9 [label="Mul:{in:[Left:{t_10,},Right:{t_11,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
10 [label="Add:{in:[Left:{t_10,},Right:{t_11,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
11 [label="Minus:{in:[Left:{t_10,},Right:{t_11,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
12 [label="Cast:{in:[In:{t_10,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
13 [label="Div:{in:[Left:{t_15,},Right:{t_11,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
14 [label="publish_result:{in:[In:{t_12,t_13,t_14,t_16,},],out:[Out:{t_21,t_22,t_23,t_24,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{plain_int_1:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{plain_int_1:PRIVATE:INT64}"]
10 -> 14 [label = "t_13:{plus_out:PRIVATE:INT64}"]
11 -> 14 [label = "t_14:{minus_out:PRIVATE:INT64}"]
12 -> 13 [label = "t_15:{plain_int_0:PRIVATE:FLOAT64}"]
13 -> 14 [label = "t_16:{div_out:PRIVATE:FLOAT64}"]
2 -> 3 [label = "t_17:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_18:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_6:{plain_int_1:PRIVATE:INT64}"]
3 -> 8 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_8:{plain_int_1:PRIVATE:INT64}"]
4 -> 7 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_19:{plain_int_1:PRIVATE:INT64}"]
6 -> 8 [label = "t_9:{gt_out:PRIVATE:BOOL}"]
7 -> 8 [label = "t_20:{plain_int_0:PRIVATE:INT64}"]
8 -> 10 [label = "t_10:{plain_int_0:PRIVATE:INT64}"]
8 -> 10 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
8 -> 11 [label = "t_10:{plain_int_0:PRIVATE:INT64}"]
8 -> 11 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
8 -> 12 [label = "t_10:{plain_int_0:PRIVATE:INT64}"]
8 -> 13 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
8 -> 9 [label = "t_10:{plain_int_0:PRIVATE:INT64}"]
8 -> 9 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
9 -> 14 [label = "t_12:{mul_out:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 Greater_6 copy_7 filter_8 Mul_9 Add_10 Minus_11 Cast_12 Div_13 publish_result_14]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0 where ta.plain_int_1 > tb.plain_int_1 and ta.compare_int_0 < tb.compare_int_0 and ta.compare_int_1 <> tb.compare_int_1 and ta.compare_int_2 >= tb.compare_int_2 and ta.compare_float_0 <= tb.compare_float_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,t_4,t_5,t_6,},],attr:[sql:select ta.plain_int_0,ta.compare_int_0,ta.compare_float_0,ta.plain_int_1,ta.compare_int_1,ta.compare_int_2 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_7,t_8,t_9,t_10,t_11,t_12,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'compare_int_0','tb'.'compare_float_0','tb'.'plain_int_1','tb'.'compare_int_1','tb'.'compare_int_2' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_7,},],out:[LeftJoinIndex:{t_34,},RightJoinIndex:{t_35,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,t_3,t_4,t_5,t_6,},RowsIndexFilter:{t_34,},],out:[Out:{t_13,t_14,t_15,t_16,t_17,t_18,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_8,t_9,t_10,t_11,t_12,},RowsIndexFilter:{t_35,},],out:[Out:{t_19,t_20,t_21,t_22,t_23,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_21,},],out:[Out:{t_36,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="Greater:{in:[Left:{t_16,},Right:{t_36,},],out:[Out:{t_24,},],attr:[],party:[alice,]}"]
7 [label="make_share:{in:[In:{t_14,},],out:[Out:{t_37,},],attr:[],party:[alice,bob,]}"]
8 [label="make_share:{in:[In:{t_19,},],out:[Out:{t_38,},],attr:[],party:[alice,bob,]}"]
9 [label="Less:{in:[Left:{t_37,},Right:{t_38,},],out:[Out:{t_25,},],attr:[],party:[alice,bob,]}"]
10 [label="make_share:{in:[In:{t_17,},],out:[Out:{t_39,},],attr:[],party:[alice,bob,]}"]
11 [label="make_share:{in:[In:{t_22,},],out:[Out:{t_40,},],attr:[],party:[alice,bob,]}"]
12 [label="NotEqual:{in:[Left:{t_39,},Right:{t_40,},],out:[Out:{t_26,},],attr:[],party:[alice,bob,]}"]
13 [label="make_share:{in:[In:{t_18,},],out:[Out:{t_41,},],attr:[],party:[alice,bob,]}"]
14 [label="make_share:{in:[In:{t_23,},],out:[Out:{t_42,},],attr:[],party:[alice,bob,]}"]
15 [label="GreaterEqual:{in:[Left:{t_41,},Right:{t_42,},],out:[Out:{t_27,},],attr:[],party:[alice,bob,]}"]
16 [label="make_share:{in:[In:{t_15,},],out:[Out:{t_43,},],attr:[],party:[alice,bob,]}"]
17 [label="make_share:{in:[In:{t_20,},],out:[Out:{t_44,},],attr:[],party:[alice,bob,]}"]
18 [label="LessEqual:{in:[Left:{t_43,},Right:{t_44,},],out:[Out:{t_28,},],attr:[],party:[alice,bob,]}"]
19 [label="make_public:{in:[In:{t_24,},],out:[Out:{t_45,},],attr:[],party:[alice,bob,]}"]
20 [label="LogicalAnd:{in:[Left:{t_45,},Right:{t_25,},],out:[Out:{t_29,},],attr:[],party:[alice,bob,]}"]
21 [label="LogicalAnd:{in:[Left:{t_29,},Right:{t_26,},],out:[Out:{t_30,},],attr:[],party:[alice,bob,]}"]
22 [label="LogicalAnd:{in:[Left:{t_30,},Right:{t_27,},],out:[Out:{t_31,},],attr:[],party:[alice,bob,]}"]
23 [label="LogicalAnd:{in:[Left:{t_31,},Right:{t_28,},],out:[Out:{t_32,},],attr:[],party:[alice,bob,]}"]
24 [label="make_private:{in:[In:{t_32,},],out:[Out:{t_46,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
25 [label="filter:{in:[Filter:{t_46,},In:{t_13,},],out:[Out:{t_33,},],attr:[],party:[alice,]}"]
26 [label="publish_result:{in:[In:{t_33,},],out:[Out:{t_47,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{compare_float_0:PRIVATE:FLOAT64}"]
0 -> 3 [label = "t_4:{plain_int_1:PRIVATE:INT64}"]
0 -> 3 [label = "t_5:{compare_int_1:PRIVATE:INT64}"]
0 -> 3 [label = "t_6:{compare_int_2:PRIVATE:INT64}"]
1 -> 2 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_10:{plain_int_1:PRIVATE:INT64}"]
1 -> 4 [label = "t_11:{compare_int_1:PRIVATE:INT64}"]
1 -> 4 [label = "t_12:{compare_int_2:PRIVATE:INT64}"]
1 -> 4 [label = "t_8:{compare_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_9:{compare_float_0:PRIVATE:FLOAT64}"]
10 -> 12 [label = "t_39:{compare_int_1:SECRET:INT64}"]
11 -> 12 [label = "t_40:{compare_int_1:SECRET:INT64}"]
12 -> 21 [label = "t_26:{ne_out:SECRET:BOOL}"]
13 -> 15 [label = "t_41:{compare_int_2:SECRET:INT64}"]
14 -> 15 [label = "t_42:{compare_int_2:SECRET:INT64}"]
15 -> 22 [label = "t_27:{ge_out:SECRET:BOOL}"]
16 -> 18 [label = "t_43:{compare_float_0:SECRET:FLOAT64}"]
17 -> 18 [label = "t_44:{compare_float_0:SECRET:FLOAT64}"]
18 -> 23 [label = "t_28:{le_out:SECRET:BOOL}"]
19 -> 20 [label = "t_45:{gt_out:PUBLIC:BOOL}"]
2 -> 3 [label = "t_34:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_35:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_29:{and_out:SECRET:BOOL}"]
21 -> 22 [label = "t_30:{and_out:SECRET:BOOL}"]
22 -> 23 [label = "t_31:{and_out:SECRET:BOOL}"]
23 -> 24 [label = "t_32:{and_out:SECRET:BOOL}"]
24 -> 25 [label = "t_46:{and_out:PRIVATE:BOOL}"]
25 -> 26 [label = "t_33:{plain_int_0:PRIVATE:INT64}"]
3 -> 10 [label = "t_17:{compare_int_1:PRIVATE:INT64}"]
3 -> 13 [label = "t_18:{compare_int_2:PRIVATE:INT64}"]
3 -> 16 [label = "t_15:{compare_float_0:PRIVATE:FLOAT64}"]
3 -> 25 [label = "t_13:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_16:{plain_int_1:PRIVATE:INT64}"]
3 -> 7 [label = "t_14:{compare_int_0:PRIVATE:INT64}"]
4 -> 11 [label = "t_22:{compare_int_1:PRIVATE:INT64}"]
4 -> 14 [label = "t_23:{compare_int_2:PRIVATE:INT64}"]
4 -> 17 [label = "t_20:{compare_float_0:PRIVATE:FLOAT64}"]
4 -> 5 [label = "t_21:{plain_int_1:PRIVATE:INT64}"]
4 -> 8 [label = "t_19:{compare_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_36:{plain_int_1:PRIVATE:INT64}"]
6 -> 19 [label = "t_24:{gt_out:PRIVATE:BOOL}"]
7 -> 9 [label = "t_37:{compare_int_0:SECRET:INT64}"]
8 -> 9 [label = "t_38:{compare_int_0:SECRET:INT64}"]
9 -> 20 [label = "t_25:{lt_out:SECRET:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 Greater_6 make_share_7 make_share_8 Less_9 make_share_10 make_share_11 NotEqual_12 make_share_13 make_share_14 GreaterEqual_15 make_share_16 make_share_17 LessEqual_18 make_public_19 LogicalAnd_20 LogicalAnd_21 LogicalAnd_22 LogicalAnd_23 make_private_24 filter_25 publish_result_26]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.join_int_0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_4,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_4,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.join_int_0 + 1 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.join_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'join_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_7,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_7,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="constant:{in:[],out:[Out:{t_4,},],attr:[scalar:1,to_status:1,],party:[alice,bob,]}"]
5 [label="broadcast_to:{in:[In:{t_4,},ShapeRefTensor:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
6 [label="Add:{in:[Left:{t_3,},Right:{t_5,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
7 [label="publish_result:{in:[In:{t_6,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_7:{left_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_4:{constant_data:PUBLIC:INT64}"]
5 -> 6 [label = "t_5:{constant_data:PRIVATE:INT64}"]
6 -> 7 [label = "t_6:{plus_out:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 constant_4 broadcast_to_5 Add_6 publish_result_7]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.join_int_0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.join_int_0 = tb.join_int_0 where ta.compare_int_0 > tb.compare_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.join_int_0,ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'join_int_0','tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_10,},RightJoinIndex:{t_11,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_10,},],out:[Out:{t_5,t_6,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_11,},],out:[Out:{t_7,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_12,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,]}"]
7 [label="Greater:{in:[Left:{t_12,},Right:{t_13,},],out:[Out:{t_8,},],attr:[],party:[alice,bob,]}"]
8 [label="make_private:{in:[In:{t_8,},],out:[Out:{t_14,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
9 [label="filter:{in:[Filter:{t_14,},In:{t_5,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
10 [label="publish_result:{in:[In:{t_9,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_10:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_11:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
3 -> 9 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_7:{compare_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_12:{compare_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_13:{compare_int_0:SECRET:INT64}"]
7 -> 8 [label = "t_8:{gt_out:SECRET:BOOL}"]
8 -> 9 [label = "t_14:{gt_out:PRIVATE:BOOL}"]
9 -> 10 [label = "t_9:{join_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 Greater_7 make_private_8 filter_9 publish_result_10]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 in (1,2,3) from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_15,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_15,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="constant:{in:[],out:[Out:{t_4,},],attr:[scalar:1,to_status:1,],party:[alice,bob,]}"]
5 [label="broadcast_to:{in:[In:{t_4,},ShapeRefTensor:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
6 [label="Equal:{in:[Left:{t_3,},Right:{t_5,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
7 [label="constant:{in:[],out:[Out:{t_7,},],attr:[scalar:2,to_status:1,],party:[alice,bob,]}"]
8 [label="broadcast_to:{in:[In:{t_7,},ShapeRefTensor:{t_3,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
9 [label="Equal:{in:[Left:{t_3,},Right:{t_8,},],out:[Out:{t_9,},],attr:[],party:[alice,]}"]
10 [label="constant:{in:[],out:[Out:{t_10,},],attr:[scalar:3,to_status:1,],party:[alice,bob,]}"]
11 [label="broadcast_to:{in:[In:{t_10,},ShapeRefTensor:{t_3,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
12 [label="Equal:{in:[Left:{t_3,},Right:{t_11,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
13 [label="LogicalOr:{in:[Left:{t_9,},Right:{t_12,},],out:[Out:{t_13,},],attr:[],party:[alice,]}"]
14 [label="LogicalOr:{in:[Left:{t_6,},Right:{t_13,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
15 [label="publish_result:{in:[In:{t_14,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_10:{constant_data:PUBLIC:INT64}"]
11 -> 12 [label = "t_11:{constant_data:PRIVATE:INT64}"]
12 -> 13 [label = "t_12:{eq_out:PRIVATE:BOOL}"]
13 -> 14 [label = "t_13:{or_out:PRIVATE:BOOL}"]
14 -> 15 [label = "t_14:{or_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_15:{left_index:PRIVATE:INT64}"]
3 -> 11 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 12 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
3 -> 9 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_4:{constant_data:PUBLIC:INT64}"]
5 -> 6 [label = "t_5:{constant_data:PRIVATE:INT64}"]
6 -> 14 [label = "t_6:{eq_out:PRIVATE:BOOL}"]
7 -> 8 [label = "t_7:{constant_data:PUBLIC:INT64}"]
8 -> 9 [label = "t_8:{constant_data:PRIVATE:INT64}"]
9 -> 13 [label = "t_9:{eq_out:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 constant_4 broadcast_to_5 Equal_6 constant_7 broadcast_to_8 Equal_9 constant_10 broadcast_to_11 Equal_12 LogicalOr_13 LogicalOr_14 publish_result_15]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.plain_int_0 in (select tb.plain_int_0 from bob.tbl_0 as tb) from alice.tbl_0 as ta`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="copy:{in:[In:{t_2,},],out:[Out:{t_4,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
3 [label="in:{in:[Left:{t_1,},Right:{t_4,},],out:[Out:{t_3,},],attr:[in_type:2,input_party_codes:[alice alice],psi_algorithm:0,reveal_to:[alice],],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_3:{in_result:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 copy_2 in_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.compare_int_0 in (select tb.compare_int_0 from bob.tbl_0 as tb) from alice.tbl_0 as ta`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="in:{in:[Left:{t_1,},Right:{t_2,},],out:[Out:{t_3,},],attr:[in_type:0,input_party_codes:[alice bob],psi_algorithm:0,reveal_to:[alice],],party:[alice,bob,]}"]
3 [label="publish_result:{in:[In:{t_3,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_3:{in_result:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 in_2 publish_result_3]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.compare_int_0 from alice.tbl_0 as ta where ta.compare_int_0 in (select tb.compare_int_0 from bob.tbl_0 as tb)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="in:{in:[Left:{t_1,},Right:{t_2,},],out:[Out:{t_3,},],attr:[in_type:0,input_party_codes:[alice bob],psi_algorithm:0,reveal_to:[alice],],party:[alice,bob,]}"]
3 [label="filter:{in:[Filter:{t_3,},In:{t_1,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
4 [label="publish_result:{in:[In:{t_4,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{compare_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_3:{in_result:PRIVATE:BOOL}"]
3 -> 4 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 in_2 filter_3 publish_result_4]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.compare_int_0 from alice.tbl_0 as ta where ta.compare_int_0 not in (select tb.compare_int_0 from bob.tbl_0 as tb)`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="in:{in:[Left:{t_1,},Right:{t_2,},],out:[Out:{t_3,},],attr:[in_type:0,input_party_codes:[alice bob],psi_algorithm:0,reveal_to:[alice],],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_3,},],out:[Out:{t_6,},],attr:[],party:[alice,bob,]}"]
4 [label="Not:{in:[In:{t_6,},],out:[Out:{t_4,},],attr:[],party:[alice,bob,]}"]
5 [label="make_private:{in:[In:{t_4,},],out:[Out:{t_7,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
6 [label="filter:{in:[Filter:{t_7,},In:{t_1,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
7 [label="publish_result:{in:[In:{t_5,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{compare_int_0:PRIVATE:INT64}"]
0 -> 6 [label = "t_1:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_3:{in_result:PRIVATE:BOOL}"]
3 -> 4 [label = "t_6:{in_result:SECRET:BOOL}"]
4 -> 5 [label = "t_4:{not_out:SECRET:BOOL}"]
5 -> 6 [label = "t_7:{not_out:PRIVATE:BOOL}"]
6 -> 7 [label = "t_5:{compare_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 in_2 make_share_3 Not_4 make_private_5 filter_6 publish_result_7]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select not(ta.plain_int_0 > tb.plain_int_0) from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.plain_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select 'tb'.'plain_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_2,},],out:[LeftJoinIndex:{t_7,},RightJoinIndex:{t_8,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_7,},],out:[Out:{t_3,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_8,},],out:[Out:{t_4,},],attr:[],party:[bob,]}"]
5 [label="copy:{in:[In:{t_4,},],out:[Out:{t_9,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
6 [label="Greater:{in:[Left:{t_3,},Right:{t_9,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
7 [label="Not:{in:[In:{t_5,},],out:[Out:{t_6,},],attr:[],party:[alice,]}"]
8 [label="publish_result:{in:[In:{t_6,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_7:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_8:{right_index:PRIVATE:INT64}"]
3 -> 6 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_9:{plain_int_0:PRIVATE:INT64}"]
6 -> 7 [label = "t_5:{gt_out:PRIVATE:BOOL}"]
7 -> 8 [label = "t_6:{not_out:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 copy_5 Greater_6 Not_7 publish_result_8]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select not(ta.compare_int_0 > tb.compare_int_0) from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{t_10,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_9,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_10,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_11,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_12,},],attr:[],party:[alice,bob,]}"]
7 [label="Greater:{in:[Left:{t_11,},Right:{t_12,},],out:[Out:{t_7,},],attr:[],party:[alice,bob,]}"]
8 [label="make_private:{in:[In:{t_7,},],out:[Out:{t_13,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
9 [label="Not:{in:[In:{t_13,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
10 [label="publish_result:{in:[In:{t_8,},],out:[Out:{t_14,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_10:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{compare_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_11:{compare_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_12:{compare_int_0:SECRET:INT64}"]
7 -> 8 [label = "t_7:{gt_out:SECRET:BOOL}"]
8 -> 9 [label = "t_13:{gt_out:PRIVATE:BOOL}"]
9 -> 10 [label = "t_8:{not_out:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 Greater_7 make_private_8 Not_9 publish_result_10]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select (ta.compare_int_0 + tb.compare_int_0 - 3) > 0 from alice.tbl_0 as ta join bob.tbl_0 as tb on ta.plain_int_0 = tb.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select ta.plain_int_0,ta.compare_int_0 from alice.tbl_0 as ta;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'compare_int_0' from 'bob'.'tbl_0' as 'tb';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_14,},RightJoinIndex:{t_15,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_14,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_15,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_16,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_17,},],attr:[],party:[alice,bob,]}"]
7 [label="Add:{in:[Left:{t_16,},Right:{t_17,},],out:[Out:{t_7,},],attr:[],party:[alice,bob,]}"]
8 [label="constant:{in:[],out:[Out:{t_8,},],attr:[scalar:3,to_status:1,],party:[alice,bob,]}"]
9 [label="broadcast_to:{in:[In:{t_8,},ShapeRefTensor:{t_7,},],out:[Out:{t_9,},],attr:[],party:[alice,bob,]}"]
10 [label="Minus:{in:[Left:{t_7,},Right:{t_9,},],out:[Out:{t_10,},],attr:[],party:[alice,bob,]}"]
11 [label="constant:{in:[],out:[Out:{t_11,},],attr:[scalar:0,to_status:1,],party:[alice,bob,]}"]
12 [label="broadcast_to:{in:[In:{t_11,},ShapeRefTensor:{t_10,},],out:[Out:{t_12,},],attr:[],party:[alice,bob,]}"]
13 [label="Greater:{in:[Left:{t_10,},Right:{t_12,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,]}"]
14 [label="make_private:{in:[In:{t_13,},],out:[Out:{t_18,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
15 [label="publish_result:{in:[In:{t_18,},],out:[Out:{t_19,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{compare_int_0:PRIVATE:INT64}"]
10 -> 12 [label = "t_10:{minus_out:SECRET:INT64}"]
10 -> 13 [label = "t_10:{minus_out:SECRET:INT64}"]
11 -> 12 [label = "t_11:{constant_data:PUBLIC:INT64}"]
12 -> 13 [label = "t_12:{constant_data:PUBLIC:INT64}"]
13 -> 14 [label = "t_13:{gt_out:SECRET:BOOL}"]
14 -> 15 [label = "t_18:{gt_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_14:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_15:{right_index:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{compare_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_16:{compare_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_17:{compare_int_0:SECRET:INT64}"]
7 -> 10 [label = "t_7:{plus_out:SECRET:INT64}"]
7 -> 9 [label = "t_7:{plus_out:SECRET:INT64}"]
8 -> 9 [label = "t_8:{constant_data:PUBLIC:INT64}"]
9 -> 10 [label = "t_9:{constant_data:PUBLIC:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 Add_7 constant_8 broadcast_to_9 Minus_10 constant_11 broadcast_to_12 Greater_13 make_private_14 publish_result_15]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select distinct groupby_int_0 from (select ta.groupby_int_0 from alice.tbl_0 as ta union all select tb.groupby_int_0 from bob.tbl_0 as tb) as tt`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select any_value(ta.groupby_int_0) as expr_242 from alice.tbl_0 as ta group by ta.groupby_int_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 'tb'.'groupby_int_0' from 'bob'.'tbl_0' as 'tb' group by 'tb'.'groupby_int_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_2,},],out:[Out:{t_7,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_4,},],out:[Out:{t_8,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_7,t_8,},],out:[Out:{t_5,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="sort:{in:[In:{t_5,t_5,},Key:{t_5,},],out:[Out:{t_9,t_10,},],attr:[reverse:[false],],party:[alice,bob,]}"]
6 [label="oblivious_group_mark:{in:[Key:{t_9,},],out:[Group:{t_11,},],attr:[],party:[alice,bob,]}"]
7 [label="shuffle:{in:[In:{t_10,t_11,},],out:[Out:{t_12,t_13,},],attr:[],party:[alice,bob,]}"]
8 [label="make_public:{in:[In:{t_13,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
9 [label="filter:{in:[Filter:{t_14,},In:{t_12,},],out:[Out:{t_6,},],attr:[],party:[alice,bob,]}"]
10 [label="make_private:{in:[In:{t_6,},],out:[Out:{t_15,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
11 [label="publish_result:{in:[In:{t_15,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{groupby_int_0_firstrow:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{groupby_int_0_firstrow:PRIVATE:INT64}"]
10 -> 11 [label = "t_15:{groupby_int_0_firstrow_firstrow:PRIVATE:INT64}"]
2 -> 4 [label = "t_7:{groupby_int_0_firstrow:SECRET:INT64}"]
3 -> 4 [label = "t_8:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{groupby_int_0_firstrow:SECRET:INT64}"]
5 -> 6 [label = "t_9:{groupby_int_0_firstrow:SECRET:INT64}"]
5 -> 7 [label = "t_10:{groupby_int_0_firstrow:SECRET:INT64}"]
6 -> 7 [label = "t_11:{group_mark:SECRET:BOOL}"]
7 -> 8 [label = "t_13:{group_mark:SECRET:BOOL}"]
7 -> 9 [label = "t_12:{groupby_int_0_firstrow:SECRET:INT64}"]
8 -> 9 [label = "t_14:{group_mark:PUBLIC:BOOL}"]
9 -> 10 [label = "t_6:{groupby_int_0_firstrow_firstrow:SECRET:INT64}"]
}`, ``, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select ta.groupby_int_0 from alice.tbl_0 as ta union select tb.groupby_int_0 from bob.tbl_0 as tb`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_2,},],attr:[sql:select any_value(ta.groupby_int_0) as expr_242 from alice.tbl_0 as ta group by ta.groupby_int_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 'tb'.'groupby_int_0' from 'bob'.'tbl_0' as 'tb' group by 'tb'.'groupby_int_0';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="make_share:{in:[In:{t_2,},],out:[Out:{t_7,},],attr:[],party:[alice,bob,]}"]
3 [label="make_share:{in:[In:{t_4,},],out:[Out:{t_8,},],attr:[],party:[alice,bob,]}"]
4 [label="concat:{in:[In:{t_7,t_8,},],out:[Out:{t_5,},],attr:[axis:0,],party:[alice,bob,]}"]
5 [label="sort:{in:[In:{t_5,t_5,},Key:{t_5,},],out:[Out:{t_9,t_10,},],attr:[reverse:[false],],party:[alice,bob,]}"]
6 [label="oblivious_group_mark:{in:[Key:{t_9,},],out:[Group:{t_11,},],attr:[],party:[alice,bob,]}"]
7 [label="shuffle:{in:[In:{t_10,t_11,},],out:[Out:{t_12,t_13,},],attr:[],party:[alice,bob,]}"]
8 [label="make_public:{in:[In:{t_13,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
9 [label="filter:{in:[Filter:{t_14,},In:{t_12,},],out:[Out:{t_6,},],attr:[],party:[alice,bob,]}"]
10 [label="make_private:{in:[In:{t_6,},],out:[Out:{t_15,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
11 [label="publish_result:{in:[In:{t_15,},],out:[Out:{t_16,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{groupby_int_0_firstrow:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{groupby_int_0_firstrow:PRIVATE:INT64}"]
10 -> 11 [label = "t_15:{groupby_int_0_firstrow_firstrow:PRIVATE:INT64}"]
2 -> 4 [label = "t_7:{groupby_int_0_firstrow:SECRET:INT64}"]
3 -> 4 [label = "t_8:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{groupby_int_0_firstrow:SECRET:INT64}"]
4 -> 5 [label = "t_5:{groupby_int_0_firstrow:SECRET:INT64}"]
5 -> 6 [label = "t_9:{groupby_int_0_firstrow:SECRET:INT64}"]
5 -> 7 [label = "t_10:{groupby_int_0_firstrow:SECRET:INT64}"]
6 -> 7 [label = "t_11:{group_mark:SECRET:BOOL}"]
7 -> 8 [label = "t_13:{group_mark:SECRET:BOOL}"]
7 -> 9 [label = "t_12:{groupby_int_0_firstrow:SECRET:INT64}"]
8 -> 9 [label = "t_14:{group_mark:PUBLIC:BOOL}"]
9 -> 10 [label = "t_6:{groupby_int_0_firstrow_firstrow:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 make_share_2 make_share_3 concat_4 sort_5 oblivious_group_mark_6 shuffle_7 make_public_8 filter_9 make_private_10 publish_result_11]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select plain_float_0 from (select plain_float_0 from alice.tbl_1 union all select plain_float_0 from alice.tbl_2) as tt group by plain_float_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_13,},],attr:[sql:select any_value(tt.expr_243) as plain_float_0 from ((select any_value(tbl_1.plain_float_0) as expr_243,count(1) as expr_244 from alice.tbl_1 group by tbl_1.plain_float_0) union all (select any_value(tbl_2.plain_float_0) as expr_243,count(1) as expr_244 from alice.tbl_2 group by tbl_2.plain_float_0)) as tt group by tt.expr_243 having count(tt.expr_244)>=4;,table_refs:[alice.tbl_1 alice.tbl_2],],party:[alice,]}"]
1 [label="publish_result:{in:[In:{t_13,},],out:[Out:{t_15,},],attr:[],party:[alice,]}"]
0 -> 1 [label = "t_13:{plain_float_0_firstrow_firstrow:PRIVATE:FLOAT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 publish_result_1]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*), max(aggregate_int_0) from (select aggregate_int_0, groupby_int_0 from alice.tbl_0 union all select aggregate_int_0, groupby_int_0 from bob.tbl_1 union all select aggregate_int_0, groupby_int_0 from carol.tbl_2) as u`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_2,t_3,},],attr:[sql:select count(1) as expr_365,max(tbl_0.aggregate_int_0) as expr_366 from alice.tbl_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_5,t_6,},],attr:[sql:select count(1) as 'expr_365',max('tbl_1'.'aggregate_int_0') as 'expr_366' from 'bob'.'tbl_1';,table_refs:[bob.tbl_1],],party:[bob,]}"]
2 [label="run_sql:{in:[],out:[Out:{t_8,t_9,},],attr:[sql:select count(1) as expr_365,max(tbl_2.aggregate_int_0) as expr_366 from carol.tbl_2;,table_refs:[carol.tbl_2],],party:[carol,]}"]
3 [label="make_share:{in:[In:{t_2,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,carol,]}"]
4 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,carol,]}"]
5 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_16,},],attr:[],party:[alice,bob,carol,]}"]
6 [label="concat:{in:[In:{t_14,t_15,t_16,},],out:[Out:{t_10,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
7 [label="make_share:{in:[In:{t_3,},],out:[Out:{t_17,},],attr:[],party:[alice,bob,carol,]}"]
8 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_18,},],attr:[],party:[alice,bob,carol,]}"]
9 [label="make_share:{in:[In:{t_9,},],out:[Out:{t_19,},],attr:[],party:[alice,bob,carol,]}"]
10 [label="concat:{in:[In:{t_17,t_18,t_19,},],out:[Out:{t_11,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
11 [label="make_private:{in:[In:{t_10,},],out:[Out:{t_20,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
12 [label="reduce[sum]:{in:[In:{t_20,},],out:[Out:{t_12,},],attr:[],party:[alice,]}"]
13 [label="reduce[max]:{in:[In:{t_11,},],out:[Out:{t_13,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_private:{in:[In:{t_13,},],out:[Out:{t_21,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
15 [label="publish_result:{in:[In:{t_12,t_21,},],out:[Out:{t_22,t_23,},],attr:[],party:[alice,]}"]
0 -> 3 [label = "t_2:{aggregate_int_0_count:PRIVATE:INT64}"]
0 -> 7 [label = "t_3:{aggregate_int_0_max:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{aggregate_int_0_count:PRIVATE:INT64}"]
1 -> 8 [label = "t_6:{aggregate_int_0_max:PRIVATE:INT64}"]
10 -> 13 [label = "t_11:{aggregate_int_0_max:SECRET:INT64}"]
11 -> 12 [label = "t_20:{aggregate_int_0_count:PRIVATE:INT64}"]
12 -> 15 [label = "t_12:{aggregate_int_0_count_count:PRIVATE:INT64}"]
13 -> 14 [label = "t_13:{aggregate_int_0_max_max:SECRET:INT64}"]
14 -> 15 [label = "t_21:{aggregate_int_0_max_max:PRIVATE:INT64}"]
2 -> 5 [label = "t_8:{aggregate_int_0_count:PRIVATE:INT64}"]
2 -> 9 [label = "t_9:{aggregate_int_0_max:PRIVATE:INT64}"]
3 -> 6 [label = "t_14:{aggregate_int_0_count:SECRET:INT64}"]
4 -> 6 [label = "t_15:{aggregate_int_0_count:SECRET:INT64}"]
5 -> 6 [label = "t_16:{aggregate_int_0_count:SECRET:INT64}"]
6 -> 11 [label = "t_10:{aggregate_int_0_count:SECRET:INT64}"]
7 -> 10 [label = "t_17:{aggregate_int_0_max:SECRET:INT64}"]
8 -> 10 [label = "t_18:{aggregate_int_0_max:SECRET:INT64}"]
9 -> 10 [label = "t_19:{aggregate_int_0_max:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 run_sql_2 make_share_3 make_share_4 make_share_5 concat_6 make_share_7 make_share_8 make_share_9 concat_10 make_private_11 reduce[sum]_12 reduce[max]_13 make_private_14 publish_result_15]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*), max(aggregate_int_0) from (select aggregate_int_0, groupby_int_0 from alice.tbl_0 union all select aggregate_int_0, groupby_int_0 from bob.tbl_1 union all select aggregate_int_0, groupby_int_0 from carol.tbl_2) as u group by groupby_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,t_4,t_5,},],attr:[sql:select count(1) as expr_365,max(tbl_0.aggregate_int_0) as expr_366,any_value(tbl_0.groupby_int_0) as expr_362 from alice.tbl_0 group by tbl_0.groupby_int_0;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_8,t_9,t_10,},],attr:[sql:select count(1) as 'expr_365',max('tbl_1'.'aggregate_int_0') as 'expr_366','tbl_1'.'groupby_int_0' from 'bob'.'tbl_1' group by 'tbl_1'.'groupby_int_0';,table_refs:[bob.tbl_1],],party:[bob,]}"]
2 [label="run_sql:{in:[],out:[Out:{t_13,t_14,t_15,},],attr:[sql:select count(1) as expr_365,max(tbl_2.aggregate_int_0) as expr_366,tbl_2.groupby_int_0 from carol.tbl_2 group by tbl_2.groupby_int_0;,table_refs:[carol.tbl_2],],party:[carol,]}"]
3 [label="make_share:{in:[In:{t_3,},],out:[Out:{t_26,},],attr:[],party:[alice,bob,carol,]}"]
4 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_27,},],attr:[],party:[alice,bob,carol,]}"]
5 [label="make_share:{in:[In:{t_13,},],out:[Out:{t_28,},],attr:[],party:[alice,bob,carol,]}"]
6 [label="concat:{in:[In:{t_26,t_27,t_28,},],out:[Out:{t_16,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
7 [label="make_share:{in:[In:{t_4,},],out:[Out:{t_29,},],attr:[],party:[alice,bob,carol,]}"]
8 [label="make_share:{in:[In:{t_9,},],out:[Out:{t_30,},],attr:[],party:[alice,bob,carol,]}"]
9 [label="make_share:{in:[In:{t_14,},],out:[Out:{t_31,},],attr:[],party:[alice,bob,carol,]}"]
10 [label="concat:{in:[In:{t_29,t_30,t_31,},],out:[Out:{t_17,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
11 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_32,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="make_share:{in:[In:{t_10,},],out:[Out:{t_33,},],attr:[],party:[alice,bob,carol,]}"]
13 [label="make_share:{in:[In:{t_15,},],out:[Out:{t_34,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="concat:{in:[In:{t_32,t_33,t_34,},],out:[Out:{t_18,},],attr:[axis:0,],party:[alice,bob,carol,]}"]
15 [label="sort:{in:[In:{t_18,t_16,t_17,},Key:{t_18,},],out:[Out:{t_35,t_36,t_37,},],attr:[reverse:[false],],party:[alice,bob,carol,]}"]
16 [label="oblivious_group_mark:{in:[Key:{t_35,},],out:[Group:{t_38,},],attr:[],party:[alice,bob,carol,]}"]
17 [label="sum:{in:[Group:{t_38,},In:{t_36,},],out:[Out:{t_39,},],attr:[],party:[alice,bob,carol,]}"]
18 [label="max:{in:[Group:{t_38,},In:{t_37,},],out:[Out:{t_40,},],attr:[],party:[alice,bob,carol,]}"]
19 [label="shuffle:{in:[In:{t_39,t_40,t_38,},],out:[Out:{t_41,t_42,t_43,},],attr:[],party:[alice,bob,carol,]}"]
20 [label="make_public:{in:[In:{t_43,},],out:[Out:{t_44,},],attr:[],party:[alice,bob,carol,]}"]
21 [label="filter:{in:[Filter:{t_44,},In:{t_41,t_42,},],out:[Out:{t_19,t_20,},],attr:[],party:[alice,bob,carol,]}"]
22 [label="constant:{in:[],out:[Out:{t_21,},],attr:[scalar:4,to_status:1,],party:[alice,bob,carol,]}"]
23 [label="broadcast_to:{in:[In:{t_21,},ShapeRefTensor:{t_19,},],out:[Out:{t_22,},],attr:[],party:[alice,bob,carol,]}"]
24 [label="GreaterEqual:{in:[Left:{t_19,},Right:{t_22,},],out:[Out:{t_23,},],attr:[],party:[alice,bob,carol,]}"]
25 [label="make_public:{in:[In:{t_23,},],out:[Out:{t_45,},],attr:[],party:[alice,bob,carol,]}"]
26 [label="filter:{in:[Filter:{t_45,},In:{t_19,t_20,},],out:[Out:{t_24,t_25,},],attr:[],party:[alice,bob,carol,]}"]
27 [label="make_private:{in:[In:{t_24,},],out:[Out:{t_46,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
28 [label="make_private:{in:[In:{t_25,},],out:[Out:{t_47,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
29 [label="publish_result:{in:[In:{t_46,t_47,},],out:[Out:{t_48,t_49,},],attr:[],party:[alice,]}"]
0 -> 11 [label = "t_5:{groupby_int_0_firstrow:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{simple_count_result:PRIVATE:INT64}"]
0 -> 7 [label = "t_4:{aggregate_int_0_max:PRIVATE:INT64}"]
1 -> 12 [label = "t_10:{groupby_int_0_firstrow:PRIVATE:INT64}"]
1 -> 4 [label = "t_8:{simple_count_result:PRIVATE:INT64}"]
1 -> 8 [label = "t_9:{aggregate_int_0_max:PRIVATE:INT64}"]
10 -> 15 [label = "t_17:{aggregate_int_0_max:SECRET:INT64}"]
11 -> 14 [label = "t_32:{groupby_int_0_firstrow:SECRET:INT64}"]
12 -> 14 [label = "t_33:{groupby_int_0_firstrow:SECRET:INT64}"]
13 -> 14 [label = "t_34:{groupby_int_0_firstrow:SECRET:INT64}"]
14 -> 15 [label = "t_18:{groupby_int_0_firstrow:SECRET:INT64}"]
14 -> 15 [label = "t_18:{groupby_int_0_firstrow:SECRET:INT64}"]
15 -> 16 [label = "t_35:{groupby_int_0_firstrow:SECRET:INT64}"]
15 -> 17 [label = "t_36:{simple_count_result:SECRET:INT64}"]
15 -> 18 [label = "t_37:{aggregate_int_0_max:SECRET:INT64}"]
16 -> 17 [label = "t_38:{group_mark:SECRET:BOOL}"]
16 -> 18 [label = "t_38:{group_mark:SECRET:BOOL}"]
16 -> 19 [label = "t_38:{group_mark:SECRET:BOOL}"]
17 -> 19 [label = "t_39:{simple_count_result_count:SECRET:INT64}"]
18 -> 19 [label = "t_40:{aggregate_int_0_max_max:SECRET:INT64}"]
19 -> 20 [label = "t_43:{group_mark:SECRET:BOOL}"]
19 -> 21 [label = "t_41:{simple_count_result_count:SECRET:INT64}"]
19 -> 21 [label = "t_42:{aggregate_int_0_max_max:SECRET:INT64}"]
2 -> 13 [label = "t_15:{groupby_int_0_firstrow:PRIVATE:INT64}"]
2 -> 5 [label = "t_13:{simple_count_result:PRIVATE:INT64}"]
2 -> 9 [label = "t_14:{aggregate_int_0_max:PRIVATE:INT64}"]
20 -> 21 [label = "t_44:{group_mark:PUBLIC:BOOL}"]
21 -> 23 [label = "t_19:{simple_count_result_count:SECRET:INT64}"]
21 -> 24 [label = "t_19:{simple_count_result_count:SECRET:INT64}"]
21 -> 26 [label = "t_19:{simple_count_result_count:SECRET:INT64}"]
21 -> 26 [label = "t_20:{aggregate_int_0_max_max:SECRET:INT64}"]
22 -> 23 [label = "t_21:{constant_data:PUBLIC:INT64}"]
23 -> 24 [label = "t_22:{constant_data:PUBLIC:INT64}"]
24 -> 25 [label = "t_23:{ge_out:SECRET:BOOL}"]
25 -> 26 [label = "t_45:{ge_out:PUBLIC:BOOL}"]
26 -> 27 [label = "t_24:{simple_count_result_count:SECRET:INT64}"]
26 -> 28 [label = "t_25:{aggregate_int_0_max_max:SECRET:INT64}"]
27 -> 29 [label = "t_46:{simple_count_result_count:PRIVATE:INT64}"]
28 -> 29 [label = "t_47:{aggregate_int_0_max_max:PRIVATE:INT64}"]
3 -> 6 [label = "t_26:{simple_count_result:SECRET:INT64}"]
4 -> 6 [label = "t_27:{simple_count_result:SECRET:INT64}"]
5 -> 6 [label = "t_28:{simple_count_result:SECRET:INT64}"]
6 -> 15 [label = "t_16:{simple_count_result:SECRET:INT64}"]
7 -> 10 [label = "t_29:{aggregate_int_0_max:SECRET:INT64}"]
8 -> 10 [label = "t_30:{aggregate_int_0_max:SECRET:INT64}"]
9 -> 10 [label = "t_31:{aggregate_int_0_max:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 run_sql_2 make_share_3 make_share_4 make_share_5 concat_6 make_share_7 make_share_8 make_share_9 concat_10 make_share_11 make_share_12 make_share_13 concat_14 sort_15 oblivious_group_mark_16 sum_17 max_18 shuffle_19 make_public_20 filter_21 constant_22 broadcast_to_23 GreaterEqual_24 make_public_25 filter_26 make_private_27 make_private_28 publish_result_29]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select alice.plain_int_0 from alice.tbl_0 as alice join bob.tbl_0 as bob on alice.join_int_0 = bob.join_int_0 where alice.compare_int_0 Div bob.compare_int_0 > bob.compare_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,},],attr:[sql:select alice.plain_int_0,alice.join_int_0,alice.compare_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,t_5,},],attr:[sql:select 'bob'.'join_int_0','bob'.'compare_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_4,},],out:[LeftJoinIndex:{t_12,},RightJoinIndex:{t_13,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_3,},RowsIndexFilter:{t_12,},],out:[Out:{t_6,t_7,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_5,},RowsIndexFilter:{t_13,},],out:[Out:{t_8,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_7,},],out:[Out:{t_14,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_8,},],out:[Out:{t_15,},],attr:[],party:[alice,bob,]}"]
7 [label="IntDiv:{in:[Left:{t_14,},Right:{t_15,},],out:[Out:{t_9,},],attr:[],party:[alice,bob,]}"]
8 [label="Greater:{in:[Left:{t_9,},Right:{t_15,},],out:[Out:{t_10,},],attr:[],party:[alice,bob,]}"]
9 [label="make_private:{in:[In:{t_10,},],out:[Out:{t_16,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
10 [label="filter:{in:[Filter:{t_16,},In:{t_6,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
11 [label="publish_result:{in:[In:{t_11,},],out:[Out:{t_17,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{compare_int_0:PRIVATE:INT64}"]
10 -> 11 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_12:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_13:{right_index:PRIVATE:INT64}"]
3 -> 10 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
3 -> 5 [label = "t_7:{compare_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_8:{compare_int_0:PRIVATE:INT64}"]
5 -> 7 [label = "t_14:{compare_int_0:SECRET:INT64}"]
6 -> 7 [label = "t_15:{compare_int_0:SECRET:INT64}"]
6 -> 8 [label = "t_15:{compare_int_0:SECRET:INT64}"]
7 -> 8 [label = "t_9:{intdiv_out:SECRET:INT64}"]
8 -> 9 [label = "t_10:{gt_out:SECRET:BOOL}"]
9 -> 10 [label = "t_16:{gt_out:PRIVATE:BOOL}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 IntDiv_7 Greater_8 make_private_9 filter_10 publish_result_11]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select alice.groupby_string_0,bob.groupby_string_0, count(*) as cnt from alice.tbl_0 as alice join bob.tbl_0 as bob where alice.join_int_0=bob.join_int_0 group by alice.groupby_string_0, bob.groupby_string_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,},],attr:[sql:select alice.join_int_0,alice.groupby_string_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_3,t_4,},],attr:[sql:select 'bob'.'join_int_0','bob'.'groupby_string_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_3,},],out:[LeftJoinIndex:{t_16,},RightJoinIndex:{t_17,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_2,},RowsIndexFilter:{t_16,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,},RowsIndexFilter:{t_17,},],out:[Out:{t_6,},],attr:[],party:[bob,]}"]
5 [label="make_share:{in:[In:{t_5,},],out:[Out:{t_18,},],attr:[],party:[alice,bob,]}"]
6 [label="make_share:{in:[In:{t_6,},],out:[Out:{t_19,},],attr:[],party:[alice,bob,]}"]
7 [label="sort:{in:[In:{t_18,t_19,t_18,t_19,},Key:{t_18,t_19,},],out:[Out:{t_20,t_21,t_22,t_23,},],attr:[reverse:[false false],],party:[alice,bob,]}"]
8 [label="oblivious_group_mark:{in:[Key:{t_20,t_21,},],out:[Group:{t_24,},],attr:[],party:[alice,bob,]}"]
9 [label="count:{in:[Group:{t_24,},In:{t_24,},],out:[Out:{t_25,},],attr:[],party:[alice,bob,]}"]
10 [label="shuffle:{in:[In:{t_25,t_22,t_23,t_24,},],out:[Out:{t_26,t_27,t_28,t_29,},],attr:[],party:[alice,bob,]}"]
11 [label="make_public:{in:[In:{t_29,},],out:[Out:{t_30,},],attr:[],party:[alice,bob,]}"]
12 [label="filter:{in:[Filter:{t_30,},In:{t_26,t_27,t_28,},],out:[Out:{t_7,t_8,t_9,},],attr:[],party:[alice,bob,]}"]
13 [label="constant:{in:[],out:[Out:{t_10,},],attr:[scalar:4,to_status:1,],party:[alice,bob,]}"]
14 [label="broadcast_to:{in:[In:{t_10,},ShapeRefTensor:{t_7,},],out:[Out:{t_11,},],attr:[],party:[alice,bob,]}"]
15 [label="GreaterEqual:{in:[Left:{t_7,},Right:{t_11,},],out:[Out:{t_12,},],attr:[],party:[alice,bob,]}"]
16 [label="make_public:{in:[In:{t_12,},],out:[Out:{t_31,},],attr:[],party:[alice,bob,]}"]
17 [label="filter:{in:[Filter:{t_31,},In:{t_7,t_8,t_9,},],out:[Out:{t_13,t_14,t_15,},],attr:[],party:[alice,bob,]}"]
18 [label="make_public:{in:[In:{t_14,},],out:[Out:{t_32,},],attr:[],party:[alice,bob,]}"]
19 [label="make_private:{in:[In:{t_32,},],out:[Out:{t_33,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
20 [label="make_public:{in:[In:{t_15,},],out:[Out:{t_34,},],attr:[],party:[alice,bob,]}"]
21 [label="make_private:{in:[In:{t_34,},],out:[Out:{t_35,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
22 [label="make_private:{in:[In:{t_13,},],out:[Out:{t_36,},],attr:[reveal_to:alice,],party:[alice,bob,]}"]
23 [label="publish_result:{in:[In:{t_33,t_35,t_36,},],out:[Out:{t_37,t_38,t_39,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{groupby_string_0:PRIVATE:STRING}"]
1 -> 2 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{groupby_string_0:PRIVATE:STRING}"]
10 -> 11 [label = "t_29:{group_mark:SECRET:BOOL}"]
10 -> 12 [label = "t_26:{aggregated_group_simple_count:SECRET:INT64}"]
10 -> 12 [label = "t_27:{groupby_string_0:SECRET:STRING}"]
10 -> 12 [label = "t_28:{groupby_string_0:SECRET:STRING}"]
11 -> 12 [label = "t_30:{group_mark:PUBLIC:BOOL}"]
12 -> 14 [label = "t_7:{simple_count_result:SECRET:INT64}"]
12 -> 15 [label = "t_7:{simple_count_result:SECRET:INT64}"]
12 -> 17 [label = "t_7:{simple_count_result:SECRET:INT64}"]
12 -> 17 [label = "t_8:{groupby_string_0_firstrow:SECRET:STRING}"]
12 -> 17 [label = "t_9:{groupby_string_0_firstrow:SECRET:STRING}"]
13 -> 14 [label = "t_10:{constant_data:PUBLIC:INT64}"]
14 -> 15 [label = "t_11:{constant_data:PUBLIC:INT64}"]
15 -> 16 [label = "t_12:{ge_out:SECRET:BOOL}"]
16 -> 17 [label = "t_31:{ge_out:PUBLIC:BOOL}"]
17 -> 18 [label = "t_14:{groupby_string_0_firstrow:SECRET:STRING}"]
17 -> 20 [label = "t_15:{groupby_string_0_firstrow:SECRET:STRING}"]
17 -> 22 [label = "t_13:{simple_count_result:SECRET:INT64}"]
18 -> 19 [label = "t_32:{groupby_string_0_firstrow:PUBLIC:STRING}"]
19 -> 23 [label = "t_33:{groupby_string_0_firstrow:PRIVATE:STRING}"]
2 -> 3 [label = "t_16:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_17:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_34:{groupby_string_0_firstrow:PUBLIC:STRING}"]
21 -> 23 [label = "t_35:{groupby_string_0_firstrow:PRIVATE:STRING}"]
22 -> 23 [label = "t_36:{simple_count_result:PRIVATE:INT64}"]
3 -> 5 [label = "t_5:{groupby_string_0:PRIVATE:STRING}"]
4 -> 6 [label = "t_6:{groupby_string_0:PRIVATE:STRING}"]
5 -> 7 [label = "t_18:{groupby_string_0:SECRET:STRING}"]
5 -> 7 [label = "t_18:{groupby_string_0:SECRET:STRING}"]
5 -> 7 [label = "t_18:{groupby_string_0:SECRET:STRING}"]
6 -> 7 [label = "t_19:{groupby_string_0:SECRET:STRING}"]
6 -> 7 [label = "t_19:{groupby_string_0:SECRET:STRING}"]
6 -> 7 [label = "t_19:{groupby_string_0:SECRET:STRING}"]
7 -> 10 [label = "t_22:{groupby_string_0:SECRET:STRING}"]
7 -> 10 [label = "t_23:{groupby_string_0:SECRET:STRING}"]
7 -> 8 [label = "t_20:{groupby_string_0:SECRET:STRING}"]
7 -> 8 [label = "t_21:{groupby_string_0:SECRET:STRING}"]
8 -> 10 [label = "t_24:{group_mark:SECRET:BOOL}"]
8 -> 9 [label = "t_24:{group_mark:SECRET:BOOL}"]
8 -> 9 [label = "t_24:{group_mark:SECRET:BOOL}"]
9 -> 10 [label = "t_25:{aggregated_group_simple_count:SECRET:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 make_share_5 make_share_6 sort_7 oblivious_group_mark_8 count_9 shuffle_10 make_public_11 filter_12 constant_13 broadcast_to_14 GreaterEqual_15 make_public_16 filter_17 make_public_18 make_private_19 make_public_20 make_private_21 make_private_22 publish_result_23]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select case when alice.compare_int_0 > bob.compare_int_0 then alice.plain_int_0 else bob.plain_int_0 end as case_when1, case when bob.compare_int_0 > carol.compare_int_0 then 1 else 0 end as case_when2 from alice.tbl_0 as alice, bob.tbl_0 as bob, carol.tbl_0 as carol where alice.join_int_0 = bob.join_int_0 and bob.join_int_0 = carol.join_int_0;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,},],attr:[sql:select alice.plain_int_0,alice.join_int_0,alice.compare_int_0 from alice.tbl_0 as alice;,table_refs:[alice.tbl_0],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,t_5,t_6,},],attr:[sql:select 'bob'.'plain_int_0','bob'.'join_int_0','bob'.'compare_int_0' from 'bob'.'tbl_0' as 'bob';,table_refs:[bob.tbl_0],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_2,},Right:{t_5,},],out:[LeftJoinIndex:{t_27,},RightJoinIndex:{t_28,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_3,},RowsIndexFilter:{t_27,},],out:[Out:{t_7,t_8,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,t_5,t_6,},RowsIndexFilter:{t_28,},],out:[Out:{t_9,t_10,t_11,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_12,t_13,},],attr:[sql:select carol.join_int_0,carol.compare_int_0 from carol.tbl_0 as carol;,table_refs:[carol.tbl_0],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_10,},Right:{t_12,},],out:[LeftJoinIndex:{t_29,},RightJoinIndex:{t_30,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_29,},],out:[Out:{t_31,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_7,t_8,},RowsIndexFilter:{t_31,},],out:[Out:{t_14,t_15,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_9,t_11,},RowsIndexFilter:{t_29,},],out:[Out:{t_16,t_17,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_13,},RowsIndexFilter:{t_30,},],out:[Out:{t_18,},],attr:[],party:[carol,]}"]
11 [label="make_share:{in:[In:{t_15,},],out:[Out:{t_32,},],attr:[],party:[alice,bob,carol,]}"]
12 [label="make_share:{in:[In:{t_17,},],out:[Out:{t_33,},],attr:[],party:[alice,bob,carol,]}"]
13 [label="Greater:{in:[Left:{t_32,},Right:{t_33,},],out:[Out:{t_19,},],attr:[],party:[alice,bob,carol,]}"]
14 [label="make_public:{in:[In:{t_14,},],out:[Out:{t_34,},],attr:[],party:[alice,bob,carol,]}"]
15 [label="make_public:{in:[In:{t_16,},],out:[Out:{t_35,},],attr:[],party:[alice,bob,carol,]}"]
16 [label="case_when:{in:[Condition:{t_19,},Value:{t_34,},ValueElse:{t_35,},],out:[Out:{t_20,},],attr:[],party:[alice,bob,carol,]}"]
17 [label="make_share:{in:[In:{t_18,},],out:[Out:{t_36,},],attr:[],party:[alice,bob,carol,]}"]
18 [label="Greater:{in:[Left:{t_33,},Right:{t_36,},],out:[Out:{t_21,},],attr:[],party:[alice,bob,carol,]}"]
19 [label="constant:{in:[],out:[Out:{t_22,},],attr:[scalar:1,to_status:1,],party:[alice,bob,carol,]}"]
20 [label="constant:{in:[],out:[Out:{t_23,},],attr:[scalar:0,to_status:1,],party:[alice,bob,carol,]}"]
21 [label="broadcast_to:{in:[In:{t_22,t_23,},ShapeRefTensor:{t_21,},],out:[Out:{t_24,t_25,},],attr:[],party:[alice,bob,carol,]}"]
22 [label="case_when:{in:[Condition:{t_21,},Value:{t_24,},ValueElse:{t_25,},],out:[Out:{t_26,},],attr:[],party:[alice,bob,carol,]}"]
23 [label="make_private:{in:[In:{t_20,},],out:[Out:{t_37,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
24 [label="make_private:{in:[In:{t_26,},],out:[Out:{t_38,},],attr:[reveal_to:alice,],party:[alice,bob,carol,]}"]
25 [label="publish_result:{in:[In:{t_37,t_38,},],out:[Out:{t_39,t_40,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_2:{join_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{compare_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_5:{join_int_0:PRIVATE:INT64}"]
1 -> 4 [label = "t_6:{compare_int_0:PRIVATE:INT64}"]
10 -> 17 [label = "t_18:{compare_int_0:PRIVATE:INT64}"]
11 -> 13 [label = "t_32:{compare_int_0:SECRET:INT64}"]
12 -> 13 [label = "t_33:{compare_int_0:SECRET:INT64}"]
12 -> 18 [label = "t_33:{compare_int_0:SECRET:INT64}"]
13 -> 16 [label = "t_19:{gt_out:SECRET:BOOL}"]
14 -> 16 [label = "t_34:{plain_int_0:PUBLIC:INT64}"]
15 -> 16 [label = "t_35:{plain_int_0:PUBLIC:INT64}"]
16 -> 23 [label = "t_20:{case_out:SECRET:INT64}"]
17 -> 18 [label = "t_36:{compare_int_0:SECRET:INT64}"]
18 -> 21 [label = "t_21:{gt_out:SECRET:BOOL}"]
18 -> 22 [label = "t_21:{gt_out:SECRET:BOOL}"]
19 -> 21 [label = "t_22:{constant_data:PUBLIC:INT64}"]
2 -> 3 [label = "t_27:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_28:{right_index:PRIVATE:INT64}"]
20 -> 21 [label = "t_23:{constant_data:PUBLIC:INT64}"]
21 -> 22 [label = "t_24:{constant_data:PUBLIC:INT64}"]
21 -> 22 [label = "t_25:{constant_data:PUBLIC:INT64}"]
22 -> 24 [label = "t_26:{case_out:SECRET:INT64}"]
23 -> 25 [label = "t_37:{case_out:PRIVATE:INT64}"]
24 -> 25 [label = "t_38:{case_out:PRIVATE:INT64}"]
3 -> 8 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_8:{compare_int_0:PRIVATE:INT64}"]
4 -> 6 [label = "t_10:{join_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_11:{compare_int_0:PRIVATE:INT64}"]
4 -> 9 [label = "t_9:{plain_int_0:PRIVATE:INT64}"]
5 -> 10 [label = "t_13:{compare_int_0:PRIVATE:INT64}"]
5 -> 6 [label = "t_12:{join_int_0:PRIVATE:INT64}"]
6 -> 10 [label = "t_30:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_29:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_29:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_31:{left_index:PRIVATE:INT64}"]
8 -> 11 [label = "t_15:{compare_int_0:PRIVATE:INT64}"]
8 -> 14 [label = "t_14:{plain_int_0:PRIVATE:INT64}"]
9 -> 12 [label = "t_17:{compare_int_0:PRIVATE:INT64}"]
9 -> 15 [label = "t_16:{plain_int_0:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 make_share_11 make_share_12 Greater_13 make_public_14 make_public_15 case_when_16 make_share_17 Greater_18 constant_19 constant_20 broadcast_to_21 case_when_22 make_private_23 make_private_24 publish_result_25]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select alice.groupby_int_0, alice.GROUPBY_int_1, bob.join_string_0, bob.JOIN_STRING_0, carol.COMPARE_float_0 > 0, carol.compare_float_1 > 0 from alice.UPPER_table as alice, bob.UPPER_table as bob, carol.UPPER_table as carol where alice.join_string_0 = bob.JOIN_string_0 and bob.join_string_1 = carol.JOIN_string_1;`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,t_2,t_3,},],attr:[sql:select alice.GROUPBY_int_0,alice.groupby_int_1,alice.JOIN_string_0 from alice.UPPER_table as alice;,table_refs:[alice.UPPER_table],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,t_5,},],attr:[sql:select 'bob'.'JOIN_string_0','bob'.'join_string_1' from 'bob'.'UPPER_table' as 'bob';,table_refs:[bob.UPPER_table],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_3,},Right:{t_4,},],out:[LeftJoinIndex:{t_24,},RightJoinIndex:{t_25,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,t_2,},RowsIndexFilter:{t_24,},],out:[Out:{t_6,t_7,},],attr:[],party:[alice,]}"]
4 [label="filter_by_index:{in:[Data:{t_4,t_5,},RowsIndexFilter:{t_25,},],out:[Out:{t_8,t_9,},],attr:[],party:[bob,]}"]
5 [label="run_sql:{in:[],out:[Out:{t_10,t_11,t_12,},],attr:[sql:select carol.join_string_1,carol.COMPARE_float_0,carol.compare_float_1 from carol.UPPER_table as carol;,table_refs:[carol.UPPER_table],],party:[carol,]}"]
6 [label="psi_join:{in:[Left:{t_9,},Right:{t_10,},],out:[LeftJoinIndex:{t_26,},RightJoinIndex:{t_27,},],attr:[input_party_codes:[bob carol],join_type:0,psi_algorithm:0,],party:[bob,carol,]}"]
7 [label="copy:{in:[In:{t_26,},],out:[Out:{t_28,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="filter_by_index:{in:[Data:{t_6,t_7,},RowsIndexFilter:{t_28,},],out:[Out:{t_13,t_14,},],attr:[],party:[alice,]}"]
9 [label="filter_by_index:{in:[Data:{t_8,},RowsIndexFilter:{t_26,},],out:[Out:{t_15,},],attr:[],party:[bob,]}"]
10 [label="filter_by_index:{in:[Data:{t_11,t_12,},RowsIndexFilter:{t_27,},],out:[Out:{t_16,t_17,},],attr:[],party:[carol,]}"]
11 [label="constant:{in:[],out:[Out:{t_18,},],attr:[scalar:0,to_status:1,],party:[alice,bob,carol,]}"]
12 [label="broadcast_to:{in:[In:{t_18,},ShapeRefTensor:{t_16,},],out:[Out:{t_19,},],attr:[],party:[carol,]}"]
13 [label="Greater:{in:[Left:{t_16,},Right:{t_19,},],out:[Out:{t_20,},],attr:[],party:[carol,]}"]
14 [label="constant:{in:[],out:[Out:{t_21,},],attr:[scalar:0,to_status:1,],party:[alice,bob,carol,]}"]
15 [label="broadcast_to:{in:[In:{t_21,},ShapeRefTensor:{t_17,},],out:[Out:{t_22,},],attr:[],party:[carol,]}"]
16 [label="Greater:{in:[Left:{t_17,},Right:{t_22,},],out:[Out:{t_23,},],attr:[],party:[carol,]}"]
17 [label="copy:{in:[In:{t_15,},],out:[Out:{t_29,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
18 [label="copy:{in:[In:{t_20,},],out:[Out:{t_30,},],attr:[input_party_codes:carol,output_party_codes:alice,],party:[carol,alice,]}"]
19 [label="copy:{in:[In:{t_23,},],out:[Out:{t_31,},],attr:[input_party_codes:carol,output_party_codes:alice,],party:[carol,alice,]}"]
20 [label="publish_result:{in:[In:{t_13,t_14,t_29,t_29,t_30,t_31,},],out:[Out:{t_32,t_33,t_34,t_35,t_36,t_37,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_3:{JOIN_string_0:PRIVATE:STRING}"]
0 -> 3 [label = "t_1:{GROUPBY_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_2:{groupby_int_1:PRIVATE:INT64}"]
1 -> 2 [label = "t_4:{JOIN_string_0:PRIVATE:STRING}"]
1 -> 4 [label = "t_4:{JOIN_string_0:PRIVATE:STRING}"]
1 -> 4 [label = "t_5:{join_string_1:PRIVATE:STRING}"]
10 -> 12 [label = "t_16:{COMPARE_float_0:PRIVATE:FLOAT64}"]
10 -> 13 [label = "t_16:{COMPARE_float_0:PRIVATE:FLOAT64}"]
10 -> 15 [label = "t_17:{compare_float_1:PRIVATE:FLOAT64}"]
10 -> 16 [label = "t_17:{compare_float_1:PRIVATE:FLOAT64}"]
11 -> 12 [label = "t_18:{constant_data:PUBLIC:INT64}"]
12 -> 13 [label = "t_19:{constant_data:PRIVATE:INT64}"]
13 -> 18 [label = "t_20:{gt_out:PRIVATE:BOOL}"]
14 -> 15 [label = "t_21:{constant_data:PUBLIC:INT64}"]
15 -> 16 [label = "t_22:{constant_data:PRIVATE:INT64}"]
16 -> 19 [label = "t_23:{gt_out:PRIVATE:BOOL}"]
17 -> 20 [label = "t_29:{JOIN_string_0:PRIVATE:STRING}"]
17 -> 20 [label = "t_29:{JOIN_string_0:PRIVATE:STRING}"]
18 -> 20 [label = "t_30:{gt_out:PRIVATE:BOOL}"]
19 -> 20 [label = "t_31:{gt_out:PRIVATE:BOOL}"]
2 -> 3 [label = "t_24:{left_index:PRIVATE:INT64}"]
2 -> 4 [label = "t_25:{right_index:PRIVATE:INT64}"]
3 -> 8 [label = "t_6:{GROUPBY_int_0:PRIVATE:INT64}"]
3 -> 8 [label = "t_7:{groupby_int_1:PRIVATE:INT64}"]
4 -> 6 [label = "t_9:{join_string_1:PRIVATE:STRING}"]
4 -> 9 [label = "t_8:{JOIN_string_0:PRIVATE:STRING}"]
5 -> 10 [label = "t_11:{COMPARE_float_0:PRIVATE:FLOAT64}"]
5 -> 10 [label = "t_12:{compare_float_1:PRIVATE:FLOAT64}"]
5 -> 6 [label = "t_10:{join_string_1:PRIVATE:STRING}"]
6 -> 10 [label = "t_27:{right_index:PRIVATE:INT64}"]
6 -> 7 [label = "t_26:{left_index:PRIVATE:INT64}"]
6 -> 9 [label = "t_26:{left_index:PRIVATE:INT64}"]
7 -> 8 [label = "t_28:{left_index:PRIVATE:INT64}"]
8 -> 20 [label = "t_13:{GROUPBY_int_0:PRIVATE:INT64}"]
8 -> 20 [label = "t_14:{groupby_int_1:PRIVATE:INT64}"]
9 -> 17 [label = "t_15:{JOIN_string_0:PRIVATE:STRING}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 filter_by_index_4 run_sql_5 psi_join_6 copy_7 filter_by_index_8 filter_by_index_9 filter_by_index_10 constant_11 broadcast_to_12 Greater_13 constant_14 broadcast_to_15 Greater_16 copy_17 copy_18 copy_19 publish_result_20]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select ta.join_int_0, tb.plain_int_0 from alice.tbl_1 as ta inner join bob.tbl_1 as tb on ta.join_int_0=tb.join_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select ta.join_int_0 from alice.tbl_1 as ta;,table_refs:[alice.tbl_1],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_2,t_3,},],attr:[sql:select 'tb'.'plain_int_0','tb'.'join_int_0' from 'bob'.'tbl_1' as 'tb';,table_refs:[bob.tbl_1],],party:[bob,]}"]
2 [label="bucket:{in:[In:{t_1,},Key:{t_1,},],out:[Out:{t_6,},],attr:[input_party_codes:[alice],],party:[alice,]}"]
3 [label="bucket:{in:[In:{t_3,t_2,},Key:{t_3,},],out:[Out:{t_7,t_8,},],attr:[input_party_codes:[bob],],party:[bob,]}"]
4 [label="psi_join:{in:[Left:{t_6,},Right:{t_7,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{t_10,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
5 [label="filter_by_index:{in:[Data:{t_6,},RowsIndexFilter:{t_9,},],out:[Out:{t_4,},],attr:[],party:[alice,]}"]
6 [label="filter_by_index:{in:[Data:{t_8,},RowsIndexFilter:{t_10,},],out:[Out:{t_5,},],attr:[],party:[bob,]}"]
7 [label="copy:{in:[In:{t_5,},],out:[Out:{t_11,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="publish_result:{in:[In:{t_4,t_11,},],out:[Out:{t_12,t_13,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
0 -> 2 [label = "t_1:{join_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_2:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_3:{join_int_0:PRIVATE:INT64}"]
2 -> 4 [label = "t_6:{join_int_0:PRIVATE:INT64}"]
2 -> 5 [label = "t_6:{join_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_7:{join_int_0:PRIVATE:INT64}"]
3 -> 6 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_9:{left_index:PRIVATE:INT64}"]
4 -> 6 [label = "t_10:{right_index:PRIVATE:INT64}"]
5 -> 8 [label = "t_4:{join_int_0:PRIVATE:INT64}"]
6 -> 7 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
7 -> 8 [label = "t_11:{plain_int_0:PRIVATE:INT64}"]
}`, `Batched pipeline with 3 nodes`, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select count(*) from alice.tbl_1 as t1 join bob.tbl_1 as t3 join bob.tbl_2 as t4 where t1.plain_int_0 = t3.plain_int_0 and t3.plain_int_0 = t4.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select t1.plain_int_0 from alice.tbl_1 as t1;,table_refs:[alice.tbl_1],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_4,},],attr:[sql:select 't3'.'plain_int_0' from 'bob'.'tbl_1' as 't3' join 'bob'.'tbl_2' as 't4' on 't3'.'plain_int_0'='t4'.'plain_int_0';,table_refs:[bob.tbl_1 bob.tbl_2],],party:[bob,]}"]
2 [label="bucket:{in:[In:{t_1,},Key:{t_1,},],out:[Out:{t_7,},],attr:[input_party_codes:[alice],],party:[alice,]}"]
3 [label="bucket:{in:[In:{t_4,},Key:{t_4,},],out:[Out:{t_8,},],attr:[input_party_codes:[bob],],party:[bob,]}"]
4 [label="psi_join:{in:[Left:{t_7,},Right:{t_8,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
5 [label="filter_by_index:{in:[Data:{t_7,},RowsIndexFilter:{t_9,},],out:[Out:{t_5,},],attr:[],party:[alice,]}"]
6 [label="shape:{in:[In:{t_5,},],out:[Out:{t_6,},],attr:[axis:0,],party:[alice,]}"]
7 [label="publish_result:{in:[In:{t_6,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_4:{plain_int_0:PRIVATE:INT64}"]
2 -> 4 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
2 -> 5 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
3 -> 4 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_9:{left_index:PRIVATE:INT64}"]
5 -> 6 [label = "t_5:{plain_int_0:PRIVATE:INT64}"]
6 -> 7 [label = "t_6:{plain_int_0_count:PRIVATE:INT64}"]
}`, `Batched pipeline with 1 nodes`, testConf{groupThreshold: 4, batched: true, revealGroupCount: false}},
	{`select count(*) from alice.tbl_1 as t1 join bob.tbl_1 as t2 join alice.tbl_2 as t3 join bob.tbl_2 as t4 where t1.plain_int_0 = t3.plain_int_0 and t2.plain_int_0 = t4.plain_int_0 and t2.plain_int_0 = t3.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select t3.plain_int_0 from alice.tbl_1 as t1 join alice.tbl_2 as t3 on t1.plain_int_0=t3.plain_int_0;,table_refs:[alice.tbl_1 alice.tbl_2],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_6,},],attr:[sql:select 't2'.'plain_int_0' from 'bob'.'tbl_1' as 't2' join 'bob'.'tbl_2' as 't4' on 't2'.'plain_int_0'='t4'.'plain_int_0';,table_refs:[bob.tbl_1 bob.tbl_2],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_3,},Right:{t_6,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_3,},RowsIndexFilter:{t_9,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
4 [label="shape:{in:[In:{t_7,},],out:[Out:{t_8,},],attr:[axis:0,],party:[alice,]}"]
5 [label="publish_result:{in:[In:{t_8,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_8:{plain_int_0_count:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 shape_4 publish_result_5]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) from alice.tbl_1 as t1 join alice.tbl_2 as t2 join bob.tbl_1 as t3 join bob.tbl_2 as t4 where t1.plain_int_0 = t2.plain_int_0 and t2.plain_int_0 = t3.plain_int_0 and t3.plain_int_0 = t4.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_3,},],attr:[sql:select t2.plain_int_0 from alice.tbl_1 as t1 join alice.tbl_2 as t2 on t1.plain_int_0=t2.plain_int_0;,table_refs:[alice.tbl_1 alice.tbl_2],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_6,},],attr:[sql:select 't3'.'plain_int_0' from 'bob'.'tbl_1' as 't3' join 'bob'.'tbl_2' as 't4' on 't3'.'plain_int_0'='t4'.'plain_int_0';,table_refs:[bob.tbl_1 bob.tbl_2],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_3,},Right:{t_6,},],out:[LeftJoinIndex:{t_9,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_3,},RowsIndexFilter:{t_9,},],out:[Out:{t_7,},],attr:[],party:[alice,]}"]
4 [label="shape:{in:[In:{t_7,},],out:[Out:{t_8,},],attr:[axis:0,],party:[alice,]}"]
5 [label="publish_result:{in:[In:{t_8,},],out:[Out:{t_10,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_3:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_6:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_9:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_8:{plain_int_0_count:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 shape_4 publish_result_5]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*) from alice.tbl_1 as t1 join bob.tbl_0 as t2 join bob.tbl_1 as t3 join bob.tbl_2 as t4 where t1.plain_int_0 = t2.plain_int_0 and t2.plain_int_0 = t3.plain_int_0 and t3.plain_int_0 = t4.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select t1.plain_int_0 from alice.tbl_1 as t1;,table_refs:[alice.tbl_1],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_7,},],attr:[sql:select 't2'.'plain_int_0' from (select 't2'.'plain_int_0','t3'.'plain_int_0' from ('bob'.'tbl_0' as 't2' join 'bob'.'tbl_1' as 't3' on 't2'.'plain_int_0'='t3'.'plain_int_0')) as 't2' join 'bob'.'tbl_2' as 't4' on 't2'.'plain_int_0'='t4'.'plain_int_0';,table_refs:[bob.tbl_0 bob.tbl_1 bob.tbl_2],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_7,},],out:[LeftJoinIndex:{t_10,},RightJoinIndex:{},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_1,},RowsIndexFilter:{t_10,},],out:[Out:{t_8,},],attr:[],party:[alice,]}"]
4 [label="shape:{in:[In:{t_8,},],out:[Out:{t_9,},],attr:[axis:0,],party:[alice,]}"]
5 [label="publish_result:{in:[In:{t_9,},],out:[Out:{t_11,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
0 -> 3 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_7:{plain_int_0:PRIVATE:INT64}"]
2 -> 3 [label = "t_10:{left_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_8:{plain_int_0:PRIVATE:INT64}"]
4 -> 5 [label = "t_9:{plain_int_0_count:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 shape_4 publish_result_5]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
	{`select count(*), sum(add_res) from alice.tbl_1 as t1, (select plain_int_0, plain_int_0+1 as add_res from bob.tbl_0) as t2, bob.tbl_1 as t3, bob.tbl_2 as t4 where t1.plain_int_0 = t2.plain_int_0 and t2.plain_int_0 = t3.plain_int_0 and t3.plain_int_0 = t4.plain_int_0`, `digraph G {
0 [label="run_sql:{in:[],out:[Out:{t_1,},],attr:[sql:select t1.plain_int_0 from alice.tbl_1 as t1;,table_refs:[alice.tbl_1],],party:[alice,]}"]
1 [label="run_sql:{in:[],out:[Out:{t_10,t_11,},],attr:[sql:select 't2'.'plain_int_0','t2'.'add_res' from (select 't2'.'plain_int_0','t2'.'add_res','t3'.'plain_int_0' from ((select 'tbl_0'.'plain_int_0','tbl_0'.'plain_int_0'+1 as 'add_res' from 'bob'.'tbl_0') as 't2' join 'bob'.'tbl_1' as 't3' on 't2'.'plain_int_0'='t3'.'plain_int_0')) as 't2' join 'bob'.'tbl_2' as 't4' on 't2'.'plain_int_0'='t4'.'plain_int_0';,table_refs:[bob.tbl_0 bob.tbl_1 bob.tbl_2],],party:[bob,]}"]
2 [label="psi_join:{in:[Left:{t_1,},Right:{t_10,},],out:[LeftJoinIndex:{},RightJoinIndex:{t_15,},],attr:[input_party_codes:[alice bob],join_type:0,psi_algorithm:0,],party:[alice,bob,]}"]
3 [label="filter_by_index:{in:[Data:{t_11,},RowsIndexFilter:{t_15,},],out:[Out:{t_12,},],attr:[],party:[bob,]}"]
4 [label="shape:{in:[In:{t_12,},],out:[Out:{t_13,},],attr:[axis:0,],party:[bob,]}"]
5 [label="reduce[sum]:{in:[In:{t_12,},],out:[Out:{t_14,},],attr:[],party:[bob,]}"]
6 [label="copy:{in:[In:{t_13,},],out:[Out:{t_16,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
7 [label="copy:{in:[In:{t_14,},],out:[Out:{t_17,},],attr:[input_party_codes:bob,output_party_codes:alice,],party:[bob,alice,]}"]
8 [label="publish_result:{in:[In:{t_16,t_17,},],out:[Out:{t_18,t_19,},],attr:[],party:[alice,]}"]
0 -> 2 [label = "t_1:{plain_int_0:PRIVATE:INT64}"]
1 -> 2 [label = "t_10:{plain_int_0:PRIVATE:INT64}"]
1 -> 3 [label = "t_11:{plus_out:PRIVATE:INT64}"]
2 -> 3 [label = "t_15:{right_index:PRIVATE:INT64}"]
3 -> 4 [label = "t_12:{plus_out:PRIVATE:INT64}"]
3 -> 5 [label = "t_12:{plus_out:PRIVATE:INT64}"]
4 -> 6 [label = "t_13:{plus_out_count:PRIVATE:INT64}"]
5 -> 7 [label = "t_14:{plus_out_sum:PRIVATE:INT64}"]
6 -> 8 [label = "t_16:{plus_out_count:PRIVATE:INT64}"]
7 -> 8 [label = "t_17:{plus_out_sum:PRIVATE:INT64}"]
}`, `
pipeline 0 {
Batched: false
node: [run_sql_0 run_sql_1 psi_join_2 filter_by_index_3 shape_4 reduce[sum]_5 copy_6 copy_7 publish_result_8]
Inputs: []
Outputs: []
}
`, testConf{groupThreshold: 4, batched: false, revealGroupCount: false}},
}
